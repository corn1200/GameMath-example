# 게임 수학 정리 문서
게임 개발에 필요한 수학 개념에 대해 정리한 문서입니다.

# 목차
* [1. 수와 집합](README-ORIGIN.md/#1-수와-집합)
    * [1.1. 연산과 수의 구조](README-ORIGIN.md/#11-연산과-수의-구조)
    * [1.2. 수의 구조](README-ORIGIN.md/#12-수의-구조)
    * [1.3. 수의 표현](README-ORIGIN.md/#13-수의-표현)
* [2. 함수](README-ORIGIN.md/#2-함수)
    * [2.1. 함수의 개념과 종류](README-ORIGIN.md/#21-함수의-개념과-종류)
    * [2.2. 합성함수](README-ORIGIN.md/#22-합성함수)
    * [2.3. 항등함수와 역함수](README-ORIGIN.md/#23-항등함수와-역함수)
    * [2.4. 곱집합을 활용한 좌표 평면으로의 확장](README-ORIGIN.md/#24-곱집합을-활용한-좌표-평면으로의-확장)
* [3. 데카르트 좌표계](README-ORIGIN.md/#3-데카르트-좌표계)
* [4. 벡터 공간과 벡터](README-ORIGIN.md/#4-벡터-공간과-벡터)
    * [4.1. 스칼라와 벡터](README-ORIGIN.md/#41-스칼라와-벡터)
    * [4.2. 벡터 공간의 연산](README-ORIGIN.md/#42-벡터-공간의-연산)
    * [4.3. 벡터의 크기와 이동](README-ORIGIN.md/#43-벡터의-크기와-이동)
* [5. 벡터의 결합과 생성](README-ORIGIN.md/#5-벡터의-결합과-생성)
* [6. 삼각함수](README-ORIGIN.md/#6-삼각함수)
    * [6.1. 삼각함수의 성질](README-ORIGIN.md/#61-삼각함수의-성질)
    * [6.2. 각의 측정법](README-ORIGIN.md/#62-각의-측정법)
* [7. 삼각함수를 활용한 물체의 회전](README-ORIGIN.md/#7-삼각함수를-활용한-물체의-회전)
* [8. 삼각함수의 역함수](README-ORIGIN.md/#8-삼각함수의-역함수)
* [9. 극좌표계](README-ORIGIN.md/#9-극좌표계)
* [10. 선형성: 예측 가능한 비례 관계](README-ORIGIN.md/#10-선형성-예측-가능한-비례-관계)
    * [10.1. 선형 함수](README-ORIGIN.md/#101-선형-함수)
    * [10.2. 벡터 공간의 선형 변환](README-ORIGIN.md/#102-벡터-공간의-선형-변환)
* [11. 행렬](README-ORIGIN.md/#11-행렬)
    * [11.1. 행렬의 기본 연산](README-ORIGIN.md/#111-행렬의-기본-연산)
    * [11.2. 행렬의 곱셈](README-ORIGIN.md/#112-행렬의-곱셈)
    * [11.3. 정방행렬의 곱셈](README-ORIGIN.md/#113-정방행렬의-곱셈)
* [12. 행렬의 설계](README-ORIGIN.md/#12-행렬의-설계)
    * [12.1. 크기 변환행렬](README-ORIGIN.md/#121-크기-변환행렬)
    * [12.2. 회전 변환행렬](README-ORIGIN.md/#122-회전-변환행렬)
    * [12.3. 전단 변환행렬](README-ORIGIN.md/#123-전단-변환행렬)
    * [12.4. 삼각함수의 덧셈 정리](README-ORIGIN.md/#124-삼각함수의-덧셈-정리)
* [13. 역행렬](README-ORIGIN.md/#13-역행렬)
    * [13.1. 역행렬의 존재를 판별하는 행렬식](README-ORIGIN.md/#131-역행렬의-존재를-판별하는-행렬식)
    * [13.2. 크기 변환행렬의 역행렬](README-ORIGIN.md/#132-크기-변환행렬의-역행렬)
    * [13.3. 전단 변환행렬의 역행렬](README-ORIGIN.md/#133-전단-변환행렬의-역행렬)
    * [13.4. 회전 변환행렬의 역행렬](README-ORIGIN.md/#134-회전-변환행렬의-역행렬)
    * [13.5. 행렬 곱의 역행렬](README-ORIGIN.md/#135-행렬-곱의-역행렬)
* [14. 이동 변환을 위한 아핀 공간](README-ORIGIN.md/#14-이동-변환을-위한-아핀-공간)
* [15. 아핀 공간의 구성 요소](README-ORIGIN.md/#15-아핀-공간의-구성-요소)
    * [15.1. 점](README-ORIGIN.md/#151-점)
    * [15.2. 이동 벡터](README-ORIGIN.md/#152-이동-벡터)
    * [15.3. 아핀 공간의 성질](README-ORIGIN.md/#153-아핀-공간의-성질)
* [16. 아핀 결합](README-ORIGIN.md/#16-아핀-결합)
    * [16.1. 두 점의 결합](README-ORIGIN.md/#161-두-점의-결합)
* [17. 벡터의 내적](README-ORIGIN.md/#17-벡터의-내적)
    * [17.1. 내적의 성질](README-ORIGIN.md/#171-내적의-성질)
    * [17.2. 내적과 삼각함수의 관계](README-ORIGIN.md/#172-내적과-삼각함수의-관계)
    * [17.3. 행렬의 곱셈을 내적으로 표현하기](README-ORIGIN.md/#173-행렬의-곱셈을-내적으로-표현하기)
* [18. 시야 판별](README-ORIGIN.md/#18-시야-판별)
    * [18.1. 앞뒤 판별](README-ORIGIN.md/#181-앞뒤-판별)
    * [18.2. 시야 판별](README-ORIGIN.md/#182-시야-판별)
* [19. 조명 효과의 구현](README-ORIGIN.md/#19-조명-효과의-구현)
* [20. 투영 벡터](README-ORIGIN2.md/#20-투영-벡터)
* [21. 세 점의 결합](README-ORIGIN2.md/#21-세-점의-결합)
* [22. 메시](README-ORIGIN2.md/#22-메시)
* [23. 무게중심좌표](README-ORIGIN2.md/#23-무게중심좌표)
    * [23.1. 무게중심좌표의 계산](README-ORIGIN2.md/#231-무게중심좌표의-계산)
* [24. 텍스처 매핑](README-ORIGIN2.md/#24-텍스처-매핑)
* [25. 3차원 공간의 설계](README-ORIGIN2.md/#25-3차원-공간의-설계)
* [26. 3차원 공간의 트랜스폼](README-ORIGIN2.md/#26-3차원-공간의-트랜스폼)
    * [26.1. 오일러 각](README-ORIGIN2.md/#261오일러-각)
    * [26.2. 회전행렬의 유도](README-ORIGIN2.md/#262-회전행렬의-유도)
    * [26.3. 3차원 모델링 행렬](README-ORIGIN2.md/#263-3차원-모델링-행렬)
* [27. 카메라 공간](README-ORIGIN2.md/#27-카메라-공간)
* [28. 오일러 각의 특징](README-ORIGIN2.md/#28-오일러-각의-특징)
    * [28.1 짐벌락 현상](README-ORIGIN2.md/#281-짐벌락-현상)
    * [28.2 회전 보간의 계산](README-ORIGIN2.md/#282-회전-보간의-계산)
* [29. 벡터의 외적](README-ORIGIN2.md/#29-벡터의-외적)
    * [29.1. 평행성 판별](README-ORIGIN2.md/#291-평행성-판별)
    * [29.2. 법선 벡터](README-ORIGIN2.md/#292-법선-벡터)
    * [29.3. 좌우 방향 판별](README-ORIGIN2.md/#293-좌우-방향-판별)
* [30. 벡터로부터 회전행렬 생성](README-ORIGIN2.md/#30-벡터로부터-회전행렬-생성)
* [31. 렌더링 계산량을 줄여주는 백페이스 컬링](README-ORIGIN2.md/#31-렌더링-계산량을-줄여주는-백페이스-컬링)
* [32. 오일러 각의 문제를 해결하는 로드리게스 회전 공식](README-ORIGIN2.md/#32-오일러-각의-문제를-해결하는-로드리게스-회전-공식)
* [33. 삼중곱](README-ORIGIN2.md/#33-삼중곱)
    * [33.1. 스칼라 삼중곱](README-ORIGIN2.md/#331-스칼라-삼중곱)
    * [33.2. 벡터 삼중곱](README-ORIGIN2.md/#332-벡터-삼중곱)
* [34. 원근 투영 변환의 원리](README-ORIGIN2.md/#34-원근-투영-변환의-원리)
* [35. 동차 좌표계](README-ORIGIN2.md/#35-동차-좌표계)
* [36. 깊이 값](README-ORIGIN2.md/#36-깊이-값)
* [37. 원근 보정 매핑](README-ORIGIN2.md/#37-원근-보정-매핑)
* [38. 깊이 버퍼](README-ORIGIN2.md/#38-깊이-버퍼)
* [39. 절두체 컬링](#39-절두체-컬링)
    * [39.1. 평면의 방정식](#391-평면의-방정식)
    * [39.2. 평면의 방정식의 정규화](#392-평면의-방정식의-정규화)
    * [39.3. 평면의 방정식을 활용한 절두체 표현](#393-평면의-방정식을-활용한-절두체-표현)
    * [39.4. 원근 투영 행렬로부터 평면의 방정식 만들기](#394-원근-투영-행렬로부터-평면의-방정식-만들기)
* [40. 바운딩 볼륨](#40-바운딩-볼륨)
    * [40.1. 구 바운딩 볼륨의 판정](#401-구-바운딩-볼륨의-판정)
    * [40.2. aabb와의 판정](#402-aabb와의-판정)
* [41. 삼각형 클리핑](#41-삼각형-클리핑)
* [42. 복소수](#42-복소수)
    * [42.1. 허수](#421-허수)
    * [42.2. 복소수의 구조](#422-복소수의-구조)
* [43. 복소평면](#43-복소평면)
    * [43.1. 단위 복소수와의 곱](#431-단위-복소수와의-곱)
    * [43.2. 켤레 복소수의 회전 변환](#432-켤레-복소수의-회전-변환)
* [44. 복소수와 행렬의 관계](#44-복소수와-행렬의-관계)
* [45. 자연지수함수](#45-자연지수함수)
    * [45.1. 무리수 e](#451-무리수-e)
    * [45.2. 자연지수함수](#452-자연지수함수)
* [46. 미분](#46-미분)
    * [46.1. 도함수](#461-도함수)
    * [46.2. 자연지수함수의 도함수)](#462-자연지수함수의-도함수)
    * [46.3. sin 함수와 cos 함수의 도함수)](#463-sin-함수와-cos-함수의-도함수)
* [47. 급수](#47-급수)
    * [47.1. 등비수열](#471-등비수열)
    * [47.2. 급수](#472-급수)
    * [47.3. 매클로린 급수](#473-매클로린-급수)
* [48. 오일러 공식](#48-오일러-공식)
* [49. 사원수 대수](#49-사원수-대수)
    * [49.1. 사원수를 구성하는 세 허수](#491-사원수를-구성하는-세-허수)
    * [49.2. 사원수의 구조](#492-사원수의-구조)
    * [49.3. 사원수와 벡터](#493-사원수와-벡터)
* [50. 사원수의 회전](#50-사원수의-회전)
    * [50.1. 사원수와 오일러 공식](#501-사원수와-오일러-공식)
    * [50.2. 회전 사원수를 이용한 3차원 공간에서의 회전](#502-회전-사원수를-이용한-3차원-공간에서의-회전)
* [51. 사원수의 변환](#51-사원수의-변환)
    * [51.1. 오일러 각에서 사원수로의 변환](#511-오일러-각에서-사원수로의-변환)
    * [51.2. 사원수에서 오일러 각으로의 변환](#512-사원수에서-오일러-각으로의-변환)
    * [51.3. 사원수에서 회전 변환행렬로의 변환](#513-사원수에서-회전-변환행렬로의-변환)
    * [51.4. 회전 변환행렬에서 사원수로의 변환](#514-회전-변환행렬에서-사원수로의-변환)
* [52. 사원수의 보간](#52-사원수의-보간)

# 39. 절두체 컬링
게임 콘텐츠가 원활하게 동작하기 위해서는 사용자 입력에 따라 월드 공간에 놓인 물체들을 실시간으로 빠르게 그려내야 한다.  
가장 효과적인 방법은 시야에 보이는 물체만 그리는 것이다.    
이의 대표적인 기법으로는 ***벡터 외적을 활용한 백페이스 컬링***을 들 수 있다.

다수의 게임 오브젝트가 월드 공간에 넓게 퍼져 있는 경우, 카메라 시야 밖에 위치한 게임 오브젝트까지 모두 그리는 것은 비효율적인 작업이다.     
게임에서 그래픽을 구현할 때는 효과적인 렌더링을 위해 [그림 11-1](#그림-11-1-절두체를-구성하는-6개의-평면)의 절두체 영역에 속한 게임 오브젝트만 그린다.   
그렇다면 절두체의 영역 밖에 있는 게임 오브젝트를 파악하고 걸러내는 기능이 필요한데 이를 ***절두체 컬링(Frustum culling)*** 이라고 한다.

절두체 컬링은 [그림 11-1](#그림-11-1-절두체를-구성하는-6개의-평면)에서 절두체를 구성하는 6개의 평면에 대해 각각 평면의 방정식을 세우고, 평면의 방정식을 활용해 대상 게임 오브젝트의 위치가 평면의 바깥에 있는지 확인하는 절차로 진행된다.    
만일 ***게임 오브젝트가 6개의 평면 중 하나라도 바깥쪽에 위치해 있다면 그리기에서 제외된다***.

###### 그림 11-1 절두체를 구성하는 6개의 평면
![절두체를 구성하는 6개의 평면](/img/)

# 39.1. 평면의 방정식
절두체 컬링을 구현하기에 앞서 절두체를 구성하는 평면의 방정식을 알아야한다.     
세 점이 주어지면 세 점으로부터 두 벡터를 생성해 평면 상의 모든 점을 생성할 수 있다.     
그렇기에 ***하나의 평면을 정의하려면 최소 3개의 점이 필요하다***.     
***3차원 공간의 평면은 앞면과 뒷면이 존재***하기 때문에, 이를 구분할 수 있는 정보도 있어야 한다.

그래서 평면을 정의할 때는 [그림 11-2](#그림-11-2-평면을-이루는-최소-구성-요소)의 (a)와 같이 세 점의 정보를 사용하기보다 (b)에서 제시하는 것처럼 평면이 바라보는 방향을 알려주는 법선 벡터와 평면 상에 위치한 한 점을 제공하는 방법을 사용한다.   
이때 법선 벡터는 크기를 1로 정규화시키는 것이 일반적이다.

###### 그림 11-2 평면을 이루는 최소 구성 요소
![평면을 이루는 최소 구성 요소](/img/)

평면이 향하는 방향을 나타내는 법선 벡터 $\hat{n}$의 값이 $(a, b, c)$로 주어지면, 크기가 1이므로 $a^2 + b^2 + c^2 = 1$의 조건이 성립한다.    
평면에 위치한 임의의 점 $P_0(x_0, y_0, z_0)$의 값이 주어졌다고 가정한다.     
이 두 요소는 3차원 공간에서 평면을 정의할 때 최소로 주어지는 값이다.    
이 상황에서 임의의 점 $P(x, y, z)$가 같은 평면 위에 있을 조건을 생각해보자.

평면의 방향을 나타내는 법선 벡터와 평면 위의 두 점을 지나는 벡터는 서로 직교하기 때문에 두 벡터의 내적은 0이 된다.  
따라서 법선 벡터 $\hat{n}$와 점 $P_0$에서 점 $P$로 향하는 벡터를 내적하면 다음 수식이 성립한다.

###### 식 11-1

$$
\begin{matrix}
\hat{n} \cdot (P - P_0) &=& (a, b, c) \cdot (x - x_0, y - y_0, z - z_0) = 0 \\
&=& ax + by + cz - (ax_0 + by_0 + cz_0) = 0 \\
\end{matrix}
$$

법선 벡터 $(a, b, c)$와 평면의 점 $(x_0, y_0, z_0)$는 사전에 주어진 값이므로 $-(ax_0 + by_0 + cz_0)$는 미리 계산할 수 있는 상수 값이다.  
이를 간단히 $d$로 치환한다.     
[식 11-1](#식-11-1)은 다음과 같이 간략하게 표시할 수 있는데, 이를 ***평면의 방정식(The equation of plane)*** 이라고 한다.

###### 식 11-2

$$ax + by + cz + d = 0$$

이렇게 유도한 평면의 방정식을 실제로 활용하는 데에는 마지막 상수 $d$가 가지는 의미를 파악해 두면 여러모로 유용하다.     

$$d = -(ax_0 + by_0 + cz_0)$$

상수 $d$는 법선 벡터 $(a, b, c)$와 벡터 $(x_0, y_0, z_0)$와의 내적에 음의 부호를 설정한 결과로 볼 수 있다.

$$d = -\hat{n} \cdot (x_0, y_0, z_0)$$

$(x_0, y_0, z_0)$는 점 $P_0$의 좌표지만, 이는 원점 $O$에서 점 $P_0$로 향하는 벡터의 값으로도 사용할 수 있다.    
이를 $\vec{p}$로 표시한다.      
위 공식을 정리하면 다음과 같다.

$$d = -\hat{n} \cdot \overline{OP_0} = -\hat{n} \cdot \vec{p}$$

상수 $d$에 관련된 두 벡터 $\hat{n}$과 $\vec{p}$를 시각화하면 [그림 11-3](#그림-11-3-d를-계산하기-위한-평면의-구성-요소)과 같다.

###### 그림 11-3 d를 계산하기 위한 평면의 구성 요소
![d를 계산하기 위한 평면의 구성 요소](/img/)

$\hat{n} \cdot \vec{p}$는 벡터 내적의 $\cos$ 공식으로 표현할 수 있다.

$$\hat{n} \cdot \vec{p} = |\hat{n}||\vec{p}|\cos \theta$$

현재 법선 벡터의 크기는 항상 1이므로 이 공식은 다음과 같이 간단히 정리된다.

$$\hat{n} \cdot \vec{p} = |\vec{p}|\cos \theta$$

$\hat \cdot \vec{p}$는 [그림 11-4](#그림-11-4-상수-d와-관련된-두-벡터-내적의-의미)와 같이 $\vec{p}$ 벡터를 법선 벡터 $\hat{n}$에 투영한 벡터의 크기를 의미한다.

###### 그림 11-4 상수 d와 관련된 두 벡터 내적의 의미
![상수 d와 관련된 두 벡터 내적의 의미](/img/)

평면과 법선 벡터는 서로 직교하기 때문에 방금 구한 $\hat{n} \cdot \vec{p}$의 값은 원점에서 평면까지의 최단 거리를 의미한다.  
$d$의 값은 $\hat{n} \cdot \vec{p}$가 아닌 $-\hat{n} \cdot \vec{p}$이므로 원점으로부터 평면의 최단 거리에 음의 부호를 설정한다는 특징을 가진다.      
***거리라는 측정값은 음수가 나올 수 없기 때문에*** $d$의 값은 ***원점으로부터의 최단 거리와 방향이라는 두 가지 정보를 담고 있다***.

***내적의 성질에 의해 두 벡터가 같은 방향을 바라보면 +값이 나오고, 반대 방향을 바라보면 -값이 나온다***.      
$d$의 값이 음수라면 두 벡터 $\hat{n}$과 $\vec{p}$는 같은 방향을 바라보고 있다는 의미다.

[그림 11-5](#그림-11-5-평면이-반대-방향을-향하는-경우)와 같이 평면이 원점을 향하는 반대의 경우를 가정한다.

###### 그림 11-5 평면이 반대 방향을 향하는 경우
![평면이 반대 방향을 향하는 경우](/img/)

평면이 원점을 향한다면 두 벡터는 서로 마주보는 상황이므로 내적의 값은 음수가 되고, $d$의 값은 반대 부호인 양수가 나온다.    
따라서 평면의 방정식 $d$의 값에 따라 평면이 가지는 두 가지 성질을 파악할 수 있다.

- $d$의 부호: $d$의 값이 양수면 평면이 바라보는 방향은 원점을 향하고, 음수면 원점에서 멀어지는 방향을 가진다.   
다시 말해 $d$의 값이 양수면 원점은 평면의 바깥에 위치하고, 음수면 원점은 평면의 안쪽에 위치한 것이다.
- $d$의 절댓값: 평면에서 원점까지의 최단 거리를 의미한다.

$d$의 정보는 평면의 방정식을 설계하는 데 큰 도움이 된다.    
예를 들어 [그림 11-6](#그림-11-6-원점을-품는-평면의-방정식)과 같이 평면이 원점을 품는다면 원점으로부터 거리 $d$의 값은 부호에 관계없이 없제나 0이 나오기 때문에 평면의 법선 벡터 값을 사용해 바로 $ax + by + cz = 0$이라는 평면의 방정식을 얻을 수 있다.

###### 그림 11-6 원점을 품는 평면의 방정식
![원점을 품는 평면의 방정식](/img/)

평면의 방정식을 구성하는 $d$ 값의 성질을 응용하면 주어진 점이 평면의 안쪽에 있는지 바깥쪽에 있는지도 판별할 수 있다.    
[그림 11-7](#그림-11-7-점의-내부-외부-판별)과 같은 상황을 생각해보자.

###### 그림 11-7 점의 내부 외부 판별
![점의 내부 외부 판별](/img/)

만일 임의의 점 $P$가 있을 때, 원점에서 점 $P$로 향하는 벡터 $\vec{OP}$를 법선 벡터에 내적한 값을 $p$ 표기한다.  
$p$의 부호를 통해 법선 벡터에 투영한 벡터 $\vec{OP'}$의 방향 정보를 파악할 수 있다.     
$p$가 양수면 벡터 $\vec{OP'}$는 법선 벡터와 같은 방향을 향하고, 음수면 법선 벡터와 반대 방향을 향한다.  
따라서 [그림 11-7](#그림-11-7-점의-내부-외부-판별)의 상황에서 $p$는 양수다.

$p$와 평면의 방정식의 상수 $d$를 서로 더한 값을 살펴보자.   
[그림 11-7](#그림-11-7-점의-내부-외부-판별)에서 원점이 평면 안쪽에 있으므로 $d$값은 음수다.     
음수 $d$에 양수인 $p$를 더한 값이 여전히 음수라면, 점 $P$는 평면의 안쪽에 있다고 판단할 수 있다.    
반대로 $p$와 $d$를 더한 값이 양수면 점 $P$는 평면의 바깥쪽에 있다고 판단할 수 있다.

법선 벡터가 반대인 [그림 11-8](#그림-11-8-법선-벡터가-반대-방향인-경우)인 경우에도 이 규칙은 동일하다.   
이 상황에서는 $d$값은 양수가 되고 $p$는 음수가 된다.    
$d$와 $p$를 더한 결과가 여전히 양수라면 이는 점 $P$가 평면의 바깥쪽에 있음을 의미한다.

###### 그림 11-8 법선 벡터가 반대 방향인 경우
![법선 벡터가 반대 방향인 경우](/img/)

따라서 법선 벡터 $(a, b, c)$와 $d$를 사용해 정의한 평면에 주어진 점 $P(x_1, y_1, z_1)$가 평면의 바깥쪽에 있는지를 판단하는 수식은 다음과 같다.

$$(a, b, c) \cdot (x_1, y_1, z_1) + d > 0$$

이때 $(a, b, c) \cdot (x_1, y_1, z_1) + d$의 값에 절댓값을 취하면 이는 평면에서 해당 점까지의 최단 거리를 의미한다.

###### 식 11-3

$$distance = |(a, b, c) \cdot (x_1, y_1, z_1) + d|$$

# 39.2. 평면의 방정식의 정규화
평면의 방정식에서 알아둬야 할 점은 평면의 방정식도 정규화시킬 수 있다는 점이다.     
크기가 1이 아닌 법선 벡터 $\vec{n}$이 만들어내는 평면의 방정식이 다음과 같이 주여졌다고 가정한다.

$$ax + by + cz + d = 0$$

이를 크기가 1인 법선 벡터로부터 만들어지는 평면의 방정식으로 바꿔야 한다.   
크기가 1인 법선 벡터 $\vec{n}$의 값을 $(a', b', c')$로 지정하면 평면의 방정식은 다음과 같다.

$$a'x + b'y + c'z + d' = 0$$

크기가 1이 아닌 주어진 법선 벡터를 구성하는 세 계수 $(a, b, c)$를 정규화해 $(a', b', c')$로 만드는 수식은 법선 벡터의 크기 $|\vec{n}|$으로 나누면 구할 수 있다.

$$(a', b', c') = \frac{\vec{n}}{|\vec{n}|} = \frac{\vec{n}}{\sqrt{a^2 + b^2 + c^2}} = \frac{(a, b, c)}{\sqrt{a^2 + b^2 + c^2}}$$

법선 벡터의 크기가 1일 때 평면의 방정식 값이 $d'$라면 마지막 계수 $d$를 $d'$로 변경하는 수식을 생각해야 한다.   
마지막 계수 $d$는 평면 위의 한 점으로 향하는 벡터 $\vec{p}$와 평면의 법선 벡터 $\hat{n}$을 내적한 값의 반대수를 의미한다.

$$d = -\vec{n} \cdot \vec{p} = -|\vec{n}||\vec{p}|\cos \theta$$

법선 벡터의 크기가 1일 때 평면의 방정식 값 $d'$는 다음과 같다.

$$d' = -|\vec{p}|\cos \theta$$

이로써 $d$와 $d'$의 관계는 다음과 같이 정리된다.

$$d' = \frac{d}{|\vec{n}|}$$

그렇기 때문에 $d$의 경우에도 동일하게 법선 벡터의 크기 $|\vec{n}|$으로 나누면 원하는 값 $d'$를 얻을 수 있다.

###### 식 11-4

$$\frac{ax + by + cz + d}{\sqrt{a^2 + b^2 + c^2}} = 0$$

임의의 네 수로부터 평면의 방정식을 구성한다면 [식 11-4](#식-11-4)를 사용해 평면의 방정식을 정규화시켜주는 것이 이후에 평면의 방정식을 활용할 때 더 편리하다.     
정규화된 평면의 방정식의 $d$값은 원점으로부터의 최단 거리 정보를 담고 있기 때문이다.

> 참고: ***2차원 직선의 방정식에서의 최단 거리***   
평면의 방정식은 내적에 기반을 두기 때문에 2차원 공간에서도 동일하게 활용할 수 있다.     
3차원 공간의 평면이 앞면과 뒷면을 가진 것처럼, 2차원 공간의 직선도 앞쪽과 뒤쪽을 가진다.    
2차원 공간에서의 직선의 방정식이 $ax + by + c = 0$이라고 할 때, 여기서 법선 벡터 $(a, b)$의 크기가 1이면 상수 $c$의 절댓값은 원점에서 직선까지의 최단 거리를 의미한다.  
만약 법선 벡터 $(a, b)$의 크기가 1이 아니라면 원점에서 직선까지의 최단 거리는 다음과 같다.
>
> $$\frac{|c|}{\sqrt{a^2 + b^2}}$$
>
> [그림 11-9](#그림-11-9-직선과-점-사이의-최단-거리)와 같은 임의의 한 점 $(x_1, y_1)$에서 임의의 직선 $ax + by + c = 0$까지의 최단 거리는 [식 11-3](#식-11-3)을 참고해 평면의 방정식을 정규화한 값과 내적을 활용해 다음과 같이 구할 수 있다.
>
> ###### 그림 11-9 직선과 점 사이의 최단 거리
> ![직선과 점 사이의 최단 거리](/img/)

# 39.3. 평면의 방정식을 활용한 절두체 표현
절두체를 구성하는 6개의 평면에 대한 방정식을 직접 계산하고 이를 활용해 ***카메라 시야 영역에서 벗어난 게임 오브젝트들을 솎아내는 기능인 절두체 컬링***을 구현할 수 있다.  

###### 그림 11-10 절두체의 y축 상단 평면
![절두체의 y축 상단 평면](/img/)

[그림 10-16](#그림-10-16-카메라에-설정한-절두체)을 참고해 절두체 상단 평면을 무한하게 확장하면 상단 평면은 원점을 품게 된다.    
이는 근평면과 원평면을 제외한 나머지 평면에 대해서도 동일하다.  
그렇다면 근평면과 원평면을 제외한 네 평면을 구성하는 평면의 방정식의 $d$값은 0이므로 크기가 1인 법선 벡터만 구하면 근평면과 원평면을 제외한 평면의 방정식을 얻을 수 있다.   
뷰 공간의 측면에서 절두체를 투영한 모습은 [그림 11-11](#그림-11-11-절두체-상단-평면의-법선-벡터를-구하는-과정)과 같이 그려진다.

###### 그림 11-11 절두체 상단 평면의 법선 벡터를 구하는 과정
![절두체 상단 평면의 법선 벡터를 구하는 과정](/img/)

측면에서 바라본 평면의 좌표계에서 오른쪽 방향은 뷰 공간의 $-z$축에 대응되고 위쪽 방향은 $y$축에 대응된다.   
평면에서 오른쪽을 향하는 $(0, 0, -1)$의 벡터를 반시계 방향으로 $\frac{\theta}{2}$만큼 회전한 결과는 $(0, \sin\frac{\theta}{2}, -\cos\frac{\theta}{2})$가 된다.  
평면의 법선 벡터는 여기서 $90^\circ$만큼 더 회전한 값이므로 $y$값과 $z$값을 교차시키고 $y$값에 반대 부호를 취하면 얻을 수 있다.     
이를 적용한 법선 벡터는 다음과 같다.

$$\hat{n} = (0, \cos \frac{\theta}{2}, \sin \frac{\theta}{2})$$

$d$값은 0이므로 절두체 상단을 구성하는 평면의 방정식은 다음과 같다.

###### 식 11-5

$$\cos \frac{\theta}{2}y + \sin \frac{\theta}{2}z = 0$$

이와 유사한 방식으로 나머지 세 평면의 방정식을 구하면 다음과 같다.

- 절두체 하단 평면의 방정식: $-\cos\frac{\theta}{2}y + \sin\frac{\theta}{2}z = 0$
- 절두체 좌측 평면의 방정식: $-\cos\frac{\theta}{2}x + \sin\frac{\theta}{2}z = 0$
- 절두체 우측 평면의 방정식: $\cos\frac{\theta}{2}x + \sin\frac{\theta}{2}z = 0$

원점을 지나는 평면의 방정식 4개를 구했다면 나머지 근평면과 원평면의 방정식을 구한다.    
근평면은 [그림 11-12](#그림-11-12-근평면의-특징)에서 보듯이 원점을 향하고 있으며 원점으로부터의 거리는 $n$이므로 평면의 방정식의 $d$ 값은 $n$이 된다.  
그리고 근평면의 법선 벡터의 값은 $(0, 0, 1)$이다.

###### 그림 11-12 근평면의 특징
![근평면의 특징](/img/)

근평면의 방정식은 다음과 같이 구할 수 있다.

$$(0, 0, 1) \cdot (x, y, z) - (0, 0, 1) \cdot (0, 0, -n) = 0$$

$$\therefore z + n = 0$$

원평면의 법선 벡터는 근평면에 반대 방향인 원점에서 멀어지는 $(0, 0, -1)$이며, 원점으로부터의 거리는 $f$가 된다.     
따라서 원평면의 방정식은 다음과 같이 계산된다.

$$(0, 0, -1) \cdot (x, y, z) - (0, 0, 1) \cdot (0, 0, f) = 0$$

$$\therefore -z - f = 0$$

평면의 방정식을 다룰 때 주의할 점은 방향 정보가 수록되어 있기 때문에 함부로 수식을 옮기면 안 된다는 것이다.     
원평면의 방정식의 변을 옮기면 다음과 같은 방정식이 나온다.

$$0 = z + f$$

이 방정식으로 만들어지는 평면이 놓인 위치는 원평면과 동일하지만, 평면의 방향은 원평면의 반대 방향인 원점을 향한다.      
따라서 $z + f = 0$과 $-z - f = 0$은 서로 다른 평면이라는 점에 주의해야 한다.

# 39.4. 원근 투영 행렬로부터 평면의 방정식 만들기
***원근 투영 행렬을 활용해 절두체 컬링을 좀 더 간편하게 구현할 수 있다***.    
뷰 공간의 점이 NDC 좌표까지 변환됐을 때 NDC 좌표를 구성하는 $x, y, z$ 세 축의 값이 $[-1, 1]$ 범위에 있다면 해당 점은 절두체 영역 안쪽에 있음을 의미한다.

NDC 좌푯값을 $(n_x, n_y, n_z)$으로 표기했을 때 이를 수식으로 표현하면 다음과 같다.

$$-1 \leq n_x \leq 1$$

$$-1 \leq n_y \leq 1$$

$$-1 \leq n_z \leq 1$$

이 조건에서 변환 과정을 거꾸로 추적해 수식을 발전시키면, NDC 좌표는 클립 좌표의 마지막 차원 $w$로 나눈 결괏값이므로, 위 수식을 클립 좌표 $(x, y, z, w)$로 바꿔 쓰면 다음과 같다.

$$-1 \leq \frac{x}{w} \leq 1$$

$$-1 \leq \frac{y}{w} \leq 1$$

$$-1 \leq \frac{z}{w} \leq 1$$

위 식의 양변에 $w$를 곱하면 다음과 같이 정리된다.

###### 식 11-6

$$-w \leq x \leq w$$

$$-w \leq y \leq w$$

$$-w \leq z \leq w$$

이 상황에서 거꾸로 뷰 공간에서 클립 공간으로 변환한 과정은 뷰 공간의 점 $\vec{v}$를 $(v_x, v_y, v_z, 1)$로 지정한 후에, ***원근 투영 행렬을 사용해 클립 좌표로 변환***하는 수식을 확인할 수 있다.

$$P \cdot \vec{v} = 
\begin{bmatrix}
\frac{d}{a} & 0 & 0 & 0 \\
0 & d & 0 & 0 \\
0 & 0 & \frac{n + f}{n - f} & \frac{2nf}{n - f} \\
0 & 0 & -1 & 0 \\
\end{bmatrix}
\begin{bmatrix}
v_x \\
v_y \\
v_z \\
1 \\
\end{bmatrix} = 
\begin{bmatrix}
x \\
y \\
z \\
w \\
\end{bmatrix}
$$

원근 투영행렬을 $P_{row1}$부터 $P_{row4}$까지 4개의 행벡터로 표현하면 위 연산은 행벡터와 점의 내적으로 바꿔 쓸 수 있다.

$$
\begin{bmatrix}
P_{row1} \cdot \vec{v} \\
P_{row2} \cdot \vec{v} \\
P_{row3} \cdot \vec{v} \\
P_{row4} \cdot \vec{v} \\
\end{bmatrix} = 
\begin{bmatrix}
x \\
y \\
z \\
w \\
\end{bmatrix}
$$

그러면 클립 공간의 각 요소는 행벡터와 점의 내적으로 표현된다.

$$x = P_{row1} \cdot \vec{v}$$

$$y = P_{row2} \cdot \vec{v}$$

$$z = P_{row3} \cdot \vec{v}$$

$$w = P_{row4} \cdot \vec{v}$$

[식 11-6](#식-11-6)의 부등식을 구성하는 $x, y, z, w$를 내적으로 치환하면 다음과 같이 전개된다.

$$-P_{row4} \cdot \vec{v} \leq P_{row1} \cdot \vec{v} \leq P_{row4} \cdot \vec{v}$$

$$-P_{row4} \cdot \vec{v} \leq P_{row2} \cdot \vec{v} \leq P_{row4} \cdot \vec{v}$$

$$-P_{row4} \cdot \vec{v} \leq P_{row3} \cdot \vec{v} \leq P_{row4} \cdot \vec{v}$$

위 식을 분리해 총 6개의 부등식으로 표현하면 다음과 같다.

$$(P_{row4} + P_{row1}) \cdot \vec{v} \geq 0$$

$$(P_{row4} - P_{row1}) \cdot \vec{v} \geq 0$$

$$(P_{row4} + P_{row2}) \cdot \vec{v} \geq 0$$

$$(P_{row4} - P_{row2}) \cdot \vec{v} \geq 0$$

$$(P_{row4} + P_{row3}) \cdot \vec{v} \geq 0$$

$$(P_{row4} - P_{row3}) \cdot \vec{v} \geq 0$$

6개의 부등식이 모두 참이면, 뷰 공간의 점 $\vec{v}$는 절두체 영역의 내부에 있음을 의미하고, 하나라도 만족하지 못하면 절두체 영역의 외부에 있음을 의미한다.   
괄호 안의 원근 투영 행렬의 행벡터를 계산한 4차원 벡터를 $(a, b, c, d)$로 표시했을 때 이를 뷰 공간의 점 $(x, y, z, 1)$과 내적한 결과는 다음과 같다.

$$ax + by + cz + d \geq 0$$

이는 ***평면의 방정식과 형태가 동일***하다.   
하지만 이 식에서 만들어지는 법선 벡터 $(a, b, c)$의 크기는 1이 아니므로 [식 11-4](#식-11-4)에 따라 이를 ***정규화된 평면의 방정식으로 변환***한다.

$$\frac{ax + by + cz + d}{\sqrt{a^2 + b^2 + c^2}} = 0$$

이와 같은 과정을 거쳐 구한 평면의 방향은 모두 절두체 내부를 향한다.     
절두체 컬링을 구현할 때는 해당 점이 외부에 있는지를 파악하는 수식이 필요하다.   
따라서 위에서 만든 평면이 절두체 외부를 향하도록 부호를 반전시킨다.

$$-(\frac{ax + by + cz + d}{\sqrt{a^2 + b^2 + c^2}}) = 0$$

이제 평면 밖에 위치한 상황만 검출해야 하므로 등호 대신 부등호로 교체하면 다음의 수식이 완성된다.

$$-(\frac{ax + by + cz + d}{\sqrt{a^2 + b^2 + c^2}}) > 0$$

> 참고: ***행렬로 만들어낸 평면의 방정식 검증***    
행렬로부터 만들어낸 평면의 방정식이 절두체의 성질로부터 구축한 평면의 방정식과 실제로 일치하는지 확인해 보자.
>
> $$P = 
\begin{bmatrix}
\frac{d}{a} & 0 & 0 & 0 \\
0 & d & 0 & 0 \\
0 & 0 & \frac{n + f}{n - f} & \frac{2nf}{n - f} \\
0 & 0 & -1 & 0 \\
\end{bmatrix}$$
> 
> 절두체 상단에 해당하는 벡터는 네 번째 행벡터 $(0, 0, -1, 0)$와 두 번째 행벡터 $(0, d, 0, 0)$를 빼서 얻을 수 있다.     
이를 내적해 얻는 평면의 방정식을 정규화시켜 전개한다.
>
> $$
\begin{matrix}
(P_{row4} - P_{row2}) \cdot v &=& ((0, 0, -1, 0) - (0, d, 0, 0)) \cdot (x, y, z, 1) = 0 \\
&=& (0, -d, -1, 0) \cdot (x, y, z, 1) = 0 \\
&=& -dy - z = 0 \\
&=& -\frac{1}{\tan\frac{\theta}{2}}y - z = 0 \\
&=& -\frac{\cos\frac{\theta}{2}}{\sin\frac{\theta}{2}}y - z = 0 \\
&=& -\cos\frac{\theta}{2}y - \sin\frac{\theta}{2}z = 0 \\
\end{matrix}$$
>
> $d$는 초점 거리를 의미하므로 이를 $\frac{1}{\tan\frac{\theta}{2}}$로 치환해 전개한다.     
$\tan\frac{\theta}{2}$를 $\frac{\sin\frac{\theta}{2}}{\cos\frac{\theta}{2}}$로 치환해 전개한다.     
양변에 $\sin\frac{\theta}{2}$를 곱한다.     
이렇게 만들어진 평면의 법선 벡터 $(0, -\cos\frac{\theta}{2}, -\sin\frac{\theta}{2})$의 크기는 1이므로 이는 유효한 평면의 방정식임을 알 수 있다.
>
> 위에서 유도한 평면의 방정식 $-\cos\frac{\theta}{2}y - \sin\frac{\theta}{2}z = 0$은 절두체 안쪽을 향한다.  
따라서 부호를 반전시켜 절두체 바깥쪽을 향하는 평면의 방정식 $\cos\frac{\theta}{2}y + \sin\frac{\theta}{2}z = 0$은 [식 11-5](#식-11-5)와 동일함을 확인할 수 있다.

# 40. 바운딩 볼륨
절두체 컬링만으론 카메라를 움직일 때 화면 가장자리에 있는 게임 오브젝트가 갑자기 사라지거나 튀어나오는 현상이 발생한다.     
화면 가장자리에서 튀는 현상이 발생하는 이유는 ***게임 오브젝트의 메시가 차지하는 공간 영역이 있음에도 불구하고 게임 오브젝트의 기준 위치만 가지고 절두체 컬링을 수행했기 때문***이다.

예를 들어 [그림 11-13](#그림-11-13-절두체에-걸쳐져-있지만-절두체-컬링에-의해-그리기에서-제거된-게임-오브젝트의-예시)과 같은 상황이 발생하면 기존 절두체 컬링 로직에서는 게임 오브젝트의 위치가 절두체 바깥에 있다고 판단해 그리기를 건너뛸 것이다.     
하지만 이 게임 오브젝트는 절두체 영역에 걸쳐 있기 때문에 그려줘야 한다.

###### 그림 11-13 절두체에 걸쳐져 있지만 절두체 컬링에 의해 그리기에서 제거된 게임 오브젝트의 예시
![절두체에 걸쳐져 있지만 절두체 컬링에 의해 그리기에서 제거된 게임 오브젝트의 예시](/img/)

이 문제를 해결하기 위해서는 게임 오브젝트의 위치를 대상으로 하지 않고, ***메시가 차지하는 영역을 감안해 절두체 컬링을 진행***해야 한다.   
게임 엔진은 메시가 차지하는 영역을 효과적으로 관리하기 위해 ***구(Sphere)*** 나 ***박스(Box)*** 같은 ***원시 도형(Primitive shape)*** 을 사용하는데, 이러한 원시 도형으로 설정한 공간 데이터를 ***바운딩 볼륨(Bounding volume)*** 이라고 한다.

[그림 11-14](#그림-11-14-언리얼-엔진에서-설정한-메시의-바운딩-볼륨)는 언리얼 엔진에서 관리하는 메시의 바운딩 볼륨에 대한 정보다.   
메시를 감싸는 노란색의 구와 파란색의 박스가 설정돼 있다.

###### 그림 11-14 언리얼 엔진에서 설정한 메시의 바운딩 볼륨
![언리얼 엔진에서 설정한 메시의 바운딩 볼륨](/img/)

# 40.1. 구 바운딩 볼륨의 판정
바운딩 볼륨에서 손쉽게 사용되는 원시 도형은 ***구(Sphere)*** 다.   
***구는 두 영역이 서로 겹치는지, 떨어져 있는지를 가장 쉽고 빠르게 파악할 수 있는 도형***이기 때문이다.    
어떤 점이 구의 외부에 있는지 여부를 파악하는 방법은 [그림 11-15](#그림-11-15-구를-이용한-빠르고-손쉬운-영역-판별법)의 (a)와 같이 구의 중점에서부터 점까지의 거리와 구의 반지름의 크기를 비교하는 것이다.

$$d > r_1$$

또한 두 구의 영역이 서로 떨어져 있는지 여부는 [그림 11-15](#그림-11-15-구를-이용한-빠르고-손쉬운-영역-판별법)의 (b)와 같이 ***두 구의 중점 간의 거리와 두 구의 반지름을 더한 값을 비교***하는 것만으로 쉽게 파악할 수 있다.

$$d > (r_1 + r_2)$$

###### 그림 11-15 구를 이용한 빠르고 손쉬운 영역 판별법
![구를 이용한 빠르고 손쉬운 영역 판별법](/img/)

메시에 구 바운딩 볼륨을 추가하면 구의 반지름 정보를 사용해 [그림 11-16](#그림-11-16-절두체-영역과-메시에-설정한-구-영역의-비교)과 같이 ***메시 영역이 절두체 영역의 안쪽에 있는지, 겹치는지, 벗어나는지를 파악***할 수 있다.

###### 그림 11-16 절두체 영역과 메시에 설정한 구 영역의 비교
![절두체 영역과 메시에 설정한 구 영역의 비교](/img/)

앞서 구했던 [식 11-3](#식-11-3)을 활용했을 때 구의 중점 좌표와 평면의 방정식의 법선 벡터 $(a, b, c)$와의 내적 값에 $d$값을 더한 값이 0보다 크다면 구는 평면의 바깥쪽에 위치한다는 의미다.  
이 값이 구의 반지름 $r$보다 더 크다면 해당 구의 영역은 평면으로부터 완전히 벗어난다.    
이런 경우에는 게임 오브젝트를 그리지 않도록 처리해야 한다.  
평면으로부터의 거리에 해당하는 [식 11-3](#식-11-3)의 값이 구의 반지름 $r$보다 작거나 같으면 구 영역은 절두체의 평면과 겹쳐져 있다고 판단할 수 있다.     
나머지 경우에는 절두체 안쪽에 위치해 있다고 판단하면 된다.      

# 40.2. AABB와의 판정
구 영역 대신 ***박스(Box)*** 영역을 사용해서 좀 더 정교한 절두체 컬링 작업을 수행할 수 있다.  
이를 위해서 메시 데이터로부터 박스 영역을 생성하는 방법을 알아야 하는데, 먼저 박스 영역을 구성하는 각 축의 최댓값과 최솟값을 설정하고, 메시를 구성하는 점을 순회하면서 각 차원의 값을 비교한다.     
현재 박스 영역에 저장된 최댓값보다 크거나 최솟값보다 작다면 박스 영역의 최댓값과 최솟값을 갱신해준다.   
모든 점에 대해 이 과정을 거치면 기저 축에 평행한 박스 영역이 형성되는데, 기저 축에 정렬되어 있다는 의미로 해당 바운딩 볼륨을 ***AABB(Axis aligned bounding box)*** 라고 부른다.    
[그림 11-14](#그림-11-14-언리얼-엔진에서-설정한-메시의-바운딩-볼륨)에서 파란색으로 표시된 바운딩 볼륨 영역이 AABB다.

로컬 공간에서 생성한 AABB 영역과 평면과의 판정은 어떻게 진행하는지 알아보자.    
[그림 11-17](#그림-11-17-법선-벡터의-부호에-따른-aabb의-비교-판정)의 (a)와 같이 평면의 법선 벡터의 모든 요소가 양수인 상황에서 AABB 영역이 평면의 바깥에 위치해 있다고 가정한다.    
이 상황에서 평면과 가장 가까운 AABB 영역의 점은 AABB의 최솟값이다.      
그렇다면 AABB 영역의 최솟값과 평면과의 차이를 측정하는 값은 양수가 나온다.      
반대로 [그림 11-17](#그림-11-17-법선-벡터의-부호에-따른-aabb의-비교-판정)의 (b)와 같이 평면의 법선 벡터의 모든 요소가 음수인 상황에서는, 평면과 가장 가까운 AABB 영역의 점은 최댓값이고, 최댓값과 평면과의 차이를 측정하는 값 또한 양수가 나온다.

###### 그림 11-17 법선 벡터의 부호에 따른 AABB의 비교 판정
![법선 벡터의 부호에 따른 AABB의 비교 판정](/img/)

AABB 영역과 법선 벡터의 $x, y, z$축은 서로 직교하고 있으므로 각 축의 데이터는 독립적으로 동작한다.      
따라서 ***각 법선 벡터의 요소마다 양수인 경우에는 해당 요소의 최솟값을, 음수인 경우에는 해당 요소의 최댓값을 사용하는 것으로 평면에서 가장 가까운 AABB의 점을 구할 수 있다***.    
예를 들어 [그림 11-18](#그림-11-18-한-쪽만-양수인-경우의-판정-방법)과 같이 $x$축과 $z$축의 법선 벡터가 음수고 $y$축만 양수라면 평면과 가장 가까운 AABB의 좌표는 $(Max, Min, Max)$가 된다.

###### 그림 11-18 한 쪽만 양수인 경우의 판정 방법
![한 쪽만 양수인 경우의 판정 방법](/img/)

***평면에서 가장 가까운 AABB의 좌표와 평면과의 차이를 측정했을 때 그 값이 양수가 나온다면, AABB 영역은 완전히 평면의 바깥에 위치해 있다고 판정할 수 있다***.

AABB 영역이 절두체의 평면과 교차되는 경우를 어떻게 판별할지 생각해보자.     
평면에서 가장 가까운 AABB의 좌표와 평면과의 차이를 측정한 값이 음수가 나오는 경우, ***평면에서 가장 가까운 AABB의 좌표와 정반대에 위치한 점으로 다시 평면과의 테스트를 진행해 평면과의 교차 여부를 확인***한다.   
***정반대에 위치한 점과 절두체 평면과의 차이를 측정한 값이 양수가 나오면*** [그림 11-19](#그림-11-19-aabb-영역과-평면이-교차하는-경우)와 같이 ***절두체 영역과 AABB 영역은 서로 교차한다***.

###### 그림 11-19 AABB 영역과 평면이 교차하는 경우
![AABB 영역과 평면이 교차하는 경우](/img/)

# 41. 삼각형 클리핑
동차 좌표계에서 물체가 깨지는 현상을 알아보기 위해 [그림 11-20](#그림-11-20-카메라-바로-아래에-거대한-사각형-메시가-위치한-경우)과 같이 거대한 삼각형을 카메라의 앞뒤에 배치한다.

###### 그림 11-20 카메라 바로 아래에 거대한 사각형 메시가 위치한 경우
![카메라 바로 아래에 거대한 사각형 메시가 위치한 경우](/img/)

[그림 11-21](#그림-11-21-카메라-뒤에-위치한-점을-거꾸로-투영하는-경우의-문제)과 같이 대형 삼각형을 구성하는 세 점 중에서 한 점이 카메라 뒤쪽에 위치하는 경우를 생각해보자.   
이를 투영하면 카메라 뒤쪽에 위치한 점은 무한 원점을 중심으로 뒤집혀 투영된다.

따라서 뒤집혀 투영된 점을 사용해 그대로 삼각형을 그리면 엉뚱한 삼각형이 그려진다.

###### 그림 11-21 카메라 뒤에 위치한 점을 거꾸로 투영하는 경우의 문제
![카메라 뒤에 위치한 점을 거꾸로 투영하는 경우의 문제](/img/)

평면이 올바르게 보이려면 카메라 뒤쪽에 있는 점을 파악해 점이 거꾸로 뒤집혀 투영되지 않도록 예방해야 한다.   

원근 투영 행렬을 곱해 생성된 클립 좌표계의 $w$값은 뷰 공간에서의 깊이 값을 의미한다.    
따라서 카메라 정면에 위치한 점의 $w$값은 0보다 크고, 카메라 뒤에 있는 점의 $w$값은 0보다 작으며, 카메라 초점에 위치한 점의 $w$값은 0이 된다.

따라서 문제 해결을 위해 음의 $w$ 영역에 걸쳐 있는 삼각형을 파악하고 이들이 엉뚱하게 투영되지 않도록 삼각형 영역을 잘라내야 한다.    
이를 ***삼각형 클리핑(Triangle clipping)*** 이라고 한다.   
***삼각형 클리핑 작업은 월드 공간의 좌표를 사용하지 않고 투영 행렬을 적용한 후의 좌표를 사용***한다.      
***사영 공간에서 삼각형 클리핑 작업을 진행하는 것이 더 간편하기 때문***이다.      
이는 ***사영 공간의 좌표를 클립 좌표로 부르는 이유***다.

[그림 11-22](#그림-11-22-문제를-방지하기-위한-사전-투영-작업)과 같이 위에서 절두체를 내려다본 상황을 생각해보자.     
그리려는 삼각형의 두 점의 $w$값은 양수이고, 나머지 하나는 음수인 상황이다.      
이 경우 뒤집혀 투영되는 문제를 해결하기 위해 붉은색으로 표시된 음의 영역을 잘라내는 작업이 필요하다.    
음의 영역에 위치한 점 $P_1$을 $w = 0$ 평면에 투영한 두 점 $P_{c1}$과 $P_{c2}$의 좌표를 구해야 한다.

###### 그림 11-22 문제를 방지하기 위한 사전 투영 작업
![문제를 방지하기 위한 사전 투영 작업](/img/)

점 $P_1$과 점 $P_2, P_3$를 이은 두 선분이 있을 때 점 $P_{c1}$과 $P_{c2}$의 좌표는 각 선분 위의 점이다.      
이 중에서 점 $P_{c1}$의 좌표는 ***아핀 결합의 직선의 방정식***을 사용해 다음과 같이 구할 수 있다.

###### 식 11-7

$$P_{c1} = P_1 \cdot (1 - t_1) + P_2 \cdot t_1$$

점 $P_{c1}$은 $w = 0$인 직선에 위치하므로 $P_{c1}$의 $w$값은 0이다.     
따라서 점 $P_1, P_2$의 $w$값을 각각 $w_1, w_2$로 표기한다면 다음의 수식이 성립한다.

$$w_1(1 - t_1) + w_2t_1 = 0$$

이 식을 $t_1$에 대해 전개하면 다음 값을 구할 수 있다.

$$t_1 = \frac{w_1}{w_1 - w_2}$$

$t_1$의 값을 구한 후 [식 11-7](#식-11-7)에 대입하면 점 $P_{c1}$의 최종 좌표를 얻을 수 있다.     
다른 점 $P_{c2}$도 동일한 방법으로 구할 수 있다.    
여기서 주의해야 할 점은 삼각형을 잘라낸 후에 $w = 0$ ***평면에 투영된 두 점과 투영되지 않은 두 점의 영역은 삼각형이 아닌 사각형을 이룬다***는 것이다.     
따라서 점을 투영한 후에는 사각형을 [그림 11-23](#그림-11-23-투영-후-사각형을-두-개의-삼각형으로-분할하기)과 같이 두 개의 삼각형으로 분할해야 한다.    
분할할 때에는 ***면의 방향이 동일하도록 정점의 순서도 자르기 전의 삼각형의 순서와 동일해야 한다***.

###### 그림 11-23 투영 후 사각형을 두 개의 삼각형으로 분할하기
![투영 후 사각형을 두 개의 삼각형으로 분할하기](/img/)

예를 들어 자르기 전 삼각형의 정점 배치 순서가 $P_1 \rightarrow P_2 \rightarrow P_3$였다면 [그림 11-23](#그림-11-23-투영-후-사각형을-두-개의-삼각형으로-분할하기)의 두 삼각형은 다음과 같이 정점의 순서를 유지해야 한다.

- 삼각형 1의 순서: $P_{c1} \rightarrow P_2 \rightarrow P_3$
- 삼각형 2의 순서: $P_{c1} \rightarrow P_3 \rightarrow P_{c2}$

[그림 11-24](#그림-11-24-두-점이-카메라-뒤에-위치한-경우)와 같이 두 점이 음의 영역에 위치한 상황을 가정한다.     
두 개의 선분을 만들고 아핀 결합 식을 사용해 $w = 0$ 평면에 위치한 점을 계산할 수 있다.

###### 그림 11-24 두 점이 카메라 뒤에 위치한 경우
![두 점이 카메라 뒤에 위치한 경우](/img/)

두 점이 음의 영역에 있는 경우에는 언제나 삼각형이 만들어지므로, 두 점의 위치 값만 갱신하는 것으로 삼각형을 손쉽게 잘라낼 수 있다.

삼각형의 세 점이 모두 음의 영역에 있다면 해당 삼각형은 시야에 없음을 의미하므로 그리기를 생략하면 된다.     
마지막으로, 삼각형의 세 점이 모두 양의 영역에 있다면 삼각형을 그대로 그리면 된다.

정리하면 동차 좌표계 상에서 삼각형을 분할하는 작업은 다음과 같은 순서로 진행된다.

1. 잘라낼 영역에 몇 개의 점이 속해 있는지 파악한다.
2. 잘라낼 영역에 점이 없으면 삼각형을 그대로 그린다.
3. 잘라낼 영역에 한 점이 속해 있으면 평면과의 교차점을 구하고 교차점으로부터 삼각형을 두 개로 분할한다.
4. 잘라낼 영역에 두 점이 속해 있으면 교차점을 구해 갱신한다.
5. 잘라낼 영역에 세 점이 모두 속해 있으면 그리지 않는다.

이러한 클리핑 규칙은 절두체를 구성하는 모든 평면에 적용할 수 있다.      
[그림 11-23](#그림-11-23-투영-후-사각형을-두-개의-삼각형으로-분할하기)의 결과에 이어서 오른쪽 절두체 영역을 잘라내는 상황을 가정한다.     
1번 삼각형에 대해서 오른쪽 절두체 영역을 잘라낸다면 [그림 11-25](#그림-11-25-오른쪽-평면에-대해-추가로-분할한-삼각형)와 같은 상황이 된다.    
잘라내는 영역에 삼각형의 한 점이 속해 있으므로 해당 삼각형은 다시 두 개로 분할돼야 한다.

###### 그림 11-25 오른쪽 평면에 대해 추가로 분할한 삼각형
![오른쪽 평면에 대해 추가로 분할한 삼각형](/img/)

절두체의 오른쪽 평면은 NDC 좌표의 $x$값이 언제나 1인 평면인데, 이를 클립 좌표계로 표현하면 $\frac{x}{w} = 1$이 되며, 이는 $w = x$를 의미한다.   
삼각형을 잘라내는 평면의 식이 $w = 0$에서 $w = x$로 바뀌었을 뿐 잘라내는 원리는 동일하다.   
앞서 잘라내는 영역을 파악하기 위해 음의 영역, 즉 $w < 0$의 부등식을 사용했는데, 이번 경우에는 잘라내는 영역을 파악하기 위해 다음 식을 사용한다.

$$\frac{x}{w} > 1 \quad \therefore x > w$$

잘라낼 평면 상에 위치한 점의 좌표를 계산하는 방법도 변경된다.       
점 $P_1$과 $P_2$의 $x$값을 각각 $x_1$, $x_2$로 지정하고 잘라내는 점의 $x$값을 $x_{c1}$이라고 할 때 $x_{e1}$을 구하는 수식은 다음과 같다.

###### 식 11-8

$$x_{c1} = x_1(1 - t_1) + x_2t_1$$

이는 $w$값에 대해서도 동일하게 성립된다.

###### 식 11-9

$$w_{c1} = w_1(1 - t_1) + w_2t_1$$

오른쪽 절두체 평면에서는 $x$값과 $w$값이 동일하므로 [식 11-8](#식-11-8)과 [식 11-9](#식-11-9)의 값은 동일하다.

$$w_1(1 - t_1) + w_2t_1 = w_1(1 - t_1) + w_2t_1$$

이 식으로부터 $t_1$값을 구하는 수식은 다음과 같이 정리된다.     
이를 사용해 $w = x$ 평면에 위치한 점 $P_{c1}$과 $P_{c2}$의 좌표를 구할 수 있을 것이다.

$$t_1 = \frac{(w_1 - x_1)}{(w_1 - x_1) - (w_2 - x_2)}$$

이러한 방법으로 절두체를 구성하는 각 평면마다 삼각형 자르기를 진행하면 아무리 큰 삼각형이라도 절두체 영역에 들어맞는 다각형이 만들어진다.       
[그림 11-26](#그림-11-26-절두체에-맞게-삼각형을-잘라낼-각-평면의-방정식)은 절두체의 각 평면에 대한 방정식을 정리한다.   
절두체 영역의 위, 아래를 담당하는 $y$축 평면은 그림에서 생략됐는데, 이들의 방정식은 $w = y$와 $w = -y$이다.

###### 그림 11-26 절두체에 맞게 삼각형을 잘라낼 각 평면의 방정식
![절두체에 맞게 삼각형을 잘라낼 각 평면의 방정식](/img/)

절두체를 구성하는 각 평면의 방정식과 외부 영역에 대한 판별식, 그리고 아핀 결합의 계수를 구하는 수식은 [표 11-1]과 같다.

###### 표 11-1 삼각형 분할을 위한 각 평면의 판별식과 계수

|순서|평면|외부 판별식|아핀 결합의 계수|
|---|---|---|---|
|1|$w = 0$|$w < 0$|$\frac{w_1}{w_1 - w_2}$|
|2|$w = y$|$y > w$|$\frac{(w_1 - y_1)}{(w_1 - y_1) - (w_2 - y_2)}$|
|3|$w = -y$|$y < -w$|$\frac{(w_1 + y_1)}{(w_1 + y_1) - (w_2 + y_2)}$|
|4|$w = x$|$x > w$|$\frac{(w_1 - x_1)}{(w_1 - x_1) - (w_2 - x_2)}$|
|5|$w = -x$|$x < -w$|$\frac{(w_1 + x_1)}{(w_1 + x_1) - (w_2 + x_2)}$|
|6|$w = z$|$z > w$|$\frac{(w_1 - z_1)}{(w_1 - z_1) - (w_2 - z_2)}$|
|7|$w = -z$|$z < -w$|$\frac{(w_1 + z_1)}{(w_1 + z_1) - (w_2 + z_2)}$|

# 42. 복소수
***실수*** 외에도 ***체의 구조***를 가지는 수 집합으로는 ***복소수***가 있다.     
***복소수는 실수와 허수의 두 가지 수로 구성된 집합***이다.    
실수를 시각화할 때 ***1차원의 수직선(Number line)*** 으로 실수를 표현했다면, 복소수는 ***2차원의 평면***으로 표현된다.   
1차원을 넘어선 다차원의 수인 복소수와 복소수 연산의 성질을 이해하는 것은 ***4차원의 수인 사원수***를 이해하는 데 중요한 기반이 된다.

일상적으로 사용하는 대부분의 수는 하나의 값으로 표현하지만, 특이하게 두 개의 값으로 구성되는 수집합이 있다.     
이를 ***복소수(Complex number)*** 라고 하며, 집합 기호는 $C$로 표현한다.   
복소수는 [그림 12-1](#그림-12-1-복소수-집합의-구성)과 같이 ***실수(Real number)*** 와 ***허수(Imaginary number)*** 의 독립된 2개 요소로 구성된 수 집합이다.

###### 그림 12-1 복소수 집합의 구성
![복소수 집합의 구성](/img/)

# 42.1. 허수
복소수 체계에서 ***허수는 실수와 구분된 단위를 가진 특별한 수***다.   
***모든 실수는 제곱하면 0보다 크거나 같은 수가 나온다***.     
그런데 이러한 실수의 정의만으로는 풀리지 않는 문제가 등장하면서 이를 해결하고자 수학자들은 ***제곱해서 음수가 되는 상상의 수***를 고안하기에 이르렀는데, 이것이 바로 허수다.      
복소수 체계에서 실수와 허수는 물과 기름과 같이 완전히 분리된 성질을 가진다.     
이 둘을 구분하기 위해 허수에 $i$라는 기호를 사용하며, 이를 ***허수 단위(Imaginary unit)*** 라 부른다.      
여기서 허수 단위 $i$는 제곱했을 때 -1이 나오는 수를 말한다.

$$i^2 = -1$$

복소수 내에서 서로 완전히 분리된 실수 집합과 허수 집합은 각각 ***실수부(Real part)*** 와 ***허수부(Imaginary part)*** 로 부르고 허수부는 항상 $i$를 사용해 표기한다.      
즉 크기가 $b$인 허수부의 수는 $bi$로 표기해 실수와 구분한다.    
그래서 실수부의 값이 $a$이고 허수부의 값이 $b$인 복소수는 덧셈 기호를 사용해 다음과 같이 표기한다.

$$a + bi$$

또는 다음과 같은 순서쌍으로 표기하기도 한다.    
앞에 위치한 요소 $a$는 실수부, 뒤에 위치한 요소 $b$는 허수부를 의미한다.

$$(a, b)$$

이렇게 복소수를 정의했다면, 여기에 덧셈과 곱셈 연산을 정의해야 실제로 활용할 수 있는 수의 구조를 완성하게 된다.

# 42.2. 복소수의 구조
***복소수의 덧셈은 실수부와 허수부를 구분해 각각 더해주는 방식***이다.    
따라서 두 복소수의 덧셈은 다음과 같이 전개된다.

$$(a + bi) + (c + di) = (a + c) + (b + d)i$$

복소수의 덧셈을 순서쌍으로 표기하면 다음과 같은데 이는 ***2차원 벡터의 덧셈과 동일***하다.

$$(a, b) + (c, d) = (a + c, b + d)$$

순서쌍을 구성하는 $a, b, c, d$는 모두 실수이므로 벡터 덧셈 연산의 성질을 참고해 복소수의 덧셈 연산이 만족하는 성질도 쉽게 파악할 수 있다.   

- 결합법칙: $(a, b) + ((c, d) + (e, f)) = ((a, b) + (c, d)) + (e, f)$
- 교환법칙: $(a, b) + (c, d) = (c, d) + (a, b)$
- 항등원: $(a, b) + (0, 0) = (a, b)$
- 역원: $(a, b) + (-a, -b) = (0, 0)$

###### 표 12-1 복소수 덧셈 연산의 성질

|연산의 성질|만족 여부|
|---|---|
|덧셈에 대해 닫혀 있음|O|
|덧셈에 대한 교환법칙이 성립함|O|
|덧셈에 대한 결합법칙이 성립함|O|
|덧셈에 대한 항등원이 존재함|O|
|덧셈에 대한 역원이 존재함|O|

복소수의 덧셈은 결합법칙, 교환법칙을 만족한다.      
덧셈의 항등원은 $(0, 0)$이며, 임의의 복소수 $(a, b)$에 대한 덧셈의 역원은 $-(a, b)$가 된다.

둘째, 복소수의 곱셈은 모든 요소를 교차해 곱하는 방식으로 동작한다.      
따라서 임의의 두 복소수의 곱셈은 다음과 같이 전개된다.

$$(a + bi) \cdot (c + di) = ac - bd + (ad + bc)i$$

이를 순서쌍으로 나타내면 다음과 같다.

$$(a, b) \cdot (c, d) = (ac - bd, ad + bc)$$

실수가 갖는 체의 성질에 근거해 복소수 곱셈 연산의 성질을 분석하기 위해 순서쌍으로 나타낸 세 복소수 $(a, b), (c, d), (e, f)$를 예로 들어 살펴보자.

- 결합법칙: $(a, b) \cdot ((c, d) \cdot (e, f)) = ((a, b) \cdot (c, d)) \cdot (e, f)$
- 교환법칙: $(a, b) \cdot (c, d) = (c, d) \cdot (a, b)$
- 분배법칙: $(a, b) \cdot ((c, d) + (e, f)) = (a, b) \cdot (c, d) + (a, b) \cdot (e, f)$
- 항등원: $(a, b) \cdot (1, 0) = (a, b)$

###### 표 12-2 복소수 곱셈 연산의 성질

|연산의 성질|만족 여부|
|---|---|
|곱셈에 대해 닫혀 있음|O|
|곱셈에 대한 교환법칙이 성립함|O|
|덧셈과 곱셈에 대한 분배법칙이 성립함|O|
|곱셈에 대한 항등원이 존재함|O|

[표 12-2](#표-12-2-복소수-곱셈-연산의-성질)에서 보듯이 복소수의 곱셈은 결합법칙, 교환법칙, 분배법칙을 만족한다.     
그리고 복소수 곱셈 연산의 항등원 값은 $(1, 0)$이다.

이 중에서 아직 확인할 수 없는 성질은 곱셈의 역원이다.   
복소수 곱셈의 역원을 단순히 실수와 동일한 방식으로 역수를 사용해 $\frac{1}{(a + bi)}$로 표기할 수 있겠지만, 아직 허수를 분모로 하는 체계에 대해 정의하지 않았기 때문에 이대로 표기할 수는 없다.     
그래서 복소수의 곱셈 역원은 다른 방법을 사용하는데, 이를 위해서는 ***켤레 복소수***의 개념을 알아야 한다.

복소수의 크기는 2차원 벡터와 동일하게 실수부와 허수부의 각 요소를 제곱해 더한 다음, 제곱근을 취하는 방식으로 계산한다.      
구한 복소수의 크기는 실수와 동일하게 절댓값 기호 $||$를 써서 나타내며 ***복소수의 노름(Norm)*** 이라고도 부른다.

$$|(a, b)| = |(a, -b)| = \sqrt{a^2 + b^2}$$

특히 크기가 1인 복소수를 ***단위 복소수(Unit complex number)*** 라고 부른다.

복소수의 곱셈 역원을 파악하기 위해 ***두 복소수의 관계를 나타내는 켤레(Conjugate) 복소수***에 대해 알아보자.    
임의의 복소수를 $c$라고 하면 $c$의 켤레 복소수는 * 첨자 기호를 사용한 $c^*$나 $\overline{c}$로 표시한다.    
임의의 복소수 $a + bi$의 켤레 복소수 $c^*$는 다음과 같이 정의할 수 있다.

$$c = a + bi = (a, b)$$

$$c^* = a - bi = (a, -b)$$

켤레 복소수의 기호는 마치 연산처럼 사용할 수 있으며, 다음 성질이 성립한다.

$$(c^*)^* = c$$

$$c^*c = cc^*$$

$$(c_1c_2)^* = c_2^*c_1^*$$

***어떤 복소수에 그 켤레 복소수를 서로 곱하면 해당 복소수의 크기를 제곱한 값을 얻을 수 있다***.

$$cc^* = (a + bi) \cdot (a - bi) = a^2 + b^2 = |c|^2$$

켤레 복소수의 정의와 성질을 파악했다면 복소수 곱셈의 역원을 구한다.     
임의의 복소수 $c$에 대한 곱셈의 역원을 $c^{-1}$라고 할 때, 그 역원의 분모와 분자에 각각 켤레 복소수를 곱한다.

$$c^{-1} = \frac{1}{c} = \frac{c^*}{cc^*}$$

그러면 ***켤레 복소수의 성질에 따라 분모의 허수부가 제거되면서 역원의 표현이 가능해진다***.   
좀 더 구체적으로, 임의의 복소수 $(a, b)$에 대한 곱셈의 역원을 구하는 식을 다시 한번 풀어보면 아래와 같다.

$$(a + bi)^{-1} = \frac{1}{(a + bi)} = \frac{(a - bi)}{(a + bi)(a - bi)} = \frac{(a - bi)}{(a^2 + b^2)}$$

즉 복소수 $c$에 대한 곱셈의 역원 $c^{-1}$는 다음과 같이 켤레 복소수와 복소수 크기에 관한 식으로 나타낼 수 있다.

$$c^{-1} = \frac{c^*}{|c|^2}$$

해당 복소수 크기가 1인 단위 복소수라면 분모의 값은 1이 된다.    
따라서 ***단위 복소수의 곱셈 역원은 바로 켤레 복소수가 된다***.   
이와 같이 복소수에서 곱셈의 역원이 존재함을 확인할 수 있었다.   
따라서 ***복소수 집합은 덧셈과 곱셈에 대해 교환법칙, 결합법칙, 분배법칙이 성립되며 덧셈과 곱셈의 항등원과 역원까지 존재함***을 확인했으므로, ***체의 구조를 만족***한다.

# 43. 복소평면
실수는 수직선이라는 1차원의 직선을 사용해 시각적으로 표현한다.      
복소수는 실수부와 허수부라는 두 개의 독립된 체계를 가졌다.      
이를 시각적으로 나타내려면 직선보다는 확장된 체계를 사용해야 한다.

[그림 12-2](#그림-12-2-실벡터-공간-r2와-복소평면의-비교)의 (a)와 같이 2차원 실벡터 공간 $R^2$의 벡터 $(a, b)$를 표현하기 위해 서로 직교하는 $x$축과 $y$축을 사용한 것처럼, 복소수 역시 $(b)$와 같이 실수부에 해당하는 실수축과 허수부에 해당하는 허수축을 직각으로 교차시키는 방법으로 표현하는데, 이를 ***복소평면(Complex plane)*** 이라고 부른다.

###### 그림 12-2 실벡터 공간 R^2와 복소평면의 비교
![실벡터 공간 R^2와 복소평면의 비교](/img/)

복소평면의 두 축의 이름을 순서대로 실수축$(Re)$와 허수축$(Im)$으로 설정하면 순서쌍으로 표현한 복소수 $(a, b)$는 [그림 12-3](#그림-12-3-복소평면에서의-복소수-표현)과 같이 좌표처럼 평면 상에 표현할 수 있다.

###### 그림 12-3 복소평면에서의 복소수 표현
![복소평면에서의 복소수 표현](/img/)

크기가 1인 ***단위 복소수***를 모아 복소평면에서 표현하면 [그림 12-4](#그림-12-4-복소평면에서의-단위-복소수)와 같이 ***단위원***의 형태가 만들어진다.

###### 그림 12-4 복소평면에서의 단위 복소수
![복소평면에서의 단위 복소수](/img/)

# 43.1. 단위 복소수와의 곱
단위 복소수는 곱셈에 대해 특별한 성질을 만족한다.   
먼저 실수부가 0이고 크기가 1인 복소수 $i$를 예로 들어서 곱셈의 성질을 파악해보자.

허수부가 0인 임의의 복소수 $(a, 0)$에 $i$라는 단위 복소수를 곱하면 다음과 같이 전개된다.

$$(a + 0i) \cdot (0 + i) = (0 + ai) = (0, a)$$

실수 $a$와 허수 $i$와의 곱셈 연산의 결과 $(0, a)$를 복소평면 상에 나타내보면 [그림 12-5](#그림-12-5-a-0과-0-1을-곱한-결과)와 같이 복소수 $(a, 0)$을 $90^\circ$ 회전시킨 결과와 같다.

###### 그림 12-5 (a, 0)과 (0, 1)을 곱한 결과
![(a, 0)과 (0, 1)을 곱한 결과](/img/)

복소수 $(0, a)$에 단위 복소수 $i$를 한 번 더 곱하면, $(-a, 0)$이 나온다.    
$(-a, 0)$에 또 $i$를 곱하면 $(0, -a)$가 나오고, $(0, -a)$에 $i$를 곱하면 $(a, 0)$이 되어 원래 값으로 돌아온다.      
이를 정리하면 [그림 12-6](#그림-12-6-복소수-i를-연속으로-곱한-결과)과 같다.

###### 그림 12-6 복소수 i를 연속으로 곱한 결과
![복소수 i를 연속으로 곱한 결과](/img/)

이로써 임의의 복소수에 단위 복소수 $i$를 곱한 결과는 해당 복소수를 $90^\circ$ 회전시킨 결과와 같음을 유추할 수 있다.    
즉 임의의 복소수 $(a, b)$에 복소수 $i$를 곱한 결과는 항상 실수부와 허수부의 값이 바뀌어 다음과 같은 식으로 표현된다.

$$(a, b) \cdot (0, 1) = (-b, a)$$

이는 좌표 평면에서의 $90^\circ$ 회전과 동일한 좌표값을 만들어낸다.      
따라서 임의의 복소수에 복소수 $i$를 곱하면 항상 복소평면 상에서 $90^\circ$ 회전을 한다고 볼 수 있다.

삼각함수의 공식 $\cos^2\theta + \sin^2\theta = 1$을 이용해 단위원을 형성하는 임의의 단위 복소수 $(a, b)$를 다음과 같이 삼각함수로 표현해볼 수 있다.

###### 식 12-1

$$(a, b) = \cos \theta + i \sin \theta = (\cos \theta, \sin \theta)$$

> 참고: ***복소수의 표기***     
복소수를 표기하는 방법은 $a + bi$와 $a + ib$ 두 가지 방식이 있다.   
$a$와 $b$에 삼각함수를 사용하는 경우에는 일반적으로 $a + ib$ 방식을 사용한다.   
따라서 [식 12-1](#식-12-1)은 $\cos \theta + i \sin \theta$로 표기한다.

이와 같이 삼각함수로 나타낸 단위 복소수에 임의의 복소수 $(x, y)$를 곱하면 복소수의 곱셈 식은 다음과 같이 전개된다.  

$$(\cos \theta, \sin \theta) \cdot (x, y) = (x \cos \theta - y \sin \theta, y \cos \theta + x \sin \theta)$$

이는 2차원 공간의 회전행렬 $R$에 2차원 벡터 $(x, y)$를 곱한 결과와 같다.    

$$R = 
\begin{bmatrix}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta \\
\end{bmatrix}
$$

$$
\begin{bmatrix}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta \\
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
\end{bmatrix} = 
\begin{bmatrix}
x \cos \theta - y \sin \theta \\
x \sin \theta + y \cos \theta \\
\end{bmatrix}
$$

따라서 ***임의의 복소수에 단위 복소수를 곱하는 것은 복소평면에서의 회전 변환을 의미***한다.

###### 그림 12-7 복소수를 회전시키는 단위 복소수와의 곱셈
![복소수를 회전시키는 단위 복소수와의 곱셈](/img/)

서로 다른 각을 갖는 2개의 단위 복소수를 곱한 결과를 살펴보자.

$$(\cos \alpha, \sin \alpha) \cdot (\cos \beta, \sin \beta) = (\cos \alpha \cos \beta - \sin \alpha \sin \beta, \sin \alpha \cos \beta + \sin \beta \cos \alpha)$$

이 식은 삼각함수의 덧셈 정리에 의해 다음과 같이 간단하게 표기된다.

$$(\cos(\alpha + \beta), \sin(\alpha + \beta))$$

이로써 ***서로 다른 두 각을 회전 변환한 후 곱셈 연산을 하는 것은 두 각의 합을 회전 변환하는 것과 동일함***을 확인할 수 있다.  

복소수 곱셈의 항등원 $(1, 0)$의 의미를 생각해보자.     
***복소수 곱셈의 항등원은 실수에서의 곱셈의 항등원과 동일하게 1이다***.       
복소수 1 역시 ***단위 복소수***로서, 이를 삼각함수로 표현하면 다음과 같이 각 $0^\circ$에 대응하는 수다.

$$(1, 0) = (\cos 0^\circ, \sin 0^\circ)$$

따라서 ***곱셈의 항등원을 곱한다는 의미는 아무런 변화가 일어나지 않는*** $0^\circ$***의 회전 변환이라 해석할 수 있다***.    
***실수에서 크기가 1인 수는 오직 1과 -1 두 가지만 존재한다***.    
이 두 수를 한 차원 높은 복소수에서 바라보면 각각은 $(1, 0)$과 $(-1, 0)$에 대응되고, 이들과의 곱은 각각 $0^\circ$와 $180^\circ$의 회전 변환으로 해석할 수 있는 것이다.

# 43.2. 켤레 복소수의 회전 변환
복소평면에서 켤레 복소수의 의미를 시각적으로 해석해보자.    
임의의 복소수 $(a, b)$의 켤레 복소수는 $(a, -b)$이다.   
어떤 복소수와 그 켤레 복소수를 복소평면에 나타내면 [그림 12-8](#그림-12-8-복소평면에서-켤레-복소수의-표현)과 같다.

###### 그림 12-8 복소평면에서 켤레 복소수의 표현
![복소평면에서 켤레 복소수의 표현](/img/)

***임의의 복소수와 그 켤레 복소수는 실수부 축***$(Re)$***을 중심으로 서로 대칭된 형태를 이룬다***.
 
단위 복소수를 $(\cos \theta, \sin \theta)$라고 표현할 때 이의 켤레 복소수는 $(\cos \theta, -\sin \theta)$가 된다.   
여기서 ***삼각함수의 성질***을 활용하면 켤레 복소수는 다음과 같이 표현할 수 있다.

$$(\cos \theta, -\sin \theta) = (\cos(-\theta), \sin(-\theta))$$

단위 복소수가 [그림 12-9](#그림-12-9-단위-복소수와-그-켤레-복소수)와 같이 실수 축에 위치한 단위 복소수 $(1, 0)$을 각 $\theta$만큼 회전한 수를 의미한다면, 켤레 복소수는 반대 방향인 $-\theta$만큼 회전한 수를 의미한다.

###### 그림 12-9 단위 복소수와 그 켤레 복소수
![단위 복소수와 그 켤레 복소수](/img/)

임의의 복소수 $(a, b)$에 단위 복소수를 곱하면 [그림 12-10](#그림-12-10-복소수에-단위-복소수를-곱한-결과와-그-켤레를-곱한-결과와의-비교)의 보라색의 궤적을 따라 반시계 방향의 회전이 발생하는 데 반해, 단위 복소수의 켤레 복소수를 곱하면 청록색의 궤적을 따라 시계 방향의 회전이 발생한다.

###### 그림 12-10 복소수에 단위 복소수를 곱한 결과와 그 켤레를 곱한 결과와의 비교
![복소수에 단위 복소수를 곱한 결과와 그 켤레를 곱한 결과와의 비교](/img/)

단위 복소수와 그 켤레 복소수를 곱한 값은 복소수의 크기의 제곱이므로 1이 된다.

$$c \cdot c^* = a^2 + b^2 = \sin^2\theta + \cos^2\theta = 1$$

이 식을 변환의 관점에서 해석하면 각 $\theta$만큼 회전한 후에 바로 $-\theta$만큼 거꾸로 회전하는 변환을 의미한다.    
이 결과는 아무런 회전도 일어나지 않는 $0^\circ$ 회전 변환을 의미하므로 복소수 곱셈의 항등원 $(1, 0)$이 됨을 다시 한번 확인할 수 있다.

# 44. 복소수와 행렬의 관계
***복소수를 수의 관점이 아닌 변환의 관점에서 바라본다면 2차원 복소평면 상의 복소수는 2차원 행렬에 대응할 수 있다***.      
회전을 수행하는 단위 복소수와 2차원의 회전 변환행렬이 동일하다고 가정하고 수식을 전개하면 다음과 같다.

$$\cos \theta + i \sin \theta = 
\begin{bmatrix}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta \\
\end{bmatrix}
$$

회전 변환행렬을 $\cos \theta$와 $\sin \theta$에 대해 분리해 정리하면 다음과 같다.

$$\cos \theta + i \sin \theta =
\cos \theta \cdot 
\begin{bmatrix}
1 & 0 \\
0 & 1 \\
\end{bmatrix}
+ \sin \theta \cdot
\begin{bmatrix}
0 & -1 \\
1 & 0 \\
\end{bmatrix}
$$

실수부에 대응하는 행렬을 $I$로, 허수 $i$에 대응되는 행렬을 $J$라고 정의한다.

$$I = 
\begin{bmatrix}
1 & 0 \\
0 & 1 \\
\end{bmatrix}
$$

$$J = 
\begin{bmatrix}
0 & -1 \\
1 & 0 \\
\end{bmatrix}
$$

실수부에 대응하는 ***행렬*** $I$***는 어떤 수에 곱했을 때 아무 변화가 없는 항등행렬임을 알 수 있는데, 이는 곱셈의 항등원*** $1$***과 동등한 개념이다***.      
한편 ***허수*** $i$***에 대응하는 행렬*** $J$***는*** $90^\circ$ ***회전 변환행렬인데 이를 두 번 곱하면*** $-I$***가 나오며, 이는*** $-1$***에 대응한다고 볼 수 있다***.

$$J \cdot J = 
\begin{bmatrix}
-1 & 0 \\
0 & -1 \\
\end{bmatrix} = 
-I$$

이는 ***두 번 곱하면*** $-1$***이 나오는 허수 단위의 성질과도 일치***한다.

$$i \cdot i = -1$$

# 45. 자연지수함수
1748년 스위스 수학자 ***레온하르트 오일러(Leonhard Euler)*** 는 실수와 허수와의 관계에서 더 나아가 삼각함수와 자연지수함수와의 관계를 나타내는 ***오일러 공식(Euler's formula)*** 을 발표했다.    
오일러 공식은 현대 디지털 문명에 필수적인 전기공학의 ***신호 처리(Signal processing)*** 분야의 기반이 되는 중요한 공식이며, 게임 그래픽 분야에서도 ***3차원 공간의 회전 문제를 해결***하는 데 징검 다리 역할을 수행해주는 유용한 공식이다.

무리수 $e$와 허수 단위 $i$, 그리고 삼각함수와의 관계를 이용해 나타낸 오일러 공식은 다음과 같다.

$$e^{i\theta} = \cos\theta + i\sin\theta$$

오일러 공식을 이해하려면 좌변의 자연지수함수 $f(x) = e^x$와 우변에 있는 두 삼각함수 $\sin$ 함수와 $\cos$ 함수의 미분을 이해하고, 이들을 급수로 표현하는 과정을 알아야 한다.     
먼저 좌변에 위치한 자연지수함수를 이해하기 위해서는 이의 밑을 이루는 특별한 상수 $e$에 대해 알아야 한다.    
이 상수를 무리수 $e$라 한다.

# 45.1. 무리수 e
무리수 $e$는 1683년도에 스위스 수학자 ***야코프 베르누이(Jakob Bernoulli)*** 가 은행의 복리 이자를 연구하던 중에 발견됐다.     
야코프 베르누이는 [식 13-1](#식-13-1)을 사용해 복리로 얻을 수 있는 수익을 연구했는데, [식 13-1](#식-13-1)에서 굉장히 큰 값을 $x$값에 대입할수록 이의 결괏값은 특정 상수에 근접한다는 사실을 알아내게 되었다.

###### 식 13-1

$$y = (1 + \frac{1}{x})^x$$

실제로 [식 13-1](#식-13-1)의 $x$에 [표 13-1](#표-13-1-y--1--1x2-함수의-x값을-증가시켜-대입한-결과)과 같이 양의 실수를 대입해보면 $x$값이 증가하면 $y$값도 증가한다.   
그런데 $x$값이 증가할수록 $y$값의 증가량은 서서히 줄어드는데, $x$가 굉장히 커질수록 2와 3사이에 있는 어떤 특정한 수에 근접하게 된다.

###### 표 13-1 y = (1 + 1/x)^2 함수의 x값을 증가시켜 대입한 결과
|x값|y값|
|---|---|
|1|$(1 + 1)^1 = 2$|
|2|$(1 + \frac{1}{2})^2 = 2.25$|
|3|$(1 + \frac{1}{3})^3 = 2.370370...$|
|100|$(1 + \frac{1}{100})^100 = 2.704813...$|
|10000|$(1 + \frac{1}{10000})^10000 = 2.7181459...$|
|1000000|$(1 + \frac{1}{1000000})^1000000 = 2.718280469...$|

이 함수의 변화를 그래프로 그리면 [그림 13-1](#표-13-1-y--1--1x2-함수의-x값을-증가시켜-대입한-결과)과 같이 전개되는데, $x$가 굉장히 커졌을 때 $y$값은 약 $2.7182818...$에 근접한다.    
이 수를 무리수 $e$라고 부른다.

###### 그림 13-1 y = (1 + 1/x)^x의 그래프
![y = (1 + 1/x)^x의 그래프](/img/)

> 참고: ***e의 표현에 대하여***     
무리수 e는 '오일러 상수 e', '상수 e', '자연 상수' 등 다양한 용어로 불리고 있다.     
대한수학회의 공식 명칭은 '자연로그의 밑(Base of the natural logarithm)'이다.    
영문권에서는 오일러의 수(Euler's number)로도 불린다.    
무리수 e가 상수라는 사실은 베르누이가 처음 발견했으나, 이 상수를 적극적으로 연구하고 e라는 이름을 붙인 수학자는 레온하르트 오일러였기 때문이다.

이러한 무리수 $e$는 극한(Limit)과 무한대($\infty$)의 개념을 사용해 [식 13-2](#식-13-2)로 표현할 수 있다.

###### 식 13-2

$$e = \lim_{x \rightarrow \infty}(1 + \frac{1}{x})^x$$

$\infty$로 표시하는 ***무한대(Infinity)*** 란 특정한 수를 가리키는 것이 아니고, 어떤 실수보다도 큰 상태를 의미한다.    
그리고 극한이란 어떤 값 $x$가 지정한 값 $a$에 한없이 가까워질 때 함수 $f(x)$가 한없이 가까워지는 값 $L$을 의미하며, 이는 다음의 수식으로 표현한다.

$$L = \lim_{x \rightarrow a}f(x)$$

극한의 결괏값이 특정한 값에 한없이 가까워진다면 이를 어떤 값에 ***수렴한다(Converge)*** 고 표현한다.   
반면에 극한의 결괏값이 특정한 값에 수렴하지 않고 무한대로 증가하거나 여러 값들을 오고가면 ***발산한다(Diverge)*** 고 표현한다.     
따라서 [식 13-2](#식-13-2)에서 함수 $(1 + \frac{1}{x})^x$에 사용하는 입력이 한없이 크면 그 결과는 무리수 $e$로 수렴한다고 설명할 수 있다.   

# 45.2. 자연지수함수
자연지수함수를 알아보기 앞서 지수의 개념에 대해 알아야한다.     
같은 수를 여러 번 곱하는 작업을 ***거듭제곱(Exponenetiation)*** 이라 하는데, 거듭제곱에서 곱하는 횟수를 ***지수(Exponent)*** , 곱하는 수는 ***밑(Base)*** 이라고 부른다.     
예를 들어 3을 5번 거듭제곱한 식은 다음과 같이 지수와 밑을 사용해 $3^5$으로 짧게 표기한다.

$$3^5 = 3 \cdot 3 \cdot 3 \cdot 3 \cdot 3$$

거듭제곱을 구성하는 밑과 지수가 가지는 연산의 특징을 ***지수법칙(Law of exponents)*** 이라고 한다.     
무리수 $e$를 밑으로 다루는 거듭제곱에 대해 알아야 하는데, 0보다 큰 수 무리수 $e$에 통용되는 3가지 지수법칙을 살펴보자.

1. 밑이 같은 거듭제곱 간의 곱셈은 지수를 더한 거듭제곱과 동일하다.

$$a^m \cdot a^n = a^{m + n}$$

2. 거듭제곱의 거듭제곱은 지수를 곱한 거듭제곱과 동일하다.

$$(a^m)^n = a^{m \cdot n}$$

거듭제곱의 개념은 수를 세는 자연수에서 비롯됐지만, ***자연수가 아닌 0으로도 확장이 가능***하다.   
곱셈의 항등원 1을 활용해 0의 거듭제곱의 값은 다음과 같이 유도할 수 있다.

$$a^m = a^{(m + 0)} = a^m \cdot a^0 = a^m \cdot 1$$

따라서 다음과 같은 세 번째 지수법칙이 성립한다.

3. 지수가 0인 거듭제곱은 항상 1의 값을 갖는다.

$$a^0 = 1$$

이러한 거듭 제곱의 지수에 미지수 $x$를 대입해 만든 함수를 ***지수함수(Exponential function)*** 라고 하며 밑이 $a$인 지수함수는 다음과 같이 표시한다.

$$f(x) = a^x$$

앞서 살펴본 지수 법칙에 따라 지수함수의 $x$값이 0이면 출력은 항상 1이 된다.     
그러므로 밑이 0보다 큰 지수함수의 그래프는 언제나 좌표 $(0, 1)$을 지난다.   
그리고 다음과 같이 무리수 $e$를 밑으로 하는 지수함수를 다음과 같이 ***자연지수함수(Natural exponential function)*** 라고 정의한다. 

$$f(x) = e^x$$

자연지수함수 $y = e^x$는 언제나 $(0, 1)$을 지나며 그래프를 그려보면 [그림 13-2](#그림-13-2-자연지수함수의-그래프)와 같이 $x$가 커질수록 급격히 증가하는 형태를 띤다.

###### 그림 13-2 자연지수함수의 그래프
![자연지수함수의 그래프](/img/)

# 46. 미분
***미분(Differentiation)*** 은 ***미분 가능한 함수를 대상으로 특정 지점에서의 접선의 기울기를 측정하는 작업***을 의미한다.   
고교 교육과정에서는 미분 가능한 함수를 뾰족점이 없이 끊이지 않고 연속으로 이어져 있는 함수로 소개한다.  
미분을 적용할 ***자연지수함수,*** $\sin$ ***함수,*** $\cos$ ***함수도 모두 미분 가능한 함수다***.     

미분을 진행하기 위해서는 ***접선의 기울기***가 무엇인지 알아야 한다.      
[그림 13-3](#그림-13-3-할선의-개념)과 같이 어떤 미분 가능한 함수가 주어졌을 때 $x$값 $a$와 $b$에 대응되는 두 좌표를 연결해 직선을 만든다.   
이를 ***할선(Secant line)*** 이라고 한다.

###### 그림 13-3 할선의 개념
![할선의 개념](/img/)

할선의 기울기는 다음과 같이 구할 수 있다.

###### 식 13-3

$$m = \frac{f(b) - f(a)}{b - a}$$

여기서 $a$를 고정시킨 상태에서 $b$를 서서히 $a$로 이동시킨다고 가정한다.    
$b$를 $a$로 이동시킴에 따라 할선의 기울기는 [그림 13-4](#그림-13-4-b가-a로-이동함에-따른-할선의-변화)와 같이 시시각각 변화한다.

###### 그림 13-4 b가 a로 이동함에 따른 할선의 변화
![b가 a로 이동함에 따른 할선의 변화](/img/)

$b$ 값이 왼쪽으로 이동해 $a$에 도달하면 [식 13-3](#식-13-3)의 분모 값은 0이 되어 할선은 더 이상 존재하지 않게 된다.     
하지만 [그림 13-5](#그림-13-5-a에-한없이-가까운-b가-만들어내는-접선)와 같이 $b$가 $a$에 한없이 가깝게 접근했다면, 할선은 여전히 존재하며, 마치 $a$ 지점에서의 기울기처럼 보인다.      
이렇게 ***한없이 가까워지는 개념을 사용해 특정 지점에서의 기울기를 나타내는 선***을 ***접선(Tangent line)*** 이라고 한다.

###### 그림 13-5 a에 한없이 가까운 b가 만들어내는 접선
![a에 한없이 가까운 b가 만들어내는 접선](/img/)

접선의 개념은 무리수 $e$에서 언급한 극한의 한없이 가까워지는 성질과 동일하다.   
따라서 $b$가 $a$로 한없이 가까워질 때 접선의 기울기 $m$ 값은 [식 13-3](#식-13-3)에 극한을 적용해 다음과 같이 계산한다.

###### 식 13-4

$$m = \lim_{b \rightarrow a} \frac{f(b) - f(a)}{b - a}$$

[식 13-4](#식-13-4)에서 $a$에 한없이 가까워진 $b$ 값은 $a$에서 한없이 작은 값 $h$를 더한 값과 같다.     
따라서 이 식에서 $f(b)$의 값을 $f(a + h)$로 바꾸고 $b - a$를 $h$로 바꾸면 [식 13-4](#식-13-4)의 접선식은 [식 13-5](#그림-13-5-a에-한없이-가까운-b가-만들어내는-접선)로 바꿔 표현할 수 있다.

###### 식 13-5

$$m = \lim_{h \rightarrow 0} \frac{f(a + h) - f(a)}{h}$$

이 값을 $a$에서의 ***미분 계수(Differential coefficient)*** 라고 한다.

# 46.1. 도함수
***미분 계수는 주어진 값에 대한 접선의 기울기를 의미***한다.  
함수가 모든 구간에서 미분이 가능하다면 이 개념을 확대해 임의의 수에 대해 미분 계수를 구할 수 있는 수식이 만들어질 것이다.       
이렇게 임의의 수 $x$에 대한 미분 계수를 구할 수 있도록 일반화한 함수를 ***도함수(Derivative)*** 또는 ***미분*** 이라고 한다.     
함수 $f(x)$의 도함수는 기호 $f'(x)$로 표시한다.

> 참고: ***미분의 뜻***     
미분은 ***도함수를 계산하는 작업(Differentiation)*** 과 ***도함수(Derivative)*** 두 가지 의미를 가진다.      
보통은 후자인 도함수를 의미하는 경우가 많다.

임의의 수 $a$에서의 미분 계수를 구하는 데 사용한 [식 13-5](#식-13-5)를 임의의 수 $x$에 대해 정리한 도함수 식은 [식 13-6](#식-13-6)과 같다.

###### 식 13-6

$$f'(x) = \lim_{h \rightarrow 0} \frac{f(x + h) - f(x)}{h}$$

이 식으로부터 다양한 함수의 도함수를 구할 수 있는데, 목표는 자연지수함수, $\sin$ 함수, $\cos$ 함수에 대한 도함수를 계산하는 것이다.     
이 함수의 도함수를 계산하려면 먼저 극한이 가지는 성질에 대해 알아야 한다.

정의역과 무관하게 항상 일정한 값을 가지는 함수를 ***상수함수***라고 하는데 일정한 값 $c$의 상수함수는 다음의 수식으로 나타낸다.

$$f(x) = c$$

상수함수의 그래프는 [그림 13-6](#그림-13-6-상수함수-y--c)과 같이 $x$축과 수평한 선의 형태를 띤다.

###### 그림 13-6 상수함수 y = c
![상수함수 y = c](/img/)

[그림 13-6](#그림-13-6-상수함수-y--c)에서 볼 수 있듯이 상수함수는 모든 정의역의 원소에 대해 항상 상수 $c$가 나온다.   
따라서 [식 13-6](#식-13-6)의 도함수를 계산하면 그 결과는 언제나 0이 된다.   
이는 상수함수의 모든 $x$에 대한 접선의 기울기가 0임을 뜻한다.

$$\lim_{h \rightarrow 0}\frac{f(x + h) - f(x)}{h} = \lim_{h \rightarrow 0}\frac{c - c}{h} = \lim_{h \rightarrow 0}\frac{0}{h} = 0$$

이와 더불어 자연지수함수와 삼각함수의 도함수를 전개하기 위해 알아둬야 할 6가지 극한의 성질은 다음과 같다.

- 극한의 성질 1: 두 함수 합의 극한값은 각 극한값의 합과 같다.

$$\lim_{x \rightarrow a}[f(x) + g(x)] = \lim_{x \rightarrow a}f(x) + \lim_{x \rightarrow a}g(x)$$

- 극한의 성질 2: 상수와 함수 곱의 극한값은 함수 극한값에 상수를 곱한 것과 같다.

$$\lim_{x \rightarrow a}cf(x) = c\lim_{x \rightarrow a}f(x)$$

- 극한의 성질 3: 두 함수 곱의 극한값은 각 극한값의 곱과 같다.

$$\lim_{x \rightarrow a}[f(x) \cdot g(x)] = \lim_{x \rightarrow a}f(x) \cdot \lim_{x \rightarrow a}g(x)$$

- 극한의 성질 4: 두 함수 나눗셈의 극한값은 각 극한값의 나눗셈과 동일하다.       
단 분모의 극한값은 0이 아니어야 한다.

$$\lim_{x \rightarrow a}[\frac{f(x)}{g(x)}] = \frac{\lim_{x \rightarrow a}f(x)}{\lim_{x \rightarrow a}g(x)}$$

- 극한의 성질 5: 함수를 거듭제곱한 극한값은 극한값을 거듭제곱한 값과 같다.

$$\lim_{x \rightarrow a}[f(x)]^n = [\lim_{x \rightarrow a}f(x)]^n$$

- 극한의 성질 6: 세 함수의 대소 관계가 $g(x) \leq f(x) \leq h(x)$와 같을 때 양변 $g(x)$와 $h(x)$의 극한값이 같다면 가운데 위치한 함수 $f(x)$의 극한값도 같다.   
즉 $\lim_{x \rightarrow a}g(x) = \lim_{x \rightarrow a}h(x) = L$이면 $\lim_{x \rightarrow a}f(x) = L$이 성립한다.   
이를 ***조임 정리(Squeeze theorem)*** 라고 한다.

극한의 성질을 숙지했다면 이를 활용해 거듭제곱 함수의 도함수에 대해 알아보자.    
일반적으로 많이 사용하는 다음과 같은 거듭제곱 함수의 도함수를 구한다.

$$f(x) = x^n$$

$n$이 자연수라고 가정하면 거듭제곱 함수의 도함수는 다음과 같은 과정을 통해 구할 수 있다.

$$
\begin{matrix}
f'(x) &=& \lim_{h \rightarrow 0} \frac{(x + h)^n - x^n}{h} \\
&=& \lim_{h \rightarrow 0} \frac{(x^n + nx^{n - 1}h + ... + nxh^{n - 1} + h^n) - x^n}{h} \\
&=& \lim_{h \rightarrow 0} \frac{h(nx^{n - 1} + ... + nxh^{n - 1} + h^{n - 1})}{h} \\
&=& n \cdot \lim_{h \rightarrow 0}(x^{n - 1} + ... + xh^{n - 2} + h^{n - 1}) \\
&=& n \cdot x^{n - 1} \\
\end{matrix}
$$

1. 분자의 $(x + h)^n$를 풀어 전개한다.
2. 첫 항 $x^n$은 소거되고, 남은 항을 $h$로 묶는다.
3. 분자와 분모가 소거된 식을 $n$으로 묶는다.
4. 극한에 의해 $h$가 있는 항들은 모두 0에 한없이 가까워진다. 따라서 $x^{n - 1}$만 남는다.

이로써 거듭제곱 함수 $f(x) = x^n$의 도함수는 다음과 같이 전개됨을 알 수 있다.

###### 식 13-7

$$f'(x) = n \cdot x^{n - 1}$$

# 46.2. 자연지수함수의 도함수
***자연지수함수*** $f(x) = e^x$***의 도함수는 다음과 같이 원함수와 동일하다는 특징을 가진다***.

$$f'(x) = e^x$$

이의 극한을 구하기 전에 무리수 $e$의 극한식으로부터 다음 수식을 유도한다.

###### 식 13-8

$$\frac{\lim_{h \rightarrow 0}(e^h - 1)}{\lim_{h \rightarrow 0}h} = 1$$

[식 13-2](#식-13-2)에서 한없이 커지는 $x$를 $\frac{1}{h}$로 바꾸면 $\frac{1}{h}$는 0으로 수렴하고 무리수 $e$의 극한식은 다음과 같이 바꿔쓸 수 있다.

$$e = \lim_{h \rightarrow 0}(1 + h)^{\frac{1}{h}}$$

여기서 좌변에도 극한을 취한다.      
이 경우 $e$는 $h$와 관련없는 상수이므로 다음과 같이 극한을 대입해도 그 결과는 동일하다.

$$\lim_{h \rightarrow 0}e = \lim_{h \rightarrow 0}(1 + h)^{\frac{1}{h}}$$

극한의 성질 5를 사용해 양변에 $h$승을 적용하면 다음과 같이 바꿀 수 있다.

$$\lim_{h \rightarrow 0}e^h = \lim_{h \rightarrow 0}(1 + h)$$

우변의 극한식은 극한의 성질 1에 의해 다음과 같이 분리된다.

$$\lim_{h \rightarrow 0}e^h = \lim_{h \rightarrow 0}1 + \lim_{h \rightarrow 0}h$$

여기서 분리된 상수함수항을 좌변으로 옮기면 다음과 같다.

$$\lim_{h \rightarrow 0}(e^h - 1) = \lim_{h \rightarrow 0}h$$

이로써 [식 13-8](#식-13-8)이 성립함을 알 수 있다.   
[식 13-8](#식-13-8)을 활용해 자연지수함수의 도함수를 구해보자.      
[식 13-6](#식-13-6)에 자연지수함수 $f(x) = e^x$를 대입해 전개하면 다음과 같다.

$$
\begin{matrix}
f'(x) &=& \lim_{h \rightarrow 0}\frac{e^{x + h} - e^x}{h} \\
&=& \lim_{h \rightarrow 0}\frac{e^x \cdot e^h - e^x}{h} \\
&=& \lim_{h \rightarrow 0}\frac{e^x(e^h - 1)}{h} \\
&=& e^x \cdot \lim_{h \rightarrow 0}\frac{e^h - 1}{h} \\
&=& e^x \cdot \frac{\lim_{h \rightarrow 0}(e^h - 1)}{\lim_{h \rightarrow 0}h} \\
&=& e^x
\end{matrix}
$$

1. 지수법칙을 사용해 분리한다.
2. $e^x$로 묶어준다.
3. $h$와 관련없는 $e^x$는 상수로 취급할 수 있으므로 극한의 성질 2를 사용해 극한식 밖으로 빼낸다.
4. 극한의 성질 4를 사용해 분모와 분자를 각각 극한값으로 분리한다.
5. [식 13-8](#식-13-8)에 의해 극한값은 1로 수렴한다.

이로써 ***자연지수함수의 도함수는 원함수와 동일함***을 확인할 수 있다.

$$f'(x) = e^x = f(x)$$

함수를 미분했을 때 그 결과가 원함수와 동일하다면 그 함수는 몇 번을 미분하더라도 그 결과는 언제나 원함수와 동일하게 유지된다.    
따라서 ***자연지수함수는 무한번 미분 가능하다***는 성질을 가진다.

# 46.3. sin 함수와 cos 함수의 도함수
삼각함수의 $\sin$ 함수와 $\cos$ 함수의 도함수를 구하기에 앞서 다음 극한식을 유도한다.

###### 식 13-9

$$\lim_{h \rightarrow 0}\frac{\sin h}{h} = 1$$

[식 13-9](#식-13-9)는 원과 부채꼴의 넓이를 구하는 공식으로부터 유도할 수 있다.      
***원(Circle)*** 의 넓이 $Area(C)$를 구하는 공식은 다음과 같다.

$$Area(C) = \pi \cdot r^2$$

원을 구성하는 각은 $2\pi$이므로 1(rad)에 해당하는 ***부채꼴(Circular Sector)*** 의 넓이는 $\pi r^2$에서 $2\pi$를 나눈 $\frac{1}{2}r^2$이 된다.     
부채꼴의 넓이는 각의 크기에 비례해 커지므로 중심각이 $\theta$(rad)인 부채꼴의 넓이 $Area(CS)$는 다음과 같다.

###### 식 13-10

$$Area(CS) = \frac{\theta}{2}r^2$$

> 주의:     
각의 범위를 실수 전 영역으로 사용하면 [식 13-10](#식-13-10)은 음수가 나올 수 있다.      
그런데 측정량인 넓이는 음수가 나올 수 없으므로, 일반적으로 [식 13-10](#식-13-10)에 절댓값을 취해줘야 한다.

[그림 13-7](#식-13-7)과 같이 원점 $O$를 중심으로 반지름이 1이고 중심각이 $\theta$(rad)인 부채꼴의 넓이는 $\frac{\theta}{2}$가 됨을 알 수 있다.    
이 부채꼴의 이름을 $CS_1$으로 지정하면 넓이는 다음과 같다.

$$Area(CS_1) = \frac{\theta}{2}$$

###### 그림 13-7 반지름이 1이고 중심각이 세타인 부채꼴의 넓이
![반지름이 1이고 중심각이 세타인 부채꼴의 넓이](/img/)

[그림 13-8](#그림-13-8-부채꼴에-포함된-삼각형-oab의-넓이)과 같이 부채꼴 $CS_1$ 내부에 들어가는 삼각형 $T$를 만든다.   
부채꼴의 점 $A$에서 수선을 내려 밑변에 닿는 점을 $B$라고 하면, 밑변의 길이는 1이고 높이에 해당하는 선분 $\overline{AB}$의 길이는 $\sin\theta$가 되어 $T$의 넓이는 다음과 같이 계산된다.

$$Area(T) = \frac{\sin\theta}{2}$$

###### 그림 13-8 부채꼴에 포함된 삼각형 OAB의 넓이
![부채꼴에 포함된 삼각형 OAB의 넓이](/img/)

[그림 13-9](#그림-13-9-삼각형에-포함된-부채꼴의-넓이)와 같이 선분 $\overline{OB}$를 반지름으로 하는 작은 부채꼴 $CS_2$을 만든다.     
작은 부채꼴 $CS_2$의 영역은 언제나 삼각형 내부에 속하게 된다.   
선분 $\overline{OB}$의 길이는 $\cos\theta$이므로 이를 반지름으로 하는 부채꼴 $CS_2$의 넓이는 [식 13-10](#식-13-10)에 의해 다음과 같이 계산된다.

$$Area(CS_2) = \frac{\theta}{2} \cdot \cos^2 \theta$$

###### 그림 13-9 삼각형에 포함된 부채꼴의 넓이
![삼각형에 포함된 부채꼴의 넓이](/img/)

부채꼴에 관련된 세 영역의 넓이 $Area(CS_1)$, $Area(T)$, $Area(CS_2)$를 구하는 공식은 다음과 같은 대소 관계가 성립된다.

$$\frac{\theta}{2} \cdot \cos^2 \theta \leq \frac{\sin \theta}{2} \leq \frac{\theta}{2}$$

여기서 넓이 $Area(CS_1)$의 역수 $\frac{2}{\theta}$를 곱해 부등식을 정리하면 다음과 같다.

$$\cos^2\theta \leq \frac{\sin\theta}{\theta} \leq 1$$

$\theta$를 $h$로 변경한 후 우변의 극한값 $\lim_{h \rightarrow 0}1$과 좌변의 극한값 $\lim_{h \rightarrow 0}\cos^2 h$를 구한다.

$$\lim_{h \rightarrow 0}\cos^2 h \leq \lim_{h \rightarrow 0}\frac{\sin h}{h} \leq \lim_{h \rightarrow 0}1$$

우변의 극한값 $\lim_{h \rightarrow 0}1$은 상수이므로 바로 1임을 확인할 수 있다.

좌변 $\lim_{h \rightarrow 0}\cos^2h$의 $\cos$ 함수는 각이 0도 수렴할 수록 그 값은 1에 수렴한다.     
따라서 이를 제곱한 극한값 역시 1에 수렴한다.        
극한의 성질 6으로 정리한 극한의 조임 정리에 의해 좌우의 극한값이 동일한 경우 가운데에 위치한 $\frac{\sin h}{h}$의 극한값 또한 1이 되어 [식 13-9](#식-13-9)가 성립함을 확인할 수 있다.       
여기에 추가로 알아두면 좋은 함수의 극한값은 다음과 같다.

###### 식 13-11

$$\lim_{h \rightarrow 0}\frac{\cos h - 1}{h} = 0$$

[식 13-11](#식-13-11)은 다음 과정을 거쳐서 유도된다.

$$
\begin{matrix}
\lim_{h \rightarrow 0}\frac{\cos h - 1}{h} &=& \lim_{h \rightarrow 0}\frac{(\cos h -1) \cdot (\cos h + 1)}{h \cdot (\cos h + 1)} \\
&=& \lim_{h \rightarrow 0}\frac{\cos^2 h - 1}{h \cdot (\cos h + 1)} \\
&=& \lim_{h \rightarrow 0}\frac{-\sin^2 h}{h \cdot (\cos h + 1)} \\
&=& \lim_{h \rightarrow 0}\sin h \cdot \lim_{h \rightarrow 0}\frac{-\sin h}{h} \cdot \lim_{h \rightarrow 0}\frac{1}{(\cos h + 1)} \\
&=& 0 \\
\end{matrix}
$$

1. 함수의 분자와 분모에 각각 $(\cos h + 1)$을 곱한다.
2. 분자에 삼각함수 공식 $\cos^2 \theta + \sin^2 \theta = 1$을 적용해 $-\sin^2 h$로 단순하게 만든다.
3. 극한의 성질 3을 사용해 각 극한을 곱으로 분리한다.
4. 각 극한값을 순서대로 구하면 0, 1, $\frac{1}{2}$이 되는데 이들을 곱하면 0이 된다.

[식 13-9](#식-13-9)와 [식 13-11](#식-13-11)을 사용해 삼각함수의 도함수를 하나씩 구한다.     
먼저 $f(x) = \sin x$라 할 때 이의 도함수를 확인한다.    

$$
\begin{matrix}
f'(x) &=& \lim_{h \rightarrow 0}\frac{\sin(x + h) - \sin x}{h} \\
&=& \lim_{h \rightarrow 0}\frac{\cos h \cdot \sin x + \cos x \cdot \sin h - \sin x}{h} \\
&=& \sin x \cdot \lim_{h \rightarrow 0}\frac{\cos h - 1}{h} + \cos x \cdot \lim_{h \rightarrow 0}\frac{\sin h}{h} \\
&=& \cos x \\
\end{matrix}
$$

1. 삼각함수의 덧셈 정리를 사용해 분리한다.
2. 극한식을 분리하고 $h$와 관련없는 $\sin x$와 $\cos x$는 극한식 밖으로 빼낸다.
3. 우변의 좌향 극한식에 [식 13-11](#식-13-11)을 적용하고 우향 극한식에는 [식 13-9](#식-13-9)를 적용하면 $\cos x$만 남는다.

따라서 $\sin$ 함수의 도함수는 $\cos$ 함수가 됨을 알 수 있다.    
함수 $f(x)$를 $\cos x$라 할 때 도함수를 구한다.

$$
\begin{matrix}
f'(x) &=& \lim_{h \rightarrow 0}\frac{\cos(x + h) - \cos(x)}{h} \\
&=& \lim_{h \rightarrow 0}\frac{\cos x \cdot \cos h - \sin x \cdot \sin h - \cos x}{h} \\
&=& \cos x \cdot \lim_{h \rightarrow 0}\frac{\cos h - 1}{h} - \sin x \cdot \lim_{h \rightarrow 0}\frac{\sin h}{h} \\
&=& -\sin x \\
\end{matrix}
$$

1. 삼각함수의 덧셈 정리를 사용해 분리한다.
2. 극한식을 분리하고 $h$와 관련없는 $\sin x$와 $\cos x$는 극한식 밖으로 빼낸다.
3. 우변의 좌항 극한식에 [식 13-11](#식-13-11)을 적용하면 $\cos x$만 남는다.

이는 앞서 구한 $\sin$ 함수의 도함수 전개와 유사하며 $\cos$ 함수의 도함수는 $-\sin x$가 됨을 알 수 있다.

$\sin$ 함수의 도함수는 $\cos$ 함수고 $\cos$ 함수의 도함수는 $-\sin$ 함수다.     
따라서 다음과 같은 식이 성립할 것이다.

$$f(x) = \sin x$$

$$f'(x) = \cos x$$

$$f''(x) = -\sin x$$

여기서 두 번 더 미분하면 원함수인 $\sin$ 함수로 돌아오게 된다.

$$f'''(x) = -\cos x$$

$$f^{(4)}(x) = \sin x$$

이렇게 네 번 미분했을 때 원함수로 돌아오는 성질은 $\cos$ 함수도 동일하다.

$$f(x) = \cos x$$

$$f'(x) = -\sin x$$

$$f''(x) = -\cos x$$

$$f'''(x) = \sin x$$

$$f^{(4)}(x) = \cos x$$

따라서 $\sin$ ***함수와*** $\cos$ ***함수는 네 번 미분하면 원함수로 돌아오기 때문에 자연지수함수와 동일한 성질을 가진 무한번 미분 가능한 함수다***.     
이들의 연관성은 급수를 통해 확인할 수 있다.

# 47. 급수
***오일러 공식에는 자연지수함수와 두 삼각함수의 미분이 사용된다***.   
***무한번 미분 가능하다는 공통점을 가진 세 함수는 각각 무한 급수로 표현***될 수 있고 세 함수가 모두 무한 급수로 표현되면 오일러 공식을 유도할 수 있다.    
무한번 미분 가능한 함수를 무한 급수로 표현하기 위해선 ***등비수열***에 대해 알아야 한다.

# 47.1. 등비수열
***수열(Sequence)*** 이란 규칙에 따라 순서에 맞게 수를 나열한 것이다.      
예를 들어 1부터 시작해서 1씩 커지는 자연수를 순서대로 나열하면 1, 2, 3, 4, ...로 이어지는 수열을 이룬다.    
이 수열은 자연수 집합과 유사하다.   
하지만 ***집합은 순서의 개념이 없고 중복을 허용하지 않는다***는 점에서 ***수열과는 엄연히 다른 개념***이다.     
이 중에서도 연속된 항들이 일정한 ***비(Ratio)*** 로 증가하는 수열을 ***등비수열(Geometric sequence)*** 이라고 하며, 등비수열 규칙에 사용된 비를 ***공비(Common ratio)*** 라고 한다.      
다음은 등비수열의 한 예시로, 연속된 두 항이 $\frac{1}{2}$배씩 증가하는 규칙을 가지므로 공비는 $\frac{1}{2}$이 된다.

$$\frac{1}{2}, \frac{1}{4}, \frac{1}{8}, \frac{1}{16}, \frac{1}{32}, ...$$

수열의 첫 번째 값을 ***초항(First term)*** 이라 부르며 $a$로 표기한다.     
공비는 $r$로, $n$번째의 항은 $a_n$으로 표기해, 다음과 같은 식으로 등비수열을 나타낸다.

$$a_n = a \cdot r^{n - 1}$$

등비수열의 $n + 1$번째 항과 $n$번째 항에 공비를 적용하면 다음과 같은 관계가 성립한다.

$$a_{n + 1} = a_n \cdot r$$

# 47.2. 급수
수열의 개념을 확장해 수열의 모든 값을 더한 것을 ***급수(Series)*** 라고 한다.      
초항 $a_0$와 $n$개의 요소로 구성된 수열의 급수는 시그마 기호($\sum$)를 활용해 간략히 표현한다.

$$\sum_{k = 0}^n a_k = a_0 + a_1 + a_2 + a_3 + ... + a_n$$

등비수열의 급수는 다음과 같이 표현할 수 있다.

$$\sum_{k = 0}^\infty a \cdot r^k$$

등비수열의 급수를 특별히 ***기하급수(Geometric series)*** 라고 한다.       
***기하급수는 무한대로 계속 증가하거나 특정 수로 수렴하는 성질이 있다***.     
공비가 $\frac{1}{2}$인 등비수열의 급수가 어떤 값 $s$에 수렴한다면 다음과 같이 표현할 수 있다.

$$s = \frac{1}{2} + \frac{1}{4} + \frac{1}{8} + \frac{1}{16} + \frac{1}{32} + ... \quad (1)$$

그렇다면 수렴하는 급수 값 $s$는 얼마인지 확인해보자.    
급수 값 $s$에 공비 $\frac{1}{2}$를 곱한 식은 다음과 같다.

$$\frac{1}{2}s = \frac{1}{2}(\frac{1}{2} + \frac{1}{4} + \frac{1}{8} + \frac{1}{16} + \frac{1}{32} + ...) \quad (2)$$

[1]에서 [2]를 빼면 좌변은 $\frac{1}{2}s$가 남고 우변은 $\frac{1}{2}$이 남는다.

$$\frac{1}{2}s = \frac{1}{2}$$

이 식이 만족하려면 $s$는 1이어야 하므로 급수 값은 1에 수렴한다.     
이 기하급수를 시각적으로 표현하면 [그림 13-10](#그림-13-10-무한한-기하급수의-수렴)과 같다.      
기하급수의 요소는 무한하지만 이를 모두 더한 값은 가로와 세로의 길이가 1인 정사각형의 넓이 1에 수렴하는 것을 확인할 수 있다.

###### 그림 13-10 무한한 기하급수의 수렴
![무한한 기하급수의 수렴](/img/)

위에서 계산한 기하급수를 구하는 과정을 일반화시켜 정리한다.     
등비수열의 초항을 $a$, 공비를 $r$이라고 했을 때, $n$개의 유한한 등비급수를 $s_n$으로 표현하면 다음 식이 성립된다.

$$s_n = a + ar + ar^2 + ar^3 + ... + ar^{n - 1} \quad (1)$$

[1]의 양변에 공비 $r$을 곱하면 다음과 같이 전개된다.

$$rs_n = ar + ar^2 + ar^3 + ... + ar^n \quad (2)$$

그리고 [1]에서 [2]를 빼면 다음 식이 나온다.

$$s_n - rs_n = a - ar^n$$

좌변을 $s_n$에 대해 묶으면 다음의 식이 유도된다.

$$
\begin{matrix}
s_n(1 - r) &=& a(1 - r^n) \\
s_n &=& \frac{a(1 - r^n)}{1 - r} \\
\end{matrix}
$$

기하급수는 무한 개의 요소를 가지므로 위 식의 $n$에 무한대의 극한을 설정하고 이를 전개해보자.

$$
\begin{matrix}
\lim_{n \rightarrow \infty} s_n &=& \lim_{n \rightarrow \infty} \frac{a(1 - r^n)}{1 - r} \\
&=& \frac{a}{1 - r} \cdot \lim_{n \rightarrow \infty}(1 - r^n) \\
&=& \frac{a}{1 - r} - \frac{a}{1 - r} \cdot \lim_{n \rightarrow \infty} r^n \\
\end{matrix}
$$

1. 극한의 성질 2에 따라 $n$이 들어가지 않는 상수를 빼낸다.
2. 극한의 성질 1에 따라 극한 내 두 항을 분리한다.

$\lim_{n \rightarrow \infty} s_n$의 극한값을 구하려면 공비 $r$이 가질 수 있는 값을 여러 개로 분리하고 각각에 대한 극한을 생각해야 한다.     
먼저 공비 $r$이 1이라면 $\frac{a}{1 - r}$의 분모가 0이 되어 극한값을 구할 수 없다.      
공비 $r$이 1인 경우의 무한급수는 어떻게 전개되는지 살펴보자.       
공비 $r$이 1이면 다음과 같이 기하급수는 $a$를 무한 번 더한 식이 되므로 급수 값은 무한대로 발산한다.

$$s_n = a + a + a + a + ...$$

$r$이 1이 아닌 경우를 생각해보면, 공비 $r$이 1이 아닌 경우 $\frac{a}{1 - r}$는 상수가 되므로 $\lim_{n \rightarrow \infty} s_n$의 극한값은 $\lim_{n \rightarrow \infty}$의 값에 따라 결정된다.

만일 공비 $r$의 크기가 1보다 크다면, 즉 $|r| > 1$인 경우에는 공비를 계속 곱할수록 크기도 계속 커져 $\lim_{n \rightarrow \infty} r^n$의 극한값은 발산한다.

$$
\begin{matrix}
-1.1^2 &=& 1.21 \\
-1.1^3 &=& -1.331 \\
-1.1^4 &=& 1.4641 \\
&...& \\
\end{matrix}
$$

공비 $r$의 크기가 1보다 작다면, 즉 $|r| < 1$인 경우에는 공비를 계속 곱할수록 그 값의 크기는 계속 작아져 이의 극한값은 0으로 수렴한다.

$$
\begin{matrix}
-0.9^2 &=& 0.81 \\
-0.9^3 &=& -0.729 \\
-9.9^4 &=& 0.6561 \\
&...& \\
\end{matrix}
$$

공비 $r$이 -1이면 $\lim_{n \rightarrow \infty} r^n$의 값은 일정한 값을 가지지 못하고 규칙적으로 1과 -1값을 오고간다.

$$
\begin{matrix}
-1^2 &=& 1 \\
-1^3 &=& -1 \\
-1^4 &=& 1 \\
&...& \\
\end{matrix}
$$

이러한 현상을 ***진동한다(Oscilate)*** 고 표현하는데, 이 역시 ***특정 값으로 수렴하지 않으므로 발산으로 취급***된다.

지금까지 살펴본 공비 $r$의 값에 따른 $\lim_{n \rightarrow \infty} s_n$의 성질을 정리하면 다음과 같다.

- $r = 1$인 경우에는 발산한다.
- $|r| > 1$인 경우에는 발산한다.
- $|r| < 1$인 경우에는 수렴한다.
- $r = -1$인 경우에는 발산한다.

이 중에서 기하급수가 수렴하기 위한 조건은 $|r| < 1$이다.    
공비가 $\frac{1}{2}$인 기하급수는 수렴 조건을 만족하기 때문에 $\lim_{n \rightarrow \infty} r^n$의 극한값은 0이 되어 $\frac{a}{1 - r}$에 수렴됐던 것이다.

기하급수에서 좀 더 확장된 형태의 급수에 대해 알아보자.      
기하급수는 더해지는 모든 항의 계수 $a$의 값이 모두 같았다.      
그런데 다음과 같이 항마다 계수가 다른 급수도 있는데, 이를 ***멱급수(Power series)*** 라고 한다.

$$\sum_{n = 0}^\infty a_n \cdot r^n = a_1 + a_2r + a_3r^2 + a_4r^3 + a_5r^4 + ...$$

즉 기하급수는 모든 계수의 값이 동일한 멱급수의 한 종류라고 할 수 있다.      
멱급수도 기하급수와 동일하게 특정 조건에 따라 수렴하거나 발산하는데, 이를 판정하기 위한 ***비판정법(Ratio test)*** 에 대해 알아야 한다.    
비판정법은 멱급수의 항의 계수가 일정한 규칙으로 전개되는 경우, 다음의 극한값을 구해 수렴, 발산 여부를 파악하는 방법이다.

$$L = \lim_{n \rightarrow \infty}|\frac{a_n + 1}{a_n}|$$

비판정법의 결과로 계산되는 $L$의 값은 다음과 같은 3가지 경우가 있다.

- $L$의 값이 1보다 작으면 급수는 언제나 수렴한다.
- $L$의 값이 1보다 크면 급수는 언제나 발산한다.
- $L$의 값이 1이면 수렴할 수도, 발산할 수도 있다.

기하 급수 예제를 멱급수의 관점에서 다시 살펴보면 기하 급수는 모든 계수의 값이 동일한 $a$이고 공비가 $r$인 멱급수의 형태를 띤다.

$$\sum_{n = 0}^\infty a \cdot r^n$$

이 식에 비판정법을 적용한 결과 값은 $n$과 무관하게 $|r|$이 나온다.

$$L = \lim_{n \rightarrow \infty}|\frac{a \cdot r^{n + 1}}{a \cdot r^n}| = |r|$$

급수가 수렴하기 위해서는 $L$의 값이 1보다 작아야 하는데 이는 $|r| < 1$을 의미한다.      
기하급수가 수렴하기 위한 조건과 동일하다.       
이와 같이 멱급수가 수렴하기 위해 $r$이 가져야 할 범위를 수렴구간이라고 하며, 범위의 절반인 1의 값을 ***수렴반지름(Radius of convergence)*** 이라고 한다.

각 항의 계수가 서로 다른 멱급수의 수렴 조건을 분석해보자.

$$\sum_{n = 1}^\infty \frac{r^n}{n} = x + \frac{1}{2}r^2 + \frac{1}{3}r^3 + \frac{1}{4}r^4 + ...$$

이 식에 비판정법을 적용하면 다음과 같이 전개된다.

$$
\begin{matrix}
L &=& \lim_{n \rightarrow \infty}|\frac{\frac{r^{n + 1}}{n + 1}}{\frac{r^n}{n}}| \\
&=& \lim_{n \rightarrow \infty}|r| \cdot \frac{n}{n + 1} \\
&=& |r| \cdot \lim_{n \rightarrow \infty} \frac{n}{n + 1} \\
&=& |r| \cdot \lim_{n \rightarrow \infty} \frac{(n + 1) - 1}{n + 1} \\
&=& |r| - |r| \cdot \lim_{n \rightarrow \infty} \frac{1}{n + 1} \\
&=& |r| \\
\end{matrix}
$$

이로써 해당 멱급수가 수렴하기 위한 조건은 $L = |r|$이 됨을 알 수 있다.      
따라서 위 멱금수 또한 기하 급수와 동일한 수렴반지름을 가짐을 알 수 있다.

# 47.3. 매클로린 급수
멱급수가 수렴하기 위한 조건을 알아봤으니, 이제 본격적으로 ***무한 미분 가능한 함수를 멱급수 형태로 바꾸는 방법***에 대해 알아야 한다.     
이러한 멱급수를 ***매클로린 급수(Macalurin series)*** 혹은 ***테일러 급수(Taylor series)*** 라고 한다.       
수렴하는 멱급수에서 공비 값을 $x$로 바꿔서 멱급수를 다음과 같은 함수 $f(x)$로 정의한다.

###### 식 13-12

$$f(x) = a_1 + a_2x + a_3x^2 + a_4x^3 + a_5x^4 + ...$$

이 멱급수에 대응되는 어떤 함수가 있다고 가정한다.   
그 함수가 무한 미분 가능하다면 멱급수의 도함수는 [식 13-7](#식-13-7)에서 살펴본 거듭제곱 함수의 미분을 사용해 다음과 같이 전개된다.

$$f'(x) = 1 \cdot a_2 + 2a_3x + 3a_4x^2 + 4a_5x^3 + ...$$

$$f''(x) = (2 \cdot 1)a_3 + (3 \cdot 2)a_4x + (4 \cdot 3)a_5x^2 + ...$$

$$f'''(x) = (3 \cdot 2 \cdot 1)a_4 + (4 \cdot 3 \cdot 2)a_5x + ...$$

원함수 $f(x)$를 $n$차 미분한 모든 도함수의 $x$값에 0을 대입하면 다음과 같이 멱급수를 구성하는 각 항의 계수값 $a_n$값과 일정한 규칙을 가지는 상수만 남는다.

###### 식 13-13

$$f(0) = a_1$$

$$f'(0) = 1 \cdot a_2$$

$$f''(0) = (2 \cdot 1)a_3$$

$$f'''(0) = (3 \cdot 2 \cdot 1)a_4$$

$$...$$

여기서 어떤 자연수보다 작은 모든 자연수의 곱을 ***계승(Factorial)*** 이라 부르는데, ! 기호를 사용해서 축약해 표현한다.     
계승을 수식으로 표현하면 다음과 같다.

$$n! = (n - 1)! \cdot n$$

$$\therefore (n - 1)! = \frac{n!}{n}$$

위의 식에서 0의 계승 0!의 값은 1임을 알 수 있다.

$$0! = (1 - 1)! = \frac{1!}{1} = 1$$

[식 13-13](#식-13-13)도 계승을 사용해 다음과 같이 간단히 표기할 수 있다.    

###### 식 13-14

$$f(0) = 0! \cdot a_1$$

$$f'(0) = 1! \cdot a_2$$

$$f''(0) = 2! \cdot a_3$$

$$f'''(0) = 3! \cdot a_4$$

$$...$$

[식 13-14](#식-13-14)의 각 도함수 식을 살펴보면 멱급수의 $n$번째 계수 $a_n$은 [식 13-15](#식-13-15)와 같이 함수 $f(x)$를 $n$번 미분한 도함수에 0을 대입한 값을 $n$ 계승 값으로 나눠주면 얻을 수 있다.

###### 식 13-15

$$a_n = \frac{f^{(n)}(0)}{n!}$$

[식 13-12](#식-13-12)의 멱급수 전개는 [식 13-16](#식-13-16)과 같이 $n$번 미분한 도함수에 0을 대입한 형태로 일반화할 수 있다.   
이를 매클로린 급수 또는 테일러 급수라고 한다.       
***매클로린 급수는 무한급수이므로 무한 미분 가능한 함수만이 이 수식을 만족한다***.

###### 식 13-16

$$f(x) = \frac{f(0)}{0!} + \frac{f'(0)}{1!}x + \frac{f''(0)}{2!}x^2 + \frac{f'''(0)}{3!}x^3 + ...$$

매클로린 급수의 표현 방법을 확인했으니 ***오일러 공식을 유도하는 데 필요한 자연지수함수,*** $\sin$ ***함수,*** $\cos$ ***함수***를 매클로린 급수 형식으로 전개하고 이들이 수렴하는지 확인한다.    
먼저 자연지수함수에 대해 알아보자.

$$f(x) = e^x$$

자연지수함수의 매클로린 급수는 다음과 같이 전개된다.

$$
\begin{matrix}
f(x) &=& \frac{f(0)}{0!} + \frac{f'(0)}{1!}x + \frac{f''(0)}{2!}x^2 + \frac{f'''(0)}{3!}x^3 + ... \\
&=& 1 + x + \frac{1}{2!}x^2 + \frac{1}{3!}x^3 + \frac{1}{4!}x^4 + \frac{1}{5!}x^5 + \frac{1}{6!}x^6 + \frac{1}{7!}x^7 ... \\
&=& \sum_{n = 0}^\infty \frac{x^n}{n!} \\
\end{matrix}
$$

자연지수함수에 대응하는 매클로린 급수가 수렴하는지 판단하기 위해 비판정법을 진행한다.

$$
\begin{matrix}
L &=& \lim_{n \rightarrow \infty} |\frac{\frac{x^{n + 1}}{(n + 1)!}}{\frac{x^n}{n!}}| \\
&=& \lim_{n \rightarrow \infty}|x| \cdot \frac{n!}{(n + 1)!} \\
&=& |x| \cdot \lim_{n \rightarrow \infty} \frac{1}{n + 1} \\
&=& |x| \cdot 0 \\
&=& 0 \\
\end{matrix}
$$

비판정을 진행한 결과는 0이 나오므로 해당 급수는 언제나 수렴함을 확인할 수 있다.     
따라서 ***자연지수함수의 매클로린 급수는 유효하다***.

###### 식 13-17

$$e^x = \sum_{n = 0}^\infty \frac{x^n}{n!}$$

$\sin$ 함수에 대해 진행한다.

$$f(x) = \sin x$$

$\sin$ 함수의 매클로린 급수는 다음과 같이 전개된다.

$$
\begin{matrix}
f(x) &=& \frac{f(0)}{0!} + \frac{f'(0)}{1!}x + \frac{f''(0)}{2!}x^2 + \frac{f'''(0)}{3!}x^3 + ... \\
&=& 0 + x - 0 - \frac{1}{3!}x^3 + 0 + \frac{1}{5!}x^5 - 0 - \frac{1}{7!}x^7 ... \\
&=& \sum_{n = 0}^\infty \frac{(-1)^nx^{2n + 1}}{(2n + 1)!} \\
\end{matrix}
$$

$\sin$ 함수에 대응하는 매클로린 급수의 비판정을 진행한다.

$$
\begin{matrix}
L &=& \lim_{n \rightarrow \infty}|\frac{\frac{(-1)^{n + 1}x^{2n + 3}}{(2n + 3)!}}{\frac{(-1)^nx^{2n + 1}}{(2n + 1)!}}| \\
&=& \lim_{n \rightarrow \infty}|x^2| \cdot \frac{(2n + 1)!}{(2n + 3)!} \\
&=& |x^2| \cdot \lim_{n \rightarrow \infty}\frac{1}{(2n + 3)(2n + 2)} \\
&=& 0 \\
\end{matrix}
$$

0이 나오므로 $\sin$ ***함수의 매클로린 급수는 유효함***을 확인할 수 있다.

###### 식 13-18

$$\sin x = \sum_{n = 0}^\infty \frac{(-1)^nx^{2n + 1}}{(2n + 1)!}$$

$\cos$ 함수에 대해 진행한다.

$$f(x) = \cos x$$

$\cos$ 함수의 매클로린 급수는 다음과 같이 전개된다.

$$
\begin{matrix}
f(x) &=& \frac{f(0)}{0!} + \frac{f'(0)}{1!}x + \frac{f''(0)}{2!}x^2 + \frac{f'''(0)}{3!}X^3 + ... \\
&=& 0 - x - \frac{1}{2!}x^2 + 0 + \frac{1}{4!}x^4 - 0 - \frac{1}{6!}x^6 ... \\
&=& \sum_{n = 0}^\infty \frac{(-1)^nx^{2n}}{(2n)!} \\
\end{matrix}
$$

$\cos$ 함수에 대응하는 매클로린 급수의 비판정을 진행해보면 $\sin$ 함수와 동일하게 0의 결과가 나옴을 확인할 수 있다.

$$
\begin{matrix}
L &=& \lim_{n \rightarrow \infty}|\frac{\frac{(-1)^{n + 1}x^{2n + 2}}{(2n + 2)!}}{\frac{(-1)^nx^{2n}}{(2n)!}} \\
&=& \lim_{n \rightarrow \infty}|x^2| \cdot \frac{(2n)!}{(2n + 2)!} \\
&=& |x^2| \cdot \lim_{n \rightarrow \infty} \frac{1}{(2n + 2)(2n + 1)} \\
&=& 0 \\
\end{matrix}
$$

따라서 $\cos$ 함수에 대응되는 매클로린 급수는 다음과 같다.

###### 식 13-19

$$\cos x = \sum_{n = 0}^\infty \frac{(-1)^nx^{2n}}{(2n)!}$$

> 참고: ***매클로린 급수의 활용***      
매클로린 급수는 컴퓨터에서 복잡한 함수의 근사값을 구할 때 유용하게 사용된다.    
예를 들어 $\sin$ 함수의 값을 컴퓨터에서 계산하고자 하는 경우 매클로린 급수를 사용하면 허용 가능한 오차 내의 이의 정밀한 값을 빠르게 계산할 수 있다.     
[식 13-18](#식-13-18)에서 $\sin$ 함수와 일치하는 매클로린 급수는 무한 개의 원소를 가지고 있으며 0을 제외한 급수식은 다음과 같다.
> 
> $$\sin x = x - \frac{1}{3!}x^3 + \frac{1}{5!}x^5 - \frac{1}{7!}x^7 ...$$
> 
> 여기서 첫항 $x$를 제외한 나머지 항을 모두 없앤다.
>
> $$\sin x \neq x$$
> 
> 함수 $f(x) = x$와 $f(x) = \sin x$의 그래프는 큰 차이가 있다.      
하지만 $f(x) = x$에 급수의 항을 하나씩 추가할수록 새로운 급수의 계산 결과는 $\sin$ 함수의 값과 점점 가까워진다.
> 
> $$\sin x \approx x - \frac{1}{3!}x^3 + \frac{1}{5!}x^5 - \frac{1}{7!}x^7$$
> 
> [그림 13-11](#그림-13-11-sin-함수와-매클로린-급수의-비교)에 $\sin$ 함수의 그래프와 한 단계씩 전개한 급수로 표현되는 함수를 비교했다.     
급수의 항을 하나씩 추가할 수록 함수의 모습은 $\sin$ 함수에 근접해지는 것을 확인할 수 있다.
> 
> ###### 그림 13-11 sin 함수와 매클로린 급수의 비교
> ![sin 함수와 매클로린 급수의 비교](/img/)     
> 
> 급수의 항을 충분히 추가하면 $\sin$ 함수 값과 급수 값 사이의 오차가 무의미한 수준까지 비슷해진다.      
그렇다면 각 급수항에 계승으로 나눈 상수를 미리 계산해두면, 급수는 덧셈과 곱셈으로만 구성된다.       
이는 컴퓨터로 굉장히 빠르게 계산할 수 있어 좀 더 효과적으로 함수 값을 구할 수 있다.

# 48. 오일러 공식
자연지수함수, $\sin$ 함수, $\cos$ 함수에 대응하는 매클로린 급수를 [식 13-17](#식-13-17), [식 13-18](#식-13-18), [식 13-19](#식-13-19)에 정리했고, 이들을 모으면 다음과 같다.

$$e^x = 1 + x + \frac{1}{2!}x^2 + \frac{1}{3!}x^3 + \frac{1}{4!}x^4 + \frac{1}{5!}x^5 + \frac{1}{6!}x^6 + \frac{1}{7!}x^7 ...$$

$$\sin x = 0 + x - 0 - \frac{1}{3!}x^3 + 0 + \frac{1}{5!}x^5 - 0 - \frac{1}{7!}x^7 ...$$

$$\cos x = 1 - 0 - \frac{1}{2!}x^2 + 0 + \frac{1}{4!}x^4 - 0 - \frac{1}{6!}x^6 + 0 ...$$

세 급수를 분석해서 서로 간의 연관성을 찾기 위해 먼저 $\sin$ 함수와 $\cos$ 함수에 대응하는 두 급수를 더한다.     
$\sin$ 함수는 매클로린 급수를 전개하는 과정에서 홀수항 부분이 0이 되고, $\cos$ 함수는 짝수항 부분이 0이 되다보니, $\sin$ 함수와 $\cos$ 함수의 매클로린 급수를 합하면 다음과 같이 서로에게 부족한 부분이 채워진다.

###### 식 13-20

$$\cos x + \sin x = 1 + x - \frac{1}{2!}x^2 - \frac{1}{3!}x^3 + \frac{1}{4!}x^4 + \frac{1}{5!}x^5 - \frac{1}{6!}x^6 - \frac{1}{7!}x^7 + ...$$

[식 13-20](#식-13-20)은 자연지수함수의 매클로린 급수와 유사한 형태가 되었지만 몇몇 항의 부호에서 차이가 발생한다.       

두 급수의 부호가 일치하려면 크기가 1이고 제곱하면 -1이 되는 수를 사용해야 한다.     
이러한 수는 실수에는 존재하지 않지만, 복소수의 허수 단위 $i$가 이를 만족한다.       
자연지수함수의 매클로린 급수에 허수 단위 $i$를 넣으면 다음과 같이 전개된다.

$$
\begin{matrix}
e^{ix} &=& 1 + ix + \frac{1}{2!}(ix)^2 + \frac{1}{3!}(ix)^3 + \frac{1}{4!}(ix)^4 + \frac{1}{5!}(ix)^5 + \frac{1}{6!}(ix)^6 + \frac{1}{7!}(ix)^7 + ... \\
&=& 1 + ix - \frac{1}{2!}x^2 - \frac{i}{3!}x^3 + \frac{1}{4!}x^4 + \frac{i}{5!}x^5 - \frac{1}{6!}x^6 - \frac{i}{7!}x^7 + ... \\
\end{matrix}
$$

자연지수함수에 허수 단위 $i$를 넣은 결과로 [식 13-20](#식-13-20)의 매클로린 급수와 동일한 부호가 만들어지는 것을 확인할 수 있다.

이제 $e^{ix}$의 매클로린 급수와 [식 13-20](#식-13-20)의 차이는 단지 짝수 항에 허수 단위 $i$가 붙어 있다는 것 뿐이다.    
$\cos x + \sin x$에서 짝수 항은 $\sin$ 함수가 담당하므로 $\sin$ 함수에 허수 $i$를 곱하면 비로소 오일러 공식의 모든 퍼즐이 맞춰진다.

###### 식 13-21

$$e^{ix} = \cos x + i \sin x$$

[식 13-21](#식-13-21)에서 $x$대신 각 $\theta$를 대입한다.   
그러면 다음과 같은 ***오일러 공식***이 유도된다.

$$e^{i\theta} = \cos \theta + i \sin \theta$$

우변의 식 $\cos \theta + i \sin \theta$는 ***복소평면에서 회전 변환을 담당하는 단위 복소수를 의미***한다.     
따라서 오일러 공식의 좌변에 위치한 $e^{i\theta}$는 ***복소평면에서의 회전 변환을 의미***한다.     
이로써 ***2차원 평면의 회전을 나타내는 방법***이 하나 더 추가됐다.

$$e^{i\theta} = (\cos \theta, \sin \theta) = 
\begin{bmatrix}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta \\
\end{bmatrix}
$$

***행렬과 복소수를 사용해 표현했던 회전 변환***은 ***오일러 공식으로*** $e^{i\theta}$ ***라는 자연지수함수로 더욱 간단하게 표현***할 수 있게 되었다.       
예를 들어 각 $\alpha, \beta$의 회전 변환은 오일러 공식에 의해 각각 $e^{\alpha i}$와 $e^{\beta i}$로 표현할 수 있다.     
이 둘을 곱하면 $(\alpha + \beta)$의 회전 변환이 만들어지는데, 지수법칙에 의해 이 둘을 곱하면 자연스럽게 $e^{(\alpha + \beta)i}$가 만들어진다.

$$e^{(\alpha + \beta)i} = e^{\alpha i} \cdot e^{\beta i}$$

이러한 ***회전 변환을 단순화시키는 오일러 공식의 특징은 복잡한 4차원 공간의 회전을 단순화시켜 3차원 공간의 회전식을 유도하는 데 큰 역할을 한다***.

> 참고: ***세상에서 가장 아름다운 공식, 오일러 항등식***    
오일러 공식에서 $x$값에 $\pi$를 대입하면 다음과 같은 식이 성립된다.     
> 
> ###### 식 13-22
> 
> $$
\begin{matrix}
e^{i\pi} &=& \cos \pi + i \sin \pi \\
e^{i\pi} &=& -1 + 0 \\
e^{i\pi} + 1 &=& 0 \\
\end{matrix}$$
>
> 이 식은 오일러 항등식(Euler's identity)이라 불리며, 수학의 근간이 되는 5가지 특별한 상수 $e, \pi, i, 0, 1$을 하나씩 사용한다는 점에서 수학자들이 뽑은 세상에서 가장 아름다운 공식이라 일컬어진다.       
각 상수가 가지는 의미는 [표 13-2](#표-13-2-오일러-항등식이-가지는-의미)와 같다.
>
> ###### 표 13-2 오일러 항등식이 가지는 의미    
> 
> |상수|의미|
> |---|---|
> |0|덧셈의 항등원|
> |1|곱셈의 항등원|
> |$e$|무리수 $e$|
> |$\pi$|원주율|
> |$i$|허수|

# 49. 사원수 대수
***사원수는 복소수와 동일하게 허수를 사용하는 수의 집합***으로서, ***복소수가 하나의 실수부와 하나의 허수부로 구성***된 반면, ***사원수는 하나의 실수부와 세 개의 허수부로 구성***된다.       
***총 4가지 수 체계를 사용하기 때문에 사원수라고 한다***.

사원수에서는 세 허수부를 구성하는 단위를 각각 $i, j, k$로 표시한다.     

# 49.1. 사원수를 구성하는 세 허수
사원수는 3개의 허수부 $i, j, k$로 구성되어 있지만 이들은 모두 복소수의 허수 단위 $i$와 같은 성질을 가진다.

$$i^2 = -1$$

$$i^2 = j^2 = k^2 = -1$$

세 허수 중에서 두 허수의 곱은 다음과 같이 나머지 다른 허수에 대응되는데 이들은 회전의 순환 순서 $x \rightarrow y \rightarrow z \rightarrow x$와 유사하게 $i \rightarrow j \rightarrow k \rightarrow i$ 순서로 대응된다.

$$ij = k, jk - i, ki = j$$

이 식으로부터 $ij$의 값은 $k$가 되고 $kk$의 결과는 $-1$이므로 $ijk = -1$이라는 식이 성립한다.   
따라서 $ijk$ 값은 $-1$이 되며, 각 세 허수의 곱셈 결과는 다음과 같다.

$$ijk = jki = kij = -1$$

복소수가 $a + bi$의 형태를 가졌던 것처럼 사원수도 실수부와 허수부를 덧셈으로 묶고 실수를 사용해 허수부의 계수를 지정한다.       
실수부와 각 허수부의 계수를 $a, b, c, d$로 지정한 사원수는 다음과 같이 표현한다.

$$q = a + bi + cj + dk$$

사원수의 집합 기호는 $H$다.     
***사원수(Quaternion)*** 의 첫글자 $Q$는 유리수 집합에서 사용되고 있기 때문에, 사원수를 처음 고안한 수학자 윌리엄 로언 해밀턴(William Rowan Hamilton)의 이름에서 차용했다.     
***사원수는 복소수와 유사하게 덧셈과 곱셈이 존재하며, 체와 유사한 구조를 지닌다***.       

# 49.2. 사원수의 구조
사원수의 덧셈은 복소수와 유사하게 실수부와 각 허수부끼리 더하는 형태로 진행된다.

$$q_1 + q_2 = (a_1 + a_2) + (b_1 + b_2)i + (c_1 + c_2)j + (d_1 + d_2)k$$

사원수의 덧셈이 만족하는 성질은 다음과 같다.

- 결합법칙: $q_1 + (q_2 + q_3) = (q_1 + q_2) + q_3 \\ = (a_1 + a_2 + a_3) + (b_1 + b_2 + b_3)i + (c_1 + c_2 + c_3)j + (d_1 + d_2 + d_3)k$
- 교환법칙: $q_1 + q_2 = q_2 + q_1 = (a_1 + a_2) + (b_1 + b_2)i + (c_1 + c_2)j + (d_1 + d_2)k$
- 항등원: $(a + bi + cj + dk) + (0 + 0i + 0j + 0k) = (a + bi + cj + dk)$
- 역원: $(a + bi + cj + dk) + (-a - bi - cj - dk) = (0 + 0i + 0j + 0k)$

[표 14-1](#표-14-1-사원수의-덧셈-연산의-성질)에 사원수 덧셈의 성질을 정리했다.

###### 표 14-1 사원수의 덧셈 연산의 성질
|연산의 성질|만족 여부 및 값|
|---|---|
|덧셈에 대해 닫혀 있음|O|
|덧셈에 대한 교환법칙이 성립함|O|
|덧셈에 대한 결합법칙이 성립함|O|
|덧셈에 대한 항등원이 존재함|0|
|덧셈에 대한 역원이 존재함|$-(a + bi + cj + dk)$|

사원수의 곱셈은 ***해밀턴 곱(Hamilton product)*** 으로도 불리며 ***모든 요소를 교차해 곱하는 방식으로 진행***된다.       
사원수는 총 4가지 요소로 구성되므로 곱의 결과는 총 16가지 인자가 만들어지며, 임의의 두 사원수 $q_1$과 $q_2$의 곱셈 결과는 다음과 같다.

$$q_1 \cdot q_2 = (a_1a_2 - b_1b_2 - c_1c_2 - d_1d_2) + (a_1b_2 + a_2b_1 + c_1d_2 - d_1c_2)i \\ + (a_1c_2 + a_2c_1 + b_2d_1 - b_1d_2)j + (a_1d_2 + a_2d_1 + b_1c_2 - c_1b_2)k$$

사원수의 곱셈이 만족하는 성질은 다음과 같다.

- 결합법칙: $q_1 \cdot (q_2 \cdot q_3) = (q_1 \cdot q_2) \cdot q_3$
- 분배법칙: $q_1 \cdot (q_2 + q_3) = q_1 \cdot q_2 + q_1 \cdot q_3$
- 항등원: $(a + bi + cj + dk) \cdot (1 + 0i + 0j + 0k) = (a + bi + cj + dk)$

사원수 곱셈은 순서를 바꿔 계산하면 다음과 같이 결과가 달라진다.

$$q_2 \cdot q_1 = (a_1a_2 - b_1b_2 - c_1c_2 - d_1d_2) + (a_1b_2 + a_2b_1 - c_1d_2 + d_1c_2)i \\ + (a_1c_2 + a_2c_1 - b_2d_1 + b_1d_2)j + (a_1d_2 + a_2d_1 - b_1c_2 + c_1b_2)k$$

따라서 ***사원수는 곱셈에 대해 교환법칙이 성립하지 않는다***.     
[표 14-2](#표-14-2-사원수-곱셈-연산의-성질)에 사원수 곱셈 연산의 성질을 정리했다.

###### 표 14-2 사원수 곱셈 연산의 성질
|성질|만족 여부 및 값|
|---|---|
|곱셈에 대해 닫혀 있음|O|
|곱셈에 대한 교환법칙이 성립함|X|
|곱셈에 대한 결합법칙이 성립함|O|
|곱셈에 대한 항등원이 존재함|1|
|곱셈에 대한 역원이 존재함|켤레를 활용해 계산|
|덧셈과 곱셈에 대한 분배법칙이 성립함|O|

***사원수 곱셈은 교환법칙이 성립되지 않아 체의 구조를 가지고 있지 않지만 결합법칙 등 나머지 체의 성질은 모두 만족한다***.     
***체의 구조에서 교환법칙이 성립하지 않는 구조***를 ***유사체(Skew field)*** 라고 하는데, 이에 따라 ***사원수는 유사체의 구조를 지닌다***.     
따라서 ***사원수끼리 곱셈식을 전개할 때 왼쪽과 오른쪽의 순서가 바뀌지 않도록 주의***해야 한다.        

사원수의 크기는 복소수와 동일하게 각 계수를 제곱한 값을 더하고 제곱근을 취해 계산하며 절댓값 기호 $||$를 써서 표기한다.     
사원수의 크기 역시 ***노름(Norm)*** 이라 부른다.

$$|q| = \sqrt{a^2 + b^2 + c^2 + d^2}$$

사원수 중에서 ***크기가 1인 사원수***를 ***단위 사원수(Unit quaternion)*** 라고 한다.    
사원수의 ***세 허수부의 계수에 음수를 적용한 사원수***를 ***켤레 사원수***라고 부르고 $q^*$로 표기하며 다음과 같이 표현한다.

$$q^* = a - (bi + cj + dk)$$

***사원수와 켤레 사원수의 곱은 복소수와 켤레 복소수 간의 곱의 성질과 동일***하다.

$$(q^*)^* = q$$

$$(pq)^* = q^*p^*$$

***임의의 사원수에 그 켤레를 곱하면 크기의 제곱 값이 나온다***.

$$q^*q = qq^* = a^2 + b^2 + c^2 + d^2 = |q|^2$$

따라서 단위 사원수와 그의 켤레 사원수를 곱한 값은 언제나 1이 된다.      
이러한 사원수도 복소수와 동일하게 켤레 사원수의 성질을 사용해 사원수 곱의 역원을 유도할 수 있다.

$$q^{-1} = \frac{1}{q} = \frac{q^*}{qq^*} = \frac{q^*}{|q|^2}$$

여기서 크기가 1인 단위 사원수의 곱셈의 역원은 복소수와 동일하게 켤레 사원수가 된다.

사원수의 곱셈에 대해 결합법칙이 성립하지 않는다는 점을 제외하고, 복소수와 사원수는 공통점이 많이 있다.      

# 49.3. 사원수와 벡터
2개의 요소를 사용하는 복소수는 2개의 수 집합이 직교하는 복소평면으로 시각화할 수 있다.      
이와 유사하게 4개의 요소를 사용하는 사원수는 4개의 수 집합이 직교하는 4차원의 공간으로 시각화가 가능하다고 생각할 수 있지만, 4차원 공간은 일반적인 인지범위를 넘어서기 때문에 이를 시각적으로 정확하게 표현하는 것은 불가능하다.      
그래서 사원수를 다룰 때에는 4차원 공간을 1차원과 3차원으로 분리하고 3차원 공간의 성질을 관찰하는 것이 더욱 효과적이다.

###### 그림 14-1 인지 불가능한 4차원 공간의 입방체 테서랙트(Tesseract)
![인지 불가능한 4차원 공간의 입방체(Tesseract)](/img/)

따라서 ***사원수를 다룰 때에는 허수부를 사용하는 3개의 수 집합을 하나로 묶고, 나머지 실수부는 별도로 관리하는 방법을 사용***한다.     
세 허수부의 계수를 3차원 벡터로 묶는다면, 사원수는 실수와 3차원 벡터 두 가지 요소로 구성된다고 볼 수 있다.      
사원수 $q$를 실수와 3차원 벡터로 구성된 순서쌍으로 표현하면 다음과 같다.

$$q = w + xi + yj + zk = (w, \vec{v})$$

이 ***순서쌍의 원소***를 차례대로 ***실수부, 허수부***라고 하는데, 이들을 ***스칼라부, 벡터부***라고도 부른다.        
3차원 벡터를 사용해 사원수를 표현하면 사원수의 연산을 좀 더 체계적으로 정리할 수 있다.      
임의의 두 사원수를 $q_1 = (w_1, \vec{v}_1), q_2 = (w_2, \vec{v}_2)$로 표현하고 사원수의 기본 연산인 덧셈과 곱셈을 다시 표현한다.        
사원수 $q_1$과 $q_2$의 덧셈은 다음과 같은 순서쌍으로 표현할 수 있다.

$$q_1 + q_2 = (w_1 + w_2, \vec{v}_1 + \vec{v}_2)$$

사원수 $q_1$과 $q_2$의 곱셈은 벡터의 ***내적과 외적을 사용***해 다음과 같이 깔끔하게 정리할 수 있다.

$$q_1 \cdot q_2 = (w_1w_2 - (\vec{v}_1 \cdot \vec{v}_2), w_1\vec{v}_2 + w_2\vec{v}_1 + \vec{v}_1 \times \vec{v}_2)$$

사원수의 곱셈을 내적과 외적으로 정리했는데, 이를 통해 사원수의 곱셈은 교환법칙이 성립하지 않는지도 확인할 수 있다.      
허수부를 구성하는 벡터 연산이 교환법칙이 성립하지 않는 외적에 관련되어 있기 때문이다.

사원수에서 ***실수부가 0인 사원수***를 특별히 ***순허수 사원수(Pure imaginary quarternion)*** 라고 부른다.       
순허수 사원수는 세 허수로만 구성된 수를 말하는데, 이는 3차원 벡터 공간에 대응되는 개념이다.     
즉 3차원 공간이 사원수를 다루는 4차원 공간의 일부라면, 3차원 공간의 벡터 $\vec{v} = (x, y, z)$는 다음의 순허수 사원수에 대응된다고 할 수 있다.

$$xi + yj + zk = (0, \vec{v})$$

순허수 사원수 $q_1$과 $q_2$의 곱셈을 전개하면 $w_1$과 $w_2$의 값이 0이다 보니 이들이 포함된 항의 값은 모두 0이 된다.        
곱셈 결과는 아래와 같이 내적과 외적만 남아 더욱 단순해진다.

$$q_1 \cdot q_2 = (-\vec{v}_1 \cdot \vec{v}_2, \vec{v}_1 \times \vec{v}_2)$$

# 50. 사원수의 회전
자연지수함수, $\sin$ 함수, $\cos$ 함수를 매클로린 급수로 전개했을 때 세 급수가 서로 통합되기 위해서는 크기가 1이고, 제곱한 수가 -1이 되는 특별한 수가 필요하다.     
복소수 체계에서 이 조건을 만족하는 특별한 수인 허수 $i$를 사용해 다음의 오일러 공식을 전개할 수 있다.

$$e^{i\theta} = \cos \theta + i \sin \theta = (\cos \theta, \sin \theta)$$

사원수에서도 허수 $i$와 동일하게 크기가 1이고 제곱한 값이 -1인 수가 있다면 오일러 공식을 만족한다.

# 50.1. 사원수와 오일러 공식
***크기가 1인 순허수 사원수도 크기가 1이고 제곱한 값이 -1이다***.     
크기가 1인 순허수 사원수를 $q_n$으로 지정하고 이를 직접 확인한다.       
먼저 순허수 사원수 $q_n$의 요소를 $(0, \vec{n})$으로 표시한다.      
$q_n$의 크기는 1이므로 다음의 식이 성립한다.

$$\sqrt{0 + |\vec{n}|^2} = 1$$

이로써 $\vec{n}$의 크기도 1이 됨을 알 수 있으며, 내적 $\vec{n} \cdot \vec{n}$의 값도 1이 된다.

$$|\vec{n}| = \vec{n} \cdot \vec{n} = 1$$

순허수 사원수 $q_n$의 제곱을 전개하면 다음과 같다.

$$q_n^2 = q_n \cdot q_n = (-\vec{n} \cdot \vec{n}, \vec{n} \times \vec{n})$$

그런데 $\vec{n} \cdot \vec{n}$은 1이고 ***평행한 벡터의 외적은 영벡터***가 되므로 위 식은 다음과 같이 간략하게 전개된다.

$$q_n \cdot q_n = (-1, \vec{0})$$

따라서 크기가 1인 순허수 사원수 $q_n$을 제곱한 결과는 $-1$이 됨을 확인할 수 있다.       
그렇다면 오일러 공식의 전개 과정에 허수 $i$대신 순허수 사원수의 벡터 $\vec{n}$을 사용할 수 있다.        
이렇게 하면 자연상수의 지수함수로 사원수의 회전을 표현하는 것이 가능하다.       
이를 수식으로 정리하면 단위 복소수와 형태가 유사해진다.

$$e^{\vec{n}\theta} = \cos \theta + \sin \theta \cdot \vec{n} = (\cos \theta, \sin \theta \cdot \vec{n})$$

$(\cos \theta, \sin \theta \cdot \vec{n})$ 형태의 사원수는 4차원 공간에서 회전축 $\vec{n}$을 중심으로 회전 변환하는 성질을 가지는데, 이를 ***회전 사원수(Rotation quaternion)*** 라고 한다.        
회전 사원수를 $q$, 벡터 $\vec{n}$의 요소를 $(a, b, c)$로 표기하고 이를 확인한다.        
여기서 벡터 $\vec{n}$은 크기가 1인 단위 벡터이므로 $a^2 + b^2 + c^2 = 1$의 조건에 의해 다음과 같이 전개되어 회전 사원수는 언제나 단위 사원수임을 확인할 수 있다.

$$q = \cos \theta + \sin \theta \cdot \vec{n} = \cos \theta + \sin \theta (ai + bj + ck)$$

$$|q| = \cos^2 \theta + \sin^2 \theta (a^2 + b^2 + c^2) = 1$$

회전 사원수의 켤레는 다음과 같이 표현한다.

$$q^* = (\cos \theta, -\sin \theta \cdot \vec{n})$$

이는 반대 방향의 회전을 의미한다.

$$q^* = (\cos(-\theta), \sin(-\theta) \cdot \vec{n})$$

반대 방향의 회전을 의미하는 회전 사원수의 켤레 사원수는 오일러의 공식으로도 확인할 수 있다.     
단위 사원수와 그 켤레를 곱한 값은 언제나 1이 나옴을 확인했는데, 이를 자연지수함수로 표현하면 다음과 같이 0의 지수로 나타낼 수 있다.

$$q \cdot q^* = 1 = e^0$$

오일러의 공식에 의해 회전 사원수에 대응하는 지수함수는 다음과 같다.

$$q = e^{\vec{n}\theta}$$

이를 회전 사원수 $q$에 치환한 식은 다음과 같이 전개된다.ㅣ

$$e^{\vec{n}\theta} \cdot q^* = e^0$$

이를 만족하는 $q^*$의 값은 $e^{-\vec{n}\theta}$이며 이는 같은 축 $\vec{n}$을 중심으로 반대 방향으로 $\theta$ 돌리는 회전을 의미한다.

$$\therefore q^* = e^{-\vec{n}\theta} = e^{\vec{n}(-\theta)}$$

# 50.2. 회전 사원수를 이용한 3차원 공간에서의 회전
회전 사원수 $q$를 사용해 임의의 회전축 $\vec{n}$에 대해 3차원 공간의 벡터 $\vec{v}$를 각 $\theta$만큼 회전시키는 방법을 확인해보자.

일반적으로 사용하는 ***3차원 공간의 벡터*** $\vec{v}$는 ***순허수 사원수에 대응되는 개념***이다.    
벡터 $\vec{v}$의 값을 $(x, y, z)$로 표시하고, 회전축 $\vec{n}$의 값을 $(a, b, c)$로 지정한다.       
회전축은 단위 벡터이기 때문에 $a^2 + b^2 + c^2 = 1$의 조건을 가진다.        
그리고 회전축 $\vec{n}$으로 각 $\theta$만큼 회전시키는 회전 사원수 $q$는 $(\cos \theta, \sin \theta \cdot \vec{n})$의 값을 가진다.

회전 사원수 $q$를 사용해 벡터를 회전시키는 방법은 회전 사원수를 벡터의 왼쪽에 배치하고 둘을 곱하는 것이다.          
이때 ***사원수의 곱셈은 교환법칙이 성립하지 않기 때문에 곱하는 순서에 항상 신경 써야 한다***.

회전 사원수와 순허수 사원수 벡터 $\vec{v}$의 곱셈은 다음과 같이 전개된다.

$$
\begin{matrix}
\vec{v^{'}} &=& q \cdot \vec{v} \\
&=& (\cos \theta, \sin \theta \cdot \vec{n}) \cdot (0, \vec{v}) \\
&=& (-\sin \theta (\vec{n} \cdot \vec{v}), \cos \theta \vec{v} + \sin \theta (\vec{n} \times \vec{v})) \\
\end{matrix}
$$

계산 결과를 살펴보면 ***회전 사원수와 벡터를 곱한 결과는 순허수 사원수가 아닌 네 요소를 모두 사용하는 일반 사원수가 나온다***.        
따라서 이 곱의 결과는 순허수 사원수와 1:1로 대응했던 3차원 공간의 규격에서 벗어나게 되므로 3차원 공간의 요소로 사용할 수 없게 된다.     
[그림 14-2](#그림-14-2-회전-사원수를-사용해-벡터를-회전시킨-결과)에 지금까지의 상황을 정리한다.

###### 그림 14-2 회전 사원수를 사용해 벡터를 회전시킨 결과
![회전 사원수를 사용해 벡터를 회전시킨 결과](/img/)

3차원 공간에서 벡터를 회전시키는 용도로 사원수를 사용하기 위해서는 ***사원수 곱의 결과가 항상 순허수 사원수가 되는 특별한 수식***을 발견해야 한다.        

회전 사원수의 벡터 $\vec{n}$은 회전축의 역할을 수행한다.        
이는 로드리게스 회전 공식에서 언급되는 축-각 회전에 대응하는 벡터다.     
3차원 공간에서 임의의 축 $\vec{n}$에 대한 회전을 표현하면 [그림 14-3](#그림-14-3-임의의-회전축-n에-대한-회전의-표현)과 같다.

###### 그림 14-3 임의의 회전축 n에 대한 회전의 표현
![임의의 회전축 n에 대한 회전의 표현](/img/)

회전시킬 벡터를 $\vec{v}$로 정하고 이를 회전축 $\vec{n}$에 평행한 성분과 수직인 성분으로 나눈다.            
회전축에 수평인 성분을 $\vec{v_\parallel}$, 수직인 성분을 $\vec{v_\perp}$으로 표시하면 다음 식이 성립된다.

$$\vec{v} = \vec{v_\parallel} + \vec{v_\perp}$$

[그림 14-4](#그림-14-4-회전시킬-벡터-v를-평행-성분과-수직-성분으로-분리한-결과)는 벡터 $\vec{v}$를 수직 성분과 수평 성분으로 분리해 나타낸 그림이다.        
이를 각 $\theta$만큼 회전 시킨 벡터를 $\vec{v^{'}}$로 가정한다.

###### 그림 14-4 회전시킬 벡터 v를 평행 성분과 수직 성분으로 분리한 결과
![회전시킬 벡터 v를 평행 성분과 수직 성분으로 분리한 결과](/img/)

이때 원하는 최종 회전의 벡터 $\vec{v^{'}}$는 [그림 14-5](#그림-14-5-3차원-공간에서의-회전의-구현)와 같이 회전축에 수직인 성분만 회전시킨 후, 수평 성분은 그대로 더하면 구할 수 있다.

###### 그림 14-5 3차원 공간에서의 회전의 구현
![3차원 공간에서의 회전의 구현](/img/)

따라서 3차원 공간에서의 회전은 다음과 같은 식이 될 것이다.

$$\vec{v^{'}} = \vec{v_\parallel} + q \cdot \vec{v_\perp}$$

***오일러 공식***을 활용해 위 수식을 간단하게 정리한다.       
이 식에서 회전 사원수 $q$를 자연지수함수로 바꿔 표현하면 다음과 같다.

$$\vec{v^{'}} = \vec{v_\parallel} + e^{\vec{n}\theta} \cdot \vec{v_\perp}$$

우변의 두 번째 항인 회전 사원수와 벡터와의 곱셈은 다음과 같이 간략하게 전개된다.

$$
\begin{matrix}
e^{\vec{n}\theta} \cdot \vec{v_\perp} &=& (-\sin \theta (\vec{n} \cdot \vec{v_\perp}), \cos \theta \vec{v_\perp} + \sin \theta (\vec{n} \times \vec{v_\perp})) \\
&=& (0, \cos \theta \vec{v_\perp} + \sin \theta (\vec{n} \times \vec{v_\perp})) \\
\end{matrix}
$$

회전축 $\vec{n}$와 이에 직교하는 벡터 $\vec{v_\perp}$의 내적은 항상 0이다.

이로써 회전축에 수직인 벡터와 회전 사원수의 곱으로 얻어지는 사원수는 항상 실수부 값이 0인 순허수 사원수가 되므로, 이의 결과는 언제나 3차원 공간의 벡터에 대응됨을 확인할 수 있다.

3차원 공간의 회전식을 간략하게 정리하도록 연산 순서를 바꾼다.       
연산 순서를 변경하면 ***외적의 성질***에 의해 $\sin$ ***함수의 부호가 반대로 바뀐다***.

$$\vec{v_\perp} \cdot e^{\vec{n} \theta} = (0, \cos \theta \vec{v_\perp} - \sin \theta (\vec{n} \times \vec{v_\perp}))$$

그러고 나서 회전 각에 $-\theta$를 대입하면, 이는 $\sin$ 함수에만 영향을 미치므로 다음과 같이 바뀐다.

$$
\begin{matrix}
\vec{v_\perp} \cdot e^{\vec{n}(-\theta)} &=& (0, \cos(-\theta) \vec{v_\perp} - \sin(-\theta)(\vec{n} \times \vec{v_\perp})) \\
&=& (0, \cos \theta \vec{v_\perp} + \sin \theta (\vec{n} \times \vec{v_\perp})) \\
\end{matrix}
$$

두 항의 순서를 바꿔 연산한 결과는 처음 식과 동일하므로 회전축과 직교하는 벡터에 대해서는 다음과 같은 식이 성립한다.

$$e^{\vec{n}\theta} \cdot \vec{v_\perp} = \vec{v_\perp} \cdot e^{\vec{n}(-\theta)}$$

수식에 등장하지 않지만 회전축에 평행한 벡터 $\vec{v_\parallel}$의 회전 사원수 곱이 가지는 성질을 살펴보자.      
평행인 두 벡터의 외적은 영벡터가 되므로 실수부가 남고 허수부가 단순화된다.

$$e^{\vec{n}\theta} \cdot \vec{v_\parallel} = (-\sin \theta (\vec{n} \cdot \vec{v_\parallel}), \cos \theta \vec{v_\parallel})$$

이때 사원수 곱에서 ***교환법칙의 성립을 방해하던 외적 부분***이 사라졌기 때문에, 평행인 벡터와의 곱은 다음과 같이 ***항상 교환법칙이 성립***한다.

$$e^{\vec{n}\theta} \cdot \vec{v_\parallel} = \vec{v_\parallel} \cdot e^{\vec{n}\theta}$$

식을 좀 더 단순화하기 위해, 회전 사원수를 둘로 쪼개서 나타낸다.     
각 $\theta$의 회전을 수행하는 회전 사원수는 이를 절반으로 나눈 각 $\frac{\theta}{2}$의 회전 사원수를 두 번 곱한 결과와 동일하다.

$$e^{\vec{n}\theta} = e^{\vec{n}(\frac{\theta}{2})} \cdot e^{\vec{n}(\frac{\theta}{2})}$$

회전 사원수와 그 켤레 사원수와의 곱은 아무런 변화 없는 $0^\circ$ 회전을 만들어내므로, 이들의 곱은 곱셈의 항등원 1에 대응된다.

$$1 = e^{0} = e^{\vec{n}(\frac{\theta}{2})} \cdot e^{\vec{n}(-\frac{\theta}{2})}$$

직교하는 벡터와 평행하는 벡터의 성질을 파악했다면, 이를 활용해 3차원 공간에서의 회전을 전개하면 다음과 같이 정리된다.

$$
\begin{matrix}
v' &=& \vec{v_\parallel} + e^{\vec{n}\theta} \cdot \vec{v_\perp} \\
&=& e^0 \cdot \vec{v_\parallel} + e^{\vec{n}\theta} \cdot \vec{v_\perp} \\
&=& e^{\vec{n}(\frac{\theta}{2})} \cdot e^{\vec{n}(-\frac{\theta}{2})} \cdot \vec{v_\parallel} + e^{\vec{n}(\frac{\theta}{2})} \cdot e^{\vec{n}(\frac{\theta}{2})} \cdot \vec{v_\perp} \\
&=& e^{\vec{n}(\frac{\theta}{2})} \cdot \vec{v_\parallel} \cdot e^{\vec{n}(-\frac{\theta}{2})} + e^{\vec{n}(\frac{\theta}{2})} \cdot \vec{v_\perp} \cdot e^{\vec{n}(-\frac{\theta}{2})} \\
&=& e^{\vec{n}(\frac{\theta}{2})} \cdot (\vec{v_\parallel} + \vec{v_\perp}) \cdot e^{\vec{n}(-\frac{\theta}{2})} \\
&=& e^{\vec{n}(\frac{\theta}{2})} \cdot \vec{v} \cdot e^{\vec{n}(-\frac{\theta}{2})} \\
\end{matrix}
$$

1. 평행한 벡터 $\vec{v_\parallel}$의 계수 1을 지수함수로 바꿔 표현한다.
2. 평행한 벡터의 계수는 두 개의 상반되는 회전의 곱으로 표현하고, 직교하는 벡터의 계수에 적용하는 회전은 절반 회전의 곱으로 표현한다.
3. 평행한 벡터와의 곱은 교환법칙이 성립하고, 직교하는 벡터와의 곱은 연산 순서를 바꿨을 때 각의 부호가 반대로 바뀐다.
4. 사원수는 덧셈의 분배법칙이 성립하므로 묶을 수 있다.
5. 평행한 벡터와 직교하는 벡터의 합은 원 벡터 $\vec{v}$가 된다.

간략해진 최종 식에서 자연지수함수를 다시 사원수의 형태로 바꾼다.        
각 $\theta$가 아닌 이의 절반값 $\frac{\theta}{2}$만큼 돌리는 회전 사원수를 $q$로 표현한다.      
반대 방향으로 돌리는 사원수는 켤레 사원수 $q^*$가 된다.

$$e^{\vec{n}(\frac{\theta}{2})} = q$$

3차원 공간의 회전을 보장하는 사원수의 회전식은 [식 14-1](#식-14-1)과 같이 최종 정리된다.

###### 식 14-1

$$
\begin{matrix}
v' &=& e^{\vec{n}(\frac{\theta}{2})} \cdot \vec{v} \cdot e^{\vec{n}(-\frac{\theta}{2})} \\
&=& q \cdot v \cdot q^* \\
\end{matrix}
$$

회전 사원수에 사용한 각은 $\frac{\theta}{2}$이므로 여기에 사용한 사원수 $q$의 값은 다음과 같다.

$$q = (\cos \frac{\theta}{2}, \sin \frac{\theta}{2}\vec{n})$$

3차원 공간의 회전을 보장하는 사원수의 회전식이 [식 14-1](#식-14-1)로 깔끔하게 정리된다.     
절반의 각만 회전시키는 단위 사원수를 임의의 벡터와 곱했을 때 그 결과는 항상 실수부가 0인 순허수 사원수가 나오는지 확인해보자.       
회전 사원수 $q$의 실수부와 허수부를 각각 $w$와 $\vec{r}$로 표시해 식을 간단하게 전개한다.

$$q = (\cos \frac{\theta}{2}, \sin \frac{\theta}{2}\vec{n}) = (w, \vec{r})$$

[식 14-1](#식-14-1)을 내적과 외적의 형태로 바꾸면 다음과 같이 전개된다.

$$
\begin{matrix}
v' &=& q \cdot v \cdot q* \\
&=& (w, \vec{r}) \cdot (0, \vec{v}) \cdot (w, -\vec{r}) \\
&=& (-(\vec{r} \cdot \vec{v}), w\vec{v} + \vec{r} \times \vec{v}) \cdot (w, -\vec{r}) \\
&=& (-(\vec{r} \cdot \vec{v})w - (w\vec{v} + \vec{r} \times \vec{v}) \cdot (-\vec{r}), -(\vec{r} \cdot \vec{v}) \cdot -\vec{r} + w(w\vec{v} + \vec{r} \times \vec{v}) + (w\vec{v} + \vec{r} \times \vec{v}) \times -\vec{r}) \\
\end{matrix}
$$

이 결과 중에서 실수부와 허수부를 다음과 같이 각각 따로 전개한다.        
우선 첫 항인 실수부를 전개하면 다음과 같다.

$$
\begin{matrix}
-(\vec{r} \cdot \vec{v})w - (w\vec{v} + \vec{r} \times \vec{v}) \cdot (-\vec{r}) &=& -(\vec{r} \cdot \vec{v})w + w(\vec{v} \cdot \vec{r}) + (\vec{r} \times \vec{v}) \cdot \vec{r} \\
&=& -(\vec{r} \cdot \vec{v})w + w(\vec{v} \cdot \vec{r}) \\
&=& -(\vec{r} \cdot \vec{v})w + (\vec{r} \cdot \vec{v})w \\
&=& 0
\end{matrix}
$$

1. $(\vec{r} \times \vec{v}) \cdot \vec{r}$ 항의 결과는 외적으로 직교하는 벡터를 생성한 후에 이를 내적하므로 언제나 0이 나온다.
2. 내적은 교환법칙이 성립하므로 스칼라와 벡터의 순서를 동일하게 맞춰준다.

[식 14-1](#식-14-1)을 내적과 외적으로 전개했을 때 실수부 값은 언제나 0이 나온다.        
이는 [그림 14-6](#그림-14-6-실수부가-0인-3차원-공간에서의-회전을-보장하는-사원수의-곱셈-공식)과 같이 절반의 각과 그 켤레를 사용해 회전시킨 결과는 항상 3차원 공간의 벡터에 대응된다고 할 수 있다.

###### 그림 14-6 실수부가 0인 3차원 공간에서의 회전을 보장하는 사원수의 곱셈 공식
![실수부가 0인 3차원 공간에서의 회전을 보장하는 사원수의 곱셈 공식](/img/)

허수부의 결과는 어떻게 정리되는지 확인해보자.       
허수부는 사원수를 사용해 회전된 벡터 $\vec{v'}$가 나온다.       
허수부의 수식을 전개하면 다음과 같다.

$$
\begin{matrix}
\vec{v'} &=& -(\vec{r} \cdot \vec{v}) \cdot -\vec{r} + w(w\vec{v} + \vec{r} \times \vec{v}) + (w\vec{v} + \vec{r} \times \vec{v}) \times -\vec{r} \\
&=& (\vec{r} \cdot \vec{v}) \cdot \vec{r} + w^2\vec{v} + w(\vec{r} \times \vec{v}) - w(\vec{v} \times \vec{r}) - (\vec{r} \times \vec{v}) \times \vec{r} \\
&=& (\vec{r} \cdot \vec{v}) \cdot \vec{r} + w^2\vec{v} + 2w(\vec{r} \times \vec{v}) - (\vec{r} \times \vec{v}) \times \vec{r} \\
&=& (\vec{r} \cdot \vec{v}) \cdot \vec{r} + (1 - \vec{r} \cdot \vec{r}) \cdot \vec{v} + 2w(\vec{r} \times \vec{v}) - (\vec{r} \times \vec{v}) - (\vec{r} \times \vec{v}) \times \vec{r} \\
&=& \vec{v} + (\vec{r} \cdot \vec{v}) \cdot \vec{r} - (\vec{r} \cdot \vec{r}) \cdot \vec{v} + 2w(\vec{r} \times \vec{v}) - (\vec{r} \times \vec{v}) \times \vec{r} \\
&=& \vec{v} + \vec{r} \times (\vec{r} \times \vec{v}) + 2w(\vec{r} \times \vec{v}) - (\vec{r} \times \vec{v}) \times \vec{r} \\
&=& \vec{v} + 2w(\vec{r} \times \vec{v}) + 2(\vec{r} \times (\vec{r} \times \vec{v})) \\
\end{matrix}
$$

1. 외적은 순서를 바꾸면 반대 부호가 나오므로 $w(\vec{r} \times \vec{v}) - w(\vec{v} \times \vec{r})$는 $2w(\vec{r} \times \vec{v})$가 된다.
2. 회전 사원수는 단위 사원수이므로 $w^2 + |\vec{r}|^2 = 1$이 성립하는데, 이를 내적으로 바꾸면 $w^2 = 1 - \vec{r} \cdot \vec{r}$이 성립한다.
3. 벡터 삼중곱 공식을 사용해 $(\vec{r} \cdot \vec{v}) \cdot \vec{r} - (\vec{r} \cdot \vec{r}) \cdot \vec{v}$를 벡터 삼중곱 $\vec{r} \times (\vec{r} \times \vec{v})$로 치환한다.
4. 마지막 항에 위치한 외적식의 순서를 뒤집어 벡터 삼중곱으로 변환한 외적식과 함께 묶는다.

최종 값 $\vec{v} + 2w(\vec{r} \times \vec{v}) + 2(\vec{r} \times (\vec{r} \times \vec{v}))$에서 $2(\vec{r} \times \vec{v})$를 벡터 $\vec{t}$로 치환하면 위 식은 [식 14-2](#식-14-2)와 같이 단순하게 정리된다.

###### 식 14-2

$$\vec{v'} = \vec{v} + w\vec{t} + \vec{r} \times \vec{t}$$

이로써 사원수를 사용해 3차원 공간의 벡터 $\vec{v}$를 임의의 회전축 $\vec{n}$을 중심으로 각 $\theta$만큼 회전시키는 최종 수식이 완성된다.

[식 14-2](#식-14-2)를 $\frac{\theta}{2}$가 아닌 각 $\theta$를 중심으로 전개하면 [식 9-2](#식-9-2)의 로드리게스 회전 공식이 유도된다.

$$
\begin{matrix}
\vec{v'} &=& \vec{v} + 2w(\vec{r} \times \vec{v}) + 2(\vec{r} \times (\vec{r} \times \vec{v})) \\
&=& \vec{v} + 2 \cos \frac{\theta}{2}(\sin\frac{\theta}{2}\vec{n}\times \vec{v}) + 2(\sin\frac{\theta}{2}\vec{n} \times (\sin \frac{\theta}{2} \vec{n} \times \vec{v})) \\
&=& \vec{v} + 2 \cos \frac{\theta}{2}\sin\frac{\theta}{2}(\vec{n} \times \vec{v}) + 2\sin^2 \frac{\theta}{2}(\vec{n} \times (\vec{n} \times \vec{v})) \\
&=& \vec{v} + \sin(\frac{\theta}{2} + \frac{\theta}{2})(\vec{n} \times \vec{v}) + (1 - \cos(\frac{\theta}{2} + \frac{\theta}{2})) (\vec{n} \times (\vec{n} \times \vec{v})) \\
&=& \vec{v} + \sin \theta(\vec{n} \times \vec{v}) + (1 - \cos \theta)((\vec{n} \cdot \vec{v})\vec{n} - (\vec{n} \cdot \vec{n})\vec{v}) \\
&=& \vec{v} - (1 - \cos \theta)(\vec{n} \cdot \vec{n})\vec{v} + \sin \theta(\vec{n} \times \vec{v}) + (1 - \cos \theta)(\vec{n} \cdot \vec{v})\vec{n} \\
&=& \cos \theta \vec{v} + (1 - \cos \theta)(\vec{n} \cdot \vec{v})\vec{n} + \sin \theta(\vec{n} \times \vec{v}) \\
\end{matrix}
$$

1. [식 14-2](#식-14-2)를 삼각함수와 회전축으로 바꿔 표현한다.
2. 각 요소에 사용한 모든 삼각함수 값을 계수로 빼서 정리한다.
3. 삼각함수의 배각 공식 $\sin 2\theta = 2\sin\theta \cos \theta$와 $\cos 2 \theta = 1- 2\sin^2\theta$를 사용해 $\frac{\theta}{2}$의 삼각함수를 $\theta$의 삼각함수로 변경한다.
4. 벡터 삼중곱을 내적으로 구성된 수식으로 변경한다.

이로써 회전 사원수의 벡터부에서 설정한 벡터 $\vec{n}$은 축-각 회전에서 회전축의 기능을 수행한다는 사실을 확인할 수 있다.        
그리고 각 $\theta$를 기준으로 전개했을 때보다 각 $\frac{\theta}{2}$를 기준으로 전개했을 때 식이 더 간편해진다는 것을 알 수 있다.

같은 회전축에 두 개의 다른 각을 연속해서 회전시키는 경우를 알아보자.        
첫 번째 각의 크기를 $2\alpha$, 두 번째 각의 크기를 $2\beta$로 지정하고 회전할 벡터를 $\vec{v}$, 첫 번째 회전을 적용한 벡터를 $\vec{v'}$, 두 번째 회전을 적용한 벡터를 $\vec{v''}$로 표기하면 두 회전 변환을 적용한 식은 다음과 같다.

$$\vec{v'} = q_\alpha \cdot \vec{v} \cdot q^*_\alpha$$

$$\vec{v''} = q_\beta \cdot \vec{v'} \cdot q^*_\beta$$

벡터 $\vec{v'}$를 $q_\alpha \cdot \vec{v} \cdot q^*_\alpha$로 치환하면 $\vec{v''}$를 계산하는 식은 다음과 같이 전개된다.

$$
\begin{matrix}
\vec{v''} &=& q_\beta \cdot (q_\alpha \cdot \vec{v} \cdot q_\alpha^*) \cdot q_\beta^* \\
&=& (q_\beta \cdot q_\alpha) \cdot \vec{v} \cdot (q_\alpha^* \cdot q_\beta^*) \\
&=& (q_\beta \cdot q_\alpha) \cdot \vec{v} \cdot (q_\beta \cdot q_\alpha)^* \\
&=& q_{(\alpha + \beta)} \cdot \vec{v} \cdot q^*_{(\alpha + \beta)} \\
\end{matrix}
$$

1. 사원수의 곱셈은 결합법칙을 만족하므로 벡터를 가운데 두고 양 옆으로 묶을 수 있다.
2. 켤레 사원수로 묶으면 두 사원수의 순서는 뒤집힌다.
3. 두 회전 사원수의 곱은 두 각을 더한 회전 사원수와 동일하다.

이로써 ***3차원 공간의 회전을 위해 절반의 각과 켤레 사원수를 사용하더라도 서로 다른 두 회전 사원수의 곱은 두 각을 합한 회전 사원수와 형태가 동일하다***는 점을 확인할 수 있다.        

# 51. 사원수의 변환
사원수를 활용해 3차원 벡터를 회전시키는 기능을 구현할 수 있지만, 사원수를 구성하는 요소 값은 직관적이지 않아 실제로 사용하는 회전을 설계할 때 어려움이 따른다.

3차원 공간에서 물체의 회전을 설정할 때에는 오일러 각 방식이 사원수보다 직관적이고 편리하기 때문에, 오일러 각의 값을 사원수로 변환해주는 기능을 만들면 게임 제작에 유용하게 사용할 수 있다.

# 51.1. 오일러 각에서 사원수로의 변환
***오일러 각의 각 회전은*** $x, y, z$ ***기저 축이 회전축의 역할을 수행***한다.     
3차원 공간에서 $x$축을 중심으로 각 $\theta$만큼 회전시키는 데 사용하는 회전 사원수 $q$는 다음과 같다.

$$q = (\cos \frac{\theta}{2}, \sin \frac{\theta}{2} \cdot \vec{x}) = \cos \frac{\theta}{2} + \sin \frac{\theta}{2} i$$

따라서 오일러 각을 구성하는 롤, 피치, 요 회전에 대응하는 각 사원수 $q_{roll}, q_{pitch}, q_{yaw}$는 각각 다음과 같이 표기된다.

$$q_{roll} = \cos \frac{\theta_{roll}}{2} + \sin \frac{\theta_{roll}}{2}k$$

$$q_{pitch} = \cos \frac{\theta_{pitch}}{2} + \sin \frac{\theta_{pitch}}{2}i$$

$$q_{yaw} = \cos \frac{\theta_{yaw}}{2} + \sin \frac{\theta_{yaw}}{2}j$$

오일러 각의 회전 순서를 롤, 피치, 요 순으로 적용하고, 이에 대응하는 사원수를 동일한 순서에 맞춰서 곱하면 오일러 각에 대응하는 사원수가 만들어진다.        
이를 계산하면 [식 14-3](#식-14-3)과 같다.

###### 식 14-3

$$q_{yaw} \cdot q_{pitch} \cdot q_{roll} = \cos \frac{\theta_{roll}}{2} \cos \frac{\theta_{pitch}}{2} \cos \frac{\theta_{yaw}}{2} + \sin \frac{\theta_{roll}}{2} \sin \frac{\theta_{pitch}}{2} \sin \frac{\theta_{yaw}}{2} + \\
(\cos \frac{\theta_{roll}}{2} \sin \frac{\theta_{pitch}}{2} \cos \frac{\theta_{yaw}}{2} + \sin \frac{\theta_{roll}}{2} \cos \frac{\theta_{pitch}}{2} \sin \frac{\theta_{yaw}}{2})i + \\
(\cos \frac{\theta_{roll}}{2} \cos \frac{\theta_{pitch}}{2} \sin \frac{\theta_{yaw}}{2} - \sin \frac{\theta_{roll}}{2} \sin \frac{\theta_{pitch}}{2} \cos \frac{\theta_{yaw}}{2})j + \\
(\sin \frac{\theta_{roll}}{2} \cos \frac{\theta_{pitch}}{2} \cos \frac{\theta_{yaw}}{2} - \cos \frac{\theta_{roll}}{2} \sin \frac{\theta_{pitch}}{2} \sin \frac{\theta_{yaw}}{2})k$$

# 51.2. 사원수에서 오일러 각으로의 변환
거꾸로 사원수로부터 오일러 각의 값을 변환하는 방법에 대해 알아보자.     
[식 14-3](#식-14-3)에서 실수부를 $w$, 각 허수부 값을 $x, y, z$로 치환한 후 $2(wz + xy)$를 계산한 결과를 살펴본다.       
요, 롤 피치의 절반각을 $y, r, p$로 표기하고, 이들의 $\sin$ 값을 $sy, sr, sp$로 지정하고 $\cos$ 값을 $cr, cp, cy$로 지정해 식을 전개하면 다음과 같다.

$$
\begin{matrix}
w &=& cr \cdot cp \cdot cy + sr \cdot sp \cdot sy \\
z &=& sr \cdot cp \cdot cy - cr \cdot sp \cdot sy \\
wz &=& cy^2 \cdot cr \cdot cp^2 \cdot sr - cy \cdot ct^2 \cdot cp \cdot sy \cdot sp + cy \cdot cp \cdot sy \cdot sr^2 \cdot sp - cr \cdot sy^2 \cdot sr \cdot sp^2 \\
x &=& sy \cdot sr \cdot cp + sp \cdot cy \cdot cr \\
y &=& sy \cdot cp \cdot cr - sp \cdot sr \cdot cy \\
xy &=& cr \cdot cp^2 \cdot sy^2 \cdot sr - cy \cdot cp \cdot sy \cdot sr^2 \cdot sp + cy \cdot cr^2 \cdot cp \cdot sy \cdot sp - cy^2 \cdot cr \cdot sr \cdot sp^2 \\
\end{matrix}
$$

사원수로부터 오일러 각을 구하려면 사원수를 잘 조합해 단일 각에 대한 삼각함수가 나오도록 식을 설정해야 한다.     
롤 회전에 대한 삼각함수를 만들어주는 $wz + xy$의 값을 계산한다.

$$
\begin{matrix}
wz + xy &=& cr \cdot cp^2 \cdot sr - (cy \cdot cp \cdot sy \cdot sp) + cy \cdot cp \cdot sy \cdot sp - (cr \cdot sr \cdot sp^2) \\
&=& cr \cdot sr(cp^2 - sp^2) \\
&=& \frac{\sin(2r)}{2} \cdot \cos (2p) \\
\end{matrix}
$$

삼각함수의 배각 공식을 사용해 두 배의 각으로 변환한다.

$2(wz + xy)$의 값은 $\sin\theta_{roll} \cdot \cos \theta_{pitch}$가 된다.       
같은 방식으로 $1 - 2(z^2 + x^2)$를 계산하면 $\cos \theta_{roll} \cdot \cos \theta_{pitch}$가 된다.      
그렇다면 $\sin\theta_{roll} \cdot \cos\theta_{pitch}$ 값을 $\cos\theta_{roll} \cdot \cos \theta_{pitch}$로 나누면 다음과 같이 롤 회전의 $\tan$ 값이 나온다.

$$\frac{\sin\theta_{roll} \cdot \cos\theta_{pitch}}{\cos\theta_{roll} \cdot \cos\theta_{pitch}} = \tan\theta_{roll} = \frac{2(wz + xy)}{(1 - 2(z^2 + x^2))}$$

이제 롤 회전의 값은 $\arctan$ 함수를 사용해 구할 수 있다.

$$\theta_{roll} = atan2(2(wz + xy), 1 - 2(z^2 + x^2))$$

피치 회전에 대한 삼각함수를 만들어주는 $wx - yz$ 값은 다음과 같이 전개된다.

$$
\begin{matrix}
wx - yz &=& \sin\frac{\theta_{pitch}}{2} \cdot \cos\frac{\theta_{pitch}}{2} \\
&=& \frac{1}{2}\sin\theta_{pitch} \\
\end{matrix}
$$

$\sin$ 함수의 배각 공식을 사용해 간략화 한다.

따라서 피치 회전각은 $\arcsin$ 함수를 사용해 구할 수 있다.

$$\theta_{pitch} = asin(2(wx - yz))$$

이때 주의할 점은 $\arcsin$ 함수의 정의역은 $|-1, 1|$ 범위로 제한되어 있으므로 $wx - yz$ 값이 $|-0.5, 0.5|$ 범위를 벗어나지 않는지 확인하고 벗어나는 경우에는 범위 내 가장 가까운 값으로 설정해야 한다.

요 회전은 롤 회전과 유사한 방식으로 요 회전의 $\tan$ 함수 값을 구한 후 $\arctan$ 함수를 사용한다.

$$\theta_{yaw} = atan2(2(wy + xz), 1 - 2(x^2 + y^2))$$

# 51.3. 사원수에서 회전 변환행렬로의 변환
사원수에서 회전 변환행렬로 변환하는 식을 계산해보자.        
***회전 변환행렬은 로컬 축으로 구성***되어 있기 때문에 사원수를 사용해 회전된 세 로컬 축의 값을 구하면 쉽게 해결할 수 있다.       
[식 14-2](#식-14-2)를 활용해 사원수로 로컬축을 회전한 결과를 계산한다.

사원수를 구성하는 네 요소를 $x, y, z, w$라고 할 때 $\vec{r}$의 값은 $(x, y, z)$이 되고 여기에 회전시킬 벡터 값을 $\vec{v}$에 대입하면 외적 식으로 회전된 벡터 값을 계산할 수 있다.      
먼저 회전할 벡터는 $x$축 기저벡터 $(1, 0, 0)$이다.      
이를 계산한 결과는 사원수에 의해 회전된 $x$ 로컬 축을 의미한다.

$$
\begin{matrix}
x_{local} &=& (1, 0, 0) + w(0, 2z, -2y) + (x, y, z) \times (0, 2z, -2y) \\
&=& (1, 2zw, -2yw) + (-2y^2 - 2z^2, 2xy, 2xz) \\
&=& (1 - 2(y^2 + z^2), 2(xy + zw), 2(xz - yw)) \\
\end{matrix}
$$

마찬가지로 동일한 사원수에 벡터 $(0, 1, 0), (0, 0, 1)$을 곱하면 각각 다음 식이 나온다.

$$y_{local} = (2(xy - zw), 1 - 2(x^2 + z^2), 2(yz + xw))$$

$$z_{local} = (2(xz + yw), 2(yz - xw), 1 - 2(x^2 + y^2))$$

모든 로컬 축을 구했다면, 이들을 꽂아 넣으면 회전 변환행렬을 만들 수 있다.

###### 식 14-4

$$
\begin{bmatrix}
1-2(y^2 + z^2) & 2(xy - zw) & 2(xz + yw) \\
2(xy + zw) & 1-2(x^2 + z^2) & 2(yz - xw) \\
2(xz - yw) & 2(yz + xw) & 1-2(x^2 + y^2) \\
\end{bmatrix}
$$

# 51.4. 회전 변환행렬에서 사원수로의 변환
회전 변환행렬에서 사원수를 구하는 방법을 알아보자.      
[식 14-4](#식-14-4)를 통해 사원수에서 회전행렬을 구하는 식을 확인했다.      
행렬의 요소를 조합해서 사원수를 구성하는 $x, y, z, w$ 값을 개별로 구하는 방법을 찾아야 한다.        
이는 정방행렬의 모든 대각 성분의 합을 더하는 것에서 실마리를 찾을 수 있다.      
***정방행렬의 대각 성분을 모두 더한 값***을 ***트레이스(Trace)*** 라고 하는데, [그림 14-7](#그림-14-7-정방행렬에서의-트레이스의-표현)과 같이 행렬의 성분과 연산을 표현한다.

###### 그림 14-7 정방행렬에서의 트레이스의 표현
![정방행렬에서의 트레이스의 표현](/img/)

[식 14-4](#식-14-4)의 회전 변환행렬에서 대각행렬 값을 모두 더한 트레이스 $t$는 다음과 같이 계산된다.

$$
\begin{matrix}
t &=& 1 - 2(y^2 + z^2) + 1-2(x^2 + z^2) + 1-2(x^2 + y^2) \\
&=& 3-4(x^2 + y^2 + z^2) \\
\end{matrix}
$$

여기에 1을 더하면 제곱근을 씌울 수 있는 형태가 나오는데 크기가 1인 회전 사원수의 성질에 의해 $x^2 + y^2 + z^2$의 값은 $1 - w^2$이 되므로 트레이스 값은 $4w^2$가 된다.

$$t + 1 = 4 - 4(x^2 + y^2 + z^2) = 4w^2$$

여기에 제곱근을 씌운 값에서 양수 값을 $r$로 지정하면 $r$과 트레이스 $t$의 관계는 다음과 같다.

$$r = 2w = \sqrt{t + 1}$$

사원수의 $w$값은 다음과 같이 구할 수 있다.

$$w = \frac{1}{2}r$$

여기서 구한 $w$ 값을 이용해 나머지 값 $x, y, z$를 구한다.       
회전 변환행렬을 살펴보면 대각 방향으로 대칭된 행렬의 요소를 서로 빼면 두 사원수 요소의 곱으로 정리된다.     
예를 들어 두 번째 열 벡터의 세 번째 요소에서 세 번째 열벡터의 두 번째 요소를 빼면 다음 식이 만들어진다.

$$2yz + 2xw - 2yz + 2xw = 4xw$$

이 식을 그림으로 나타내보면 [그림 14-8]과 같다.     
[그림 14-7](#그림-14-7-정방행렬에서의-트레이스의-표현)과 색상이 다른 부분은 빼는 요소를 의미한다.

###### 그림 14-8 xw값을 구하기 위한 행렬의 성분
![xw값을 구하기 위한 행렬의 성분](/img/)

비슷한 방법으로 세 번째 열벡터의 첫 번째 요소에서 첫 번째 열벡터의 세 번째 요소를 빼면 $yw$를 구할 수 있다.

$$2xz + 2yw - 2xz + 2yw = 4yw$$

마지막으로 첫 번째 열벡터의 두 번째 요소에서 두 번째 열벡터의 첫 번째 요소를 빼면 $zw$값이 얻어진다.

$$2xy + 2zw - 2xy + 2zw = 4zw$$

[그림 14-9](#그림-14-9-yw-zw-값을-구하기-위한-행렬의-성분)의 (a)에 $yw$를 구하는 식에 사용하는 행렬의 요소를, (b)에는 $zw$를 구하는 식에 사용되는 행렬의 요소를 정리한다.

###### 그림 14-9 yw, zw 값을 구하기 위한 행렬의 성분
![yw, zw 값으 구하기 위한 행렬의 성분](/img/)

이 방식으로 사원수를 구할 때는 예외 사항이 있다.      
트레이스 값이 -1보다 작거나 같으면 제곱근을 구하는 값이 0보다 작거나 같아져 $w$를 구하는 데 필요한 $r$의 해가 존재하지 않는다.      
예를 들어 $y$축으로 180도 회전하는 행렬은 $x$ 기저와 $z$ 기저를 반대 방향으로 돌리므로 다음과 같이 구성된다.

$$
\begin{bmatrix}
-1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & -1 \\
\end{bmatrix}
$$

이 행렬을 사용하는 경우 트레이스 값은 -1이 되고 $w$값은 0이 된다.     
0의 역수는 존재하지 않기 때문에 나머지 값들을 구할 수 없게 된다.        
이러한 경우, $w$가 아닌 다른 요소부터 계산한 후에 이로부터 다른 성분을 구하도록 계산 방법을 우회해야 한다.      
주어진 회전 변환행렬에서 첫 번째 대각 성분과 두 번째와 세 번째 대각 성분을 빼면 다음과 같다.

$$1 - 2y^2 - 2z^2 - 1 + 2x^2 + 2z^2 - 1 + 2x^2 + 2y^2 = -1 + 4x^2$$

그렇다면 이를 사용해 $x$값을 구할 수 있다.      
이 수식을 그림으로 표현하면 [그림 14-10](#그림-14-10-예외-상황에서-x값을-구하기-위한-대각-성분)과 같다.

###### 그림 14-10 예외 상황에서 x값을 구하기 위한 대각 성분
![예외 상황에서 x값을 구하기 위한 대각 성분](/img/)

$y$값은 두 번째 대각 성분에 첫 번째와 세 번째를 빼서 얻을 수 있으며 $z$값은 세 번째 대각 성분에 첫 번째와 두 번째를 빼서 얻을 수 있다.      
$y, z$값을 구하는 식을 만들기 위한 행렬의 요소를 순서대로 정리하면 [그림 14-11](#그림-14-11-y-z값을-구하기-위한-대각-성분)과 같다.

###### 그림 14-11 y, z값을 구하기 위한 대각 성분
![y, z값을 구하기 위한 대각 성분](/img/)

예외 상황을 감안해 회전 변환행렬로부터 사원수를 구하는 알고리즘이 1985년에 ***켄 슈메이크(Ken Shoemake)*** 에 의해 고안됐다.       
먼저 회전 변환행렬의 트레이스 값을 구하고 그 값이 충분히 큰지를 파악한다.       
***이론적으로 트레이스 값이 -1보다 크면*** $w$ ***값 계산이 가능하지만, -1에 가까워질수록 오차가 발생***하므로 ***트레이스 값이 0보다 큰 경우에만 트레이스 값을 토대로 사원수의 모든 요소를 구하는 로직을 적용***한다.     
***나머지 트레이스 값이 0보다 작거나 같은 경우에는 예외 상황으로 간주해 다른 값부터 구하는 것이 이 알고리즘의 핵심***이다.        
$w$를 제외하고 $x, y, z$ 중에서 가장 큰 요소를 파악한다.        
각 대각행렬의 요소 값을 비교하면 확인할 수 있다.        
예를 들어 대각행렬의 첫 번째 대각 요소와 두 번째 대각 요소의 크기를 비교했을 때 두 번째 요소 값이 크다면 $y$의 크기는 $x$보다 크다는 의미다.

$$1 - 2(y^2 + z^2) < 1 - 2(x^2 + z^2)$$

$$-y^2 < -x^2$$

이 과정을 한 번 더 거치면 $x, y, z$에서 가장 큰 요소를 찾을 수 있다.        
이렇게 파악된 가장 큰 요소의 값을 먼저 구한다.      
참고로 제곱근으로 해를 구할 때는 항상 양수를 사용한다.      
이와 같은 방법으로 가장 큰 수를 구했다면 나머지 두 요소는 $xy, yz, xz$ 값으로부터 얻을 수 있는데 이들을 구하기 위한 행렬의 요소를 [그림 14-12](#그림-14-12-순서대로-xy-yz-xz-값을-구하기-위한-행렬의-성분)에 (a), (b), (c) 순서대로 정리한다.

###### 그림 14-12 순서대로 xy, yz, xz 값을 구하기 위한 행렬의 성분
![순서대로 xy, yz, xz 값을 구하기 위한 행렬의 성분](/img/)

$x, y, z$를 모두 구했다면 마지막 $w$값은 [그림 14-8](#그림-14-8-xw값을-구하기-위한-행렬의-성분)과 [그림 14-9](#그림-14-9-yw-zw-값을-구하기-위한-행렬의-성분)에서 구한 $xw, yw, zw$의 값으로부터 구한다.     

# 52. 사원수의 보간
***사원수는 로드리게스 회전과 동일한 축-각 방식을 사용해 3차원 공간의 회전을 표현***한다.     
사원수를 사용하는 경우의 장점을 열거해보면 다음과 같다.     

- ***오일러 각과 쉽게 변환이 가능***하며 ***회전행렬 제작이 용이***하다.
- ***임의의 축에 대한 회전 표현이 가능***하기 때문에 ***짐벌락 현상을 방지***할 수 있다.
- ***임의의 축에 대한 회전 보간 값***을 구할 수 있다.
- ***4개의 숫자로 회전을 표현***하기 때문에 저장 공간을 효율적으로 쓸 수 있다.

또한 사원수는 행렬과 상호 변환이 가능하다.      
다른 회전 방식과 비교한 사원수의 장단점은 [표 14-3](#식-14-3)과 같다.

###### 표 14-3 3차원 회전 표현의 장단점 비교

||오일러 각|행렬|사원수|
|---|---|---|---|
|저장공간|가장 작다. 저장 공간의 수는 3|크다. 저장 공간의 수는 9|작다. 저장 공간의 수는 4|
|짐벌락 현상|발생|발생하지 않음|발생하지 않음|
|회전 보간|한 기저 축에 대해서만 가능|불가능|임의의 축에 가능|
|직관성|직관적이다.|직관적이지 않다.|직관적이지 않다.|

다른 회전 방식에 비해 ***사원수가 가지는 장점***은 ***회전 보간이 가능***하다는 것이다.     
사원수를 4차원 공간의 벡터로 생각하고, 두 사원수가 만들어내는 4차원 공간에서의 평면을 상상해보자.   
해당 평면에서 주어진 비율 $t$에 대응하는 사원수는 두 사원수의 위치를 선형 보간한 지점이 된다.       
두 사원수가 만든 평면에서 $\frac{1}{3}$만큼 보간된 사원수를 구하는 방법은 [그림 14-13](#그림-14-13-시작점-q_1에서-끝점-q_2까지-13-만큼-선형-보간된-사원수의-위치)과 같이 계산할 수 있다.

###### 그림 14-13 시작점 q_1에서 끝점 q_2까지 1/3 만큼 선형 보간된 사원수의 위치
![시작점 q_1에서 끝점 q_2까지 1/3 만큼 선형 보간된 사원수의 위치](/img/)

주어진 비율 $t$에 대응하는 중간 사원수를 구하는 식은 다음과 같다.

$$q(t) = (1 - t) \cdot q_1 + t \cdot q_2$$

하지만 선형 보간으로 얻어지는 사원수는 크기가 1인 단위 사원수가 아니기 때문에 해당 사원수를 회전에 사용하려면 정규화 과정을 거쳐야 한다.

$$q' = \frac{q(t)}{|q(t)|}$$

***선형 보간법은 빠르고 간편***하게 사용할 수 있지만, ***원의 궤적을 따라 발생하는 회전을 정확히 반영하지는 못한다***.      
좀 더 높은 수준의 결과물을 위해 회전의 움직임을 따르는 중간 사원수를 구하려면 두 사원수가 이루는 각을 $\theta$로 지정하고 주어진 비율 $t$를 사용해 두 각을 각각 $t\theta$와 $(1 - t)\theta$로 나눠야 한다.      
이해를 돕기 위해 비율값 $t$로 $\frac{1}{3}$이 주어졌다면 구하려는 최종 회전 사원수 값은 [그림 14-14](#그림-14-14-구면으로-보간된-사원수와-직선으로-보간된-사원수의-비교)와 같이 계산될 것이다.

###### 그림 14-14 구면으로 보간된 사원수와 직선으로 보간된 사원수의 비교
![구면으로 보간된 사원수와 직선으로 보간된 사원수의 비교](/img/)

이를 만족시키는 선형 보간식의 두 계수 $\alpha$와 $\beta$값을 찾아야 한다.

###### 식 14-5

$$q' = \alpha \cdot q_1 + \beta \cdot q_2$$

[그림 14-15](#그림-14-15-구면으로-보간된-사원수를-평면의-벡터로-표현하기)와 같이 첫 번째 사원수를 $x$축에 일치시키고 이를 회전한 값을 구한다.        
첫 번째 사원수에 해당하는 벡터를 $\vec{x}$, 두 번째 사원수에 해당하는 벡터를 $\vec{u}$라고 할 때, $\vec{x}$에 직교하는 벡터를 $\vec{y}$로, 구해야 할 중간 사원수의 벡터를 $\vec{v}$로 정한다.

###### 그림 14-15 구면으로 보간된 사원수를 평면의 벡터로 표현하기
![구면으로 보간된 사원수를 평면의 벡터로 표현하기](/img/)

[식 14-5](#식-14-5)는 다음과 같이 벡터로 바꿔 쓸 수 있다.

###### 식 14-6

$$\vec{v} = \alpha \cdot \vec{x} + \beta \cdot \vec{u}$$

두 사원수가 만드는 각을 $\theta$라고 했을 때 우리가 구하려는 벡터 $\vec{v}$는 서로 직교하는 두 기저벡터 $\vec{x}$와 $\vec{y}$의 조합으로 계산된다.

###### 식 14-7

$$\vec{v} = \cos(t\theta) \vec{x} + \sin(t\theta) \vec{y}$$

앞에서 예로 든 비율 $\frac{1}{3}$에 대한 계산은 [그림 14-16](#그림-14-16-직교하는-두-기저벡터를-사용한-중간-벡터의-계산)과 같다.

###### 그림 14-16 직교하는 두 기저벡터를 사용한 중간 벡터의 계산
![직교하는 두 기저벡터를 사용한 중간 벡터의 계산](/img/)

벡터 $\vec{x}$에 직교하는 벡터 $\vec{y}$ 값을 모르므로 벡터 $\vec{u}$와 삼각함수를 활용해 이를 구해야 한다.     
[그림 14-17](#그림-14-17-두-번째-사원수로부터-직교하는-벡터-y-구하기)을 보면 $\vec{u} - \cos \theta \vec{x}$ 값과 $\sin \theta \cdot \vec{y}$ 값은 동일한 벡터를 가리킨다.

###### 그림 14-17 두 번째 사원수로부터 직교하는 벡터 y 구하기
![두 번째 사원수로부터 직교하는 벡터 y 구하기](/img/)

이를 활용하면 벡터 $\vec{y}$의 값은 다음과 같이 구할 수 있다.

$$\vec{y} = \frac{\vec{u} - \cos \theta \vec{x}}{\sin \theta}$$

이 값을 [식 14-7](#식-14-7)에 대입하면 최종 벡터를 구하는 식은 다음과 같이 전개된다.

$$
\begin{matrix}
\vec{v} &=& \cos(t\theta)\vec{x} + \sin(t\theta)(\frac{\vec{u} - \cos\theta\vec{x}}{\sin\theta}) \\
&=& (\frac{\sin\theta\cos(t\theta) - \cos\theta\sin(t\theta)}{\sin\theta})\vec{x} + \frac{\sin(t\theta)}{\sin\theta}\vec{u} \\
&=& \frac{\sin(\theta - t\theta)}{\sin \theta}\vec{x} + \frac{\sin(t\theta)}{\sin\theta}\vec{u} \\
\end{matrix}
$$

1. $\vec{x}$와 $\vec{u}$에 대해 묶는다.
2. $\vec{x}$의 계수는 삼각함수의 합 공식에 의해 간략히 정리된다.

위 식을 [식 14-6](#식-14-6)에 대입하면 찾아야 하는 두 계수 $\alpha$와 $\beta$는 각각 다음과 같다.

$$\alpha = \frac{\sin((1 - t)\theta)}{\sin\theta}$$

$$\beta = \frac{\sin(t\theta)}{\sin\theta}$$

위에서 구한 계수를 [식 14-5](#식-14-5)에 대입하면 구면으로 보간하는 최종 식이 만들어진다.

###### 식 14-8

$$q' = \frac{\sin((1-t)\theta)}{\sin \theta} \cdot q_1 + \frac{\sin(t\theta)}{\sin\theta} \cdot q_2$$

이 방법으로 보간하는 방법을 ***구면 선형 보간(Spherical linear interpolation)*** 이라고 하며, 줄여서 ***슬럽(Slerp)*** 이라 부른다.       
사원수의 구면 선형 보간을 구현하는 데 필요한 두 계수의 식 외에 고려할 점이 몇 가지 있다.        
먼저 ***두 사원수로부터 나오는 회전 경로는 항상 긴 경로와 짧은 경로의 두 가지가 있는데, 이 중에 하나를 선택***해야 한다는 점이다.     
[그림 14-18](#그림-14-18-두-벡터의-사잇각을-구하는-방법)과 같이 원 위에 벡터 $\vec{v_1}$와 벡터 $\vec{v_2}$가 있을 때 두 벡터가 만들어내는 회전 경로는 언제나 짧은 경로 $\theta_1$과 긴 경로 $\theta_2$ 두 가지가 존재한다.     
***일반적으로는 짧은 경로를 사용***한다.

###### 그림 14-18 두 벡터의 사잇각을 구하는 방법
![두 벡터의 사잇각을 구하는 방법](/img/)

[그림 14-18](#그림-14-18-두-벡터의-사잇각을-구하는-방법)의 경우 벡터 $\vec{v_1}$에서 벡터 $\vec{v_2}$로 순서대로 구면 선형 보간을 적용하면 짧은 경로에서의 보간이 진행된다.     
하지만 두 벡터가 [그림 14-19](#그림-14-19-벡터의-각이-긴-경로의-각으로-설정된-경우)와 같이 배치되어 있다면 구면 선형 보간은 긴 경로로 진행된다.

###### 그림 14-19 벡터의 각이 긴 경로의 각으로 설정된 경우
![벡터의 각이 긴 경로의 각으로 설정된 경우](/img/)

따라서 언제나 짧은 경로로 구면 선형 보간하고자 한다면, 구면 선형 보간을 진행하기 전에 두 벡터의 사잇각이 $180^\circ$보다 작은지부터 확인해야 한다.      
이보다 큰 경우에는 짧은 경로의 결과가 나오도록 계산 방법을 조정해야 한다.

두 벡터가 이루는 각을 조사하면 쉽게 해결 할 수 있지만, 현재 사용하는 사원수에는 항상 회전시키고자 하는 각의 절반이 저장되어 있기 때문에, 이를 감안해야 한다.        
예를 들어 사원수 $(0, (1, 0, 0))$에 대해 생각해보자.        
사원수 $(0, (1, 0, 0))$을 4차원 공간의 회전에 사용한다면 이는 $(\cos \theta, \sin \theta \vec{n})$로 해석되므로 $x$축을 중심으로 $90^\circ$로 회전 변환하는 회전 사원수가 된다.     
하지만 사원수 $(0, (1, 0, 0))$을 3차원 공간의 회전에 사용한다면 $(\cos \frac{\theta}{2}, \sin \frac{\theta}{2}\vec{n})$로 해석되어야 한다.      
이 경우에는 앞에서 살펴본 $v' = q \cdot v \cdot q^*$ 공식을 거쳐 3차원 공간에서 $x$축을 중심으로 하는 $180^\circ$ 회전 변환을 만들어낸다.       
[그림 14-20](#그림-14-20-사원수에-담긴-각의-정보)은 이에 관한 예시다.        
어떤 사원수에 저장된 각이 $120^\circ$라면, 해당 사원수를 통해 구현된 3차원 공간의 회전은 그 두 배인 $240^\circ$가 된다.

###### 그림 14-20 사원수에 담긴 각의 정보
![사원수에 담긴 각의 정보](/img/)

그렇기 때문에 긴 경로를 탐지하는 조건도 바뀐다.     
해당 경로가 긴 경로인지 여부를 탐지하기 위해 두 사원수가 이루는 사잇각은 $180^\circ$가 아닌 $90^\circ$가 되어야 한다.       
그렇다면 긴 경로인지 파악하기 위한 사잇각의 최소 크기는 $90^\circ$가 되며 이는 ***내적을 사용해 판별이 가능***하다.       
두 사원수의 내적 값이 음수가 나오면 두 사원수가 이루는 사잇각이 $90^\circ$보다 크다는 의미이며, 이는 긴 경로의 회전에 사원수가 사용된다고 판단할 수 있다.       
이 경우에는 두 번째 사원수를 짧은 경로의 사원수로 바꿔주어야 한다.

짧은 경로의 사원수는 사원수를 반전시키는 것으로 간단히 처리할 수 있다.      
예를 들어 두 사원수의 사잇각이 $120^\circ$인 경우, 실제 진행되는 $240^\circ$ 회전에 대응하는 짧은 경로의 회전은 $-120^\circ$ 회전이 된다.       
짧은 경로의 $-120^\circ$ 회전에 대응하는 사원수는 그 절반인 $-60^\circ$ 사잇각을 가진 사원수가 된다.        
이는 [그림 14-21](#그림-14-21-사원수를-반전시켜-짧은-거리의-사원수를-구하는-예시)과 같이 $120^\circ$ 사잇각을 가진 사원수 $q_2$를 반전해 얻을 수 있다.

###### 그림 14-21 사원수를 반전시켜 짧은 거리의 사원수를 구하는 예시
![사원수를 반전시켜 짧은 거리의 사원수를 구하는 예시](/img/)

구면 선형 보간을 구현할 때 고려할 점은 입력으로 들어온 두 사원수의 방향이 평행하면 분모 $\sin \theta$의 값이 0이 되어 [식 14-8](#식-14-8)의 구면 선형 보간 계산이 불가능해진다는 것이다.        
이 경우 긴 경로인지를 파악하기 위해 이미 계산했던 내적을 활용해 파악할 수 있다.     
내적 값의 크기가 1이면 두 사원수는 평행한 상태이기 때문이다.        
따라서 오차까지 감안해 두 사원수의 내적이 1과 매우 근접한 경우에는 일반 선형 보간을 사용하도록 로직을 만들어야 한다.

***구면 선형 보간은 카메라의 움직임이나 캐릭터 애니메이션과 같이 시간에 따른 부드러운 회전을 구현하는 데 유용하게 사용***된다.        